if(typeof(console)=="undefined"){window.console={log:function(a){}}}if(top.location==location){if(!window.top.VJ){window.top.VJ={cross:false}}VJ=window.top.VJ}else{if(!window.VJ){window.VJ={cross:true}}VJ=window.VJ}(function(V,$){V.isValid=function(data){if(typeof(data)!="undefined"&&data!=null&&data!="null"&&!(data==="")){return true}else{return false}};V.getValue=function(data,defaultData){return V.isValid(data)?data:defaultData};var funrep1=function(s,o){var reg=/<%=[^(%>)]+%>/gi;return s.replace(reg,function(word){var prop=word.replace(/<%=/g,"").replace(/%>/g,"");if(V.isValid(o[prop])){return o[prop]}else{return""}})};var funrep2=function(s,o){var reg=/\{[^(})]+\}/gi;return s.replace(reg,function(word){var prop=word.replace(/\{/g,"").replace(/\}/g,"");if(V.isValid(o[prop])){return o[prop]}else{return""}})};V.format=function(s,o){if(!s||!o){return V.getValue(s,"")}if(s.indexOf("<%=">=0)){s=funrep1(s,o)}if(s.indexOf("{">=0)){s=funrep2(s,o)}return s};V.sb=function(){return new function(){var _=this,__={};__.data=[];__.length=0;_.append=function(str){str=V.getValue(str+"","");__.data.push(str);__.length+=str.length;return _};_.appendFormat=function(format,data){return _.append(V.format(format,data))};_.insert=function(start,data){var str=_.toString();data=V.getValue(data+"","");__.data=[str.substr(0,start),data,str.substr(start)];__.length=str.length+data.length;return _};_.insertFormat=function(start,format,data){return _.insert(start,V.format(format,data))};_.remove=function(start,length){var str=_.toString();__.data=[str.substr(0,start),str.substr(start+length)];__.length=Math.max(0,str.length-length);return _};_.toString=function(){return __.data.join("")};_.clear=function(){var s=_.toString();__.data=[];__.length=0;return s};_.length=function(){return __.length}}};V.isArray=function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};V.each=function(data,func,finalF,isSync){data=Array.prototype.slice.call(data,0);V.whileC(function(){return data.shift()},func,finalF,isSync)};V.once=function(func,timeout){timeout=timeout||1;if(func.timeoutID){window.clearTimeout(func.timeoutID)}func.timeoutID=window.setTimeout(function(){V.tryC(function(){func()})},timeout)};V.forC=function(data,func,finalf,isSync){var ret=[];for(var i in data){ret.push({key:i,value:data[i]})}V.whileC(function(){return ret.shift()},function(v){if(func){func(v.key,v.value)}},finalf,isSync)};V.forC2=function(data,func,finalf,isSync){var ret=[];for(var i in data){ret.push({key:i,value:data[i]})}V.whileC2(function(){return ret.shift()},function(v,next){if(func){V.tryC(function(){func(v.key,v.value,next)})}},finalf,isSync)};V.whileC=function(exp,func,finalf,isSync){var _=this;var _func=null;if(isSync){_func=function(val){if(val){V.tryC(function(){func(val)});_func(exp())}else{if(finalf){finalf()}}}}else{_func=function(val){if(val){window.setTimeout(function(){V.tryC(function(){func(val)});_func(exp())},1)}else{if(finalf){finalf()}}}}_func(exp())};V.whileC2=function(exp,func,finalf,isSync){var _=this;var _func=null;if(isSync){_func=function(val){if(val){V.tryC(function(){func(val,function(){_func(exp())})})}else{if(finalf){finalf()}}}}else{_func=function(val){if(val){window.setTimeout(function(){V.tryC(function(){func(val,function(){_func(exp())})})},1)}else{if(finalf){finalf()}}}}_func(exp())};V.finalC=function(){var funs=[];for(var i=0;i<arguments.length;i++){if(typeof(arguments[i])=="function"){funs.push({key:funs.length,func:arguments[i]})}}if(funs.length>1){var data={},finalF=funs.length>0?funs.pop().func:null,len=funs.length,ret={};var ff=function(key){ret[key]=true;var retlen=0;for(var k in ret){retlen++}if(retlen==len){finalF.apply(null,[data])}};V.each(funs,function(v){var value=v;value.func.apply(null,[data,function(){ff(value.key)}])},null,false)}else{finalF.apply(null,[{}])}};V.next=function(){var funs=[];for(var i=0;i<arguments.length;i++){if(typeof(arguments[i])=="function"){funs.push({key:funs.length,func:arguments[i]})}}if(funs.length>1){var data={},finalF=funs.length>0?funs.pop().func:null;V.whileC2(function(){return funs.shift()},function(v,next){if(v){v.func.apply(null,[data,next])}},function(){finalF.apply(null,[data])},false)}else{if(funs.length>0){funs[0].func.apply(null,[{}])}}};V.getType=function(x){if(x==null){return"null"}var t=typeof x;if(t!="object"&&t!="Object"){return t}if(V.isArray(x)){return"Array"}var c=Object.prototype.toString.apply(x);c=c.substring(8,c.length-1);if(c!="Object"){return c}if(x.constructor==Object){return c}if(x.prototype&&"classname" in x.prototype.constructor&&typeof x.prototype.constructor.classname=="string"){return x.constructor.prototype.classname}return"ukObject"};V.inherit=function(parent,args){var _temp=(function(){var F=function(){};F.prototype=parent.prototype;F.prototype.isF=true;return new F()})();_temp.constructor=parent;if(!this.prototype){parent.apply(this,args);if(this.__proto__&&!this.__proto__.isF){this.__proto__.constructor.prototype=_temp.__proto__.constructor.prototype}this.__proto__=_temp;this.base=this.__proto__.constructor.prototype}else{console.log("如果失败，需要配合子类构造函数中使用parent.apply(this,[***])");this.prototype=_temp}};V.create=function(type,args){if(typeof(type)=="function"){args=V.isArray(args)?args:[args];var ret="(new type(";if(V.isArray(args)){for(var i in args){ret+="args["+i+"],"}if(args.length>0){ret=ret.substr(0,ret.length-1)}}return eval(ret+"))")}else{V.showException("请传入类定义")}};V.create2=function(type,args){var ret="(new "+type+"(";if(V.isArray(args)){for(var i in args){ret+="args["+i+"],"}if(args.length>0){ret=ret.substr(0,ret.length-1)}}return eval(ret+"))")};V.merge=function(){var _clone=function(source){switch(V.getType(source)){case"Object":case"object":return _merge({},source);break;case"array":case"Array":var aim=[];for(var i in source){aim.push(_clone(source[i]))}return aim;default:return source;break}};var _merge=function(aim,source){if(!(typeof(source)=="object"&&!V.isArray(source))){return aim}for(var i in source){if(source[i]!=undefined){if(!V.isValid(aim[i])){aim[i]=_clone(source[i])}else{switch(V.getType(aim[i])){case"object":case"Object":_merge(aim[i],source[i]);break;case"Array":var hasmergeIndex=false;for(var i3=0,k=source[i][i3];i3<source[i].length;i3++,k=source[i][i3]){if(typeof(k.mergeIndex)=="number"){hasmergeIndex=true;if(aim[i].length<(k.mergeIndex+1)){aim[i].push(k)}else{aim[i][i3]=_merge(aim[i][i3],k)}}else{if(typeof(k.moveIndex)=="number"){hasmergeIndex=true;aim[i].splice(k.moveIndex,0,k)}}}if(!hasmergeIndex){aim[i]=_clone(source[i])}break;default:aim[i]=source[i];break}}}}return aim};var argu=arguments;if(argu.length<2){return argu[0]?argu[0]:{}}if(argu.length>0&&true==argu[argu.length-1]){var _=argu[0];for(var i2=1;i2<argu.length;i2++){_=_merge(_,argu[i2])}return _}else{var _={};for(var i2=0;i2<argu.length;i2++){_=_merge(_,argu[i2])}return _}};V.userAgent={ie:false,firefox:false,chrome:false,safari:false,opera:false,mobile:false,pc:false,pad:false,iphone:false,android:false,refresh:function(){V.userAgent.width=(function(){if(document.body&&document.body.clientWidth>0){return document.body.clientWidth}else{return document.documentElement.clientWidth}})();V.userAgent.height=(function(){if(document.body&&document.body.clientHeight>0){return document.body.clientHeight}else{return document.documentElement.clientHeight}})()}};V.userAgent.refresh();var ua=navigator.userAgent.toLowerCase();var s;(s=ua.match(/msie ([\d]+)/))?V.userAgent.ie=s[1]:(s=ua.match(/firefox\/([\d.]+)/))?V.userAgent.firefox=s[1]:(s=ua.match(/chrome\/([\d.]+)/))?V.userAgent.chrome=s[1]:(s=ua.match(/opera.([\d.]+)/))?V.userAgent.opera=s[1]:(s=ua.match(/version\/([\d.]+).*safari/))?V.userAgent.safari=s[1]:0;(s=ua.match(/(mobile)/))?V.userAgent.mobile=true:false;(s=ua.match(/(ipad)|(mediapad)/))?(V.userAgent.pad=true,V.userAgent.mobile=false):false;(s=ua.match(/(android)|(linux)/))?(V.userAgent.android=true):false;(s=ua.match(/(iphone)|(mac)/))?(V.userAgent.iphone=true):false;V.userAgent.pc=!(V.userAgent.mobile||V.userAgent.pad);for(var key in V.userAgent){if(key!="pc"&&key!="width"&&key!="height"&&key!="refresh"&&V.getValue(V.userAgent[key],false)){V.userAgent.name=key}}console.log("VJ.userAgent:"+V.userAgent.name);if(V.getValue(V.userAgent.ie,false)){var ver=V.userAgent.ie;eval("VJ.userAgent.ie"+ver+" = true;V.userAgent.name='ie"+ver+"';")}V.isDebug=false;V.showException=function(name,e){if(V.isDebug){var content=name;if(V.isValid(e)){content+=("\r\nname:"+e.name+"\r\nmessage:"+e.message+(e.stack?("\r\nstack:"+e.stack+(e.fileName?("\r\nfile:"+e.fileName):"")+(e.lineNumber?("\r\nlineNumber:"+e.lineNumber):"")):(V.userAgent.ie?("\r\ndescription:"+e.description):"")))}console.log("未捕获异常:"+content)}};V.tryC=function(func){try{func()}catch(e){V.showException("",e)}};var start=null;V.watch=function(restart){if(!start||restart){start=new Date();console.log("VJ.watch开始"+start)}else{console.log("VJ.watch 持续了:"+start.diff("ms",new Date()))}};V.newEl=function(tag,style,txt){var elm=$(document.createElement(tag));if(txt!=""){elm.text(txt)}if(style!=""){elm.addClass(style)}return elm};V.encHtml=function(html){return(V.getValue(html,"").replace(/[\r\n]+/g,">v>j>").replace(/\s+/g," ").replace(/>v>j>/g,"\r\n").replace(new RegExp("~|(\r\n)|!|@|#|\\$|%|\\^|;|\\*|\\(|\\)|_|\\+|\\{|\\}|\\||:|\"|\\?|`|\\-|=|\\[|\\]|\\|;|'|,|\\.|/|，|；","g"),function(a){return encodeURIComponent(a)}))};V.decHtml=function(html){return decodeURIComponent(V.getValue(html,""))};V.setChecked=function(node,value){function setCheckBox(node2,value){$(node2).attr("checked",value);if(V.userAgent.ie6||V.userAgent.ie7){var chk=$(node2);if(V.isValid(chk.get(0))){chk.get(0).defaultChecked=value;chk.get(0).checked=value}}}if(node.length){$(node).each(function(i,v){setCheckBox(v,value)})}else{setCheckBox(node,value)}};V.getChecked=function(node){if(V.userAgent.ie6||V.userAgent.ie7){if(V.isValid(node.get(0))){return node.get(0).checked}return null}else{return node.prop?node.prop("checked"):node.attr("checked")}};V.maxlength=function(){$("textarea[maxlength]").unbind("change").change(function(event){var _=$(this);_.val(_.val.substring(0,_.attr("maxlength")))})};V.fill=function(node,data){$(node.find("[__]")).each(function(i,v){v=$(v);var option=V.merge({formatter:function(val,v,data){return val}},eval("[{"+v.attr("__")+"}]")[0]);var val=V.getValue(data[option.field],"");val=option.formatter.apply(v,[val,v,data]);if(V.isValid(val)||val===""){if(V.isArray(val)){if(v[0].tagName.toLowerCase()==="select"&&V.isValid(option.textfield)){v.empty();$(val).each(function(i,v3){v.append(V.newEl("option","",V.getValue(v3[option.textfield],"")).attr("value",v3.value))})}else{val=val.join(";")}}switch(v[0].tagName.toLowerCase()){case"input":if(v.attr("type")=="checkbox"){V.setChecked(v,(val==true||val==1||val=="1")?true:false)}else{v.val(val)}break;case"textarea":case"select":v.val(val);break;case"img":v.attr("src",val);break;default:v.html(val);break}}})};V.fillTo=function(sor,data,aim,func){$(sor.find("[__]")).each(function(i,v){V.tryC(function(){v=$(v);var node2=func();aim.append(node2);var option=V.merge({formatter:function(val,v,data){return val}},eval("[{"+v.attr("__")+"}]")[0]);var val=V.getValue(data[option.field],"");val=option.formatter.apply(node2,[val,node2,data]);if(V.isValid(option.cssClass)){node2.addClass(option.cssClass)}if(V.isValid(option.click)){node2.click(function(){option.click.apply($(this),data)})}if(V.isValid(val)){node2.html(val)}})})};V.getClipBoardText=function(e){var data=(e&&e.originalEvent.clipboardData)||window.clipboardData;return data.getData("text")};V.setClipBoardText=function(e,val){if(e&&e.originalEvent.clipboardData){e.originalEvent.clipboardData.setData("text/plain",val)}else{if(window.clipboardData){window.clipboardData.setData("text",val)}}};V._settings={};V._exSettings={};V.getSettings=function(key,data){if(!V.isValid(V._settings[key])){if(V.isValid(V._exSettings[key])){V._settings[key]=V.merge(V.getValue(data,{}),V._exSettings[key]);delete V._exSettings[key]}else{V._settings[key]=V.getValue(data,{})}}return V._settings[key]};V.extendSettings=function(key,data){if(V.isValid(V._settings[key])){V._settings[key]=V.merge(V._settings[key],data)}else{if(V.exSettings[key]){V._exSettings[key]=V.merge(V._exSettings[key],V.getValue(data,{}))}else{V._exSettings[key]=V.getValue(data,{})}}};V.evalTJson=function(data){var _evalTJson=function(_dt){var res=[];$(_dt).each(function(i,v){if(0==i){return}var s={};$(v).each(function(q,v2){s[_dt[0][q]]=v2});res[i-1]=s});return res};data=data[0];var res=[];for(var i in data){var v=data[i];res[i]=_evalTJson(v)}return res};V.ajax=function(data){var funcsucc=V.merge(V.getSettings("ajax",{async:true,type:"POST",dataType:"text",cache:false,beforeSend:function(request){},success:function(data,status){var _this=this;try{var hasFalse=false;switch(typeof(data)){case"string":data=data.replace(/[\r\n]+/g,"");if(data.replace(/^(\[+\]+)/g,"").length===0){hasFalse=true}else{hasFalse=(data.toLowerCase().indexOf("[false")>=0?(data.toLowerCase().indexOf("[false:")>=0?(function(){var _data=data.toLowerCase().match(/\[false:[^\]]+\]/g);if(_data&&_data.length>0){return _data[0].substr(7,_data[0].length-8)}else{return true}})():true):false)}break;case"object":if(data){$(data).each(function(i,v){v=v+"";hasFalse=(hasFalse||v=="False"||v=="false")})}else{hasFalse=true}break;case"undefined":default:V.showException("V.Query success方法 name:typeof错误 type:"+typeof(data));hasFalse=true;break}if(!hasFalse){setTimeout(function(){V.tryC(function(){_this.bindData.apply(_this,[_this.filtData(eval(data))])})},1)}else{setTimeout(function(){V.tryC(function(){_this.noData(hasFalse)})},1)}}catch(e){V.showException("V._ajaxOption success方法",e)}},error:function(request,status,error){V.showException("V._ajaxOption error方法 status:"+status,error)},complete:function(request,status){request=null},filtData:function(data){return V.evalTJson(data)[0][0]},bindData:function(data){},noData:function(){}}),data);if(data.jsonp){if(!V._ajaxcall){V._ajaxcall={}}var random=V.random();V._ajaxcall[random]=function(data){delete V._ajaxcall[random];funcsucc.success(data,null)};V.getRemoteJSON(data.url+(data.url.indexOf("?")>=0?"&":"?")+(data.jsonp==true?"callback":data.jsonp)+"=VJ._ajaxcall["+random+"]&"+$.param(data.data))}else{$.ajax(funcsucc)}};V.getRemoteJSON=function(url){var data={filtURI:function(url){return url}};if(V.userAgent.ie){window.setTimeout(function(){$.getScript(V.getSettings("getRemote",data).filtURI(url),function(){})},500)}else{$.getScript(V.getSettings("getRemote",data).filtURI(url),function(){})}};function _V_(){}_V_.prototype.create=function(URL,fun,pStr,isSyn,callBack){this.type=null;this.responseObj=null;this.xmlURL=URL||null;this.xmlFun=fun||"get";this.postStr=pStr||"";if(!this.xmlURL){return}this.xhReq=this.getXMLReq();if(this.xhReq==null){alert("Your browser does not support XMLHTTP.");return}if(isSyn&&(isSyn==true||isSyn=="true")&&this.type!=3){this.xhReq.onreadystatechange=function(){if(this.readyState==4&&(this.status==200||this.status==0)){if(callBack){callBack(this.responseXML.documentElement)}else{return this.responseXML.documentElement}}}}if(this.type!=3){this.xhReq.open(this.xmlFun,this.xmlURL,(isSyn&&(isSyn==true||isSyn=="true"))?true:false);this.xhReq.send((this.xmlFun&&this.xmlFun.toLowerCase()=="post")?this.postStr:null);this.responseObj=this.xhReq.responseText}else{if(this.type==3){this.xhReq.open("get",this.xmlURL,"false");this.responseObj=this.xhReq}}if((isSyn!=null&&(isSyn==false||isSyn=="false"))||this.type==3){if(callBack){callBack(this.responseObj)}else{return this.responseObj}}};_V_.prototype.getXMLReq=function(){var xmlhttp=null;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest();this.type=1}else{if(window.ActiveXObject){xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");this.type=2}}if(document.location.href.indexOf("http://")<0&&window.ActiveXObject){xmlhttp=new ActiveXObject("Microsoft._V_");this.type=3}return xmlhttp};_V_.prototype.abort=function(){this.xhReq.abort()};function _V_AppendScript(data,callback){var ua=navigator.userAgent.toLowerCase();var isOpera=ua.indexOf("opera")>-1;var isIE=!isOpera&&ua.indexOf("msie")>-1;var head=document.getElementsByTagName("head")[0]||document.documentElement,script=document.createElement("script");script.type="text/javascript";if(isIE){script.text=data}else{script.appendChild(document.createTextNode(data))}head.insertBefore(script,head.firstChild);head.removeChild(script);if(callback){callback(script)}}var getHost=function(url){var ret=(url+"").match(/http:\/\/[^\/]+/g)+"";if(ret&&ret.length>0){return ret.substr(7)}else{return""}};V.isCrossdomain=function(url){var host=getHost(url);return !(host.eq("")||host.eq(getHost(window.location.href)+""))};V.include=function(url,tag,callback){if(V.getSettings("include")[url]){return}V.getSettings("include")[url]=true;if(tag==null){tag="head"}var parentNode=document.getElementsByTagName(tag).item(0);var s=url.split(".");var styleTag=s[s.length-1].toLowerCase();if(styleTag.indexOf("?")>=0){styleTag=styleTag.substr(0,styleTag.indexOf("?"))}if(styleTag=="js"){if(V.isCrossdomain(url)&&typeof(XDomainRequest)!="undefined"){V.showException("跨域同步加载仅支持Chrome40以上，IE10以上版本，而且js跨域加载的IIS返回头部添加Access-Control-Allow-Origin: * 版本，如果仍然不可用请在config.js中将可能跨域请求path路径上的js的转入头部，或者在页面onStart时先获取原需要异步获取的对象!");var request=new XDomainRequest();request.open("GET",url);request.timeout=5000;request.send();console.log("xdomainrequest");_V_AppendScript(request.responseText,callback);if(callback){callback()}}else{var thisJsDom=new _V_();thisJsDom.create(url,"get",null,false,function(data){_V_AppendScript(data,callback)});if(callback){callback()}}}if(styleTag=="css"){new_element=document.createElement("link");new_element.setAttribute("type","text/css");new_element.setAttribute("rel","stylesheet");new_element.setAttribute("href",url);new_element.setAttribute("media","screen");parentNode.appendChild(new_element);if(callback){callback()}}};if(!V._V_Part_Map){V._V_Part_Map=[]}V.part=function(url,node,mode,callback){var parts=V._V_Part_Map;if(!V.isValid(node)){node=$(document.createDocumentFragment());node.appendTo($(document.body))}if($(node).get(0).tagName.toLowerCase()=="iframe"){return $(node).attr("src",url)}else{if(V.getValue(mode,"")=="iframe"){return $(node).append('<IFRAME class=g_iframe border=0 marginWidth=0 frameSpacing=0 marginHeight=0 frameBorder=no allowTransparency=true src="'+url+'"></IFRAME>')}else{if(V.getValue(mode,"")=="jsonp"){var randomid=Math.round(Math.random()*100000000);node=$(node).hide();parts[randomid]=function(html){html=decodeURIComponent(html);delete parts[randomid];node.append(html).show();if(callback){callback()}};V.getRemoteJSON(url.replace(/\.html/g,".jnp")+(url.indexOf("?")>=0?"&":"?")+"_bk=VJ._V_Part_Map["+randomid+"]")}else{node=$(node);window.setTimeout(function(){node.hide().load(url,function(){window.setTimeout(function(){if(!(node.hasClass("ui-dialog-content")||node.hasClass("g_hide"))){node.show()}},1);if(callback){callback()}})},1);return node}}}};V.registCommand=function(name,func){var comms=V.getSettings("comms",[]);var data=comms[name];if(V.isValid(data)&&typeof(data)!="function"){func.apply(null,data)}comms[name]=func};V.callCommand=function(name,data){var caller=arguments.caller;var comms=V.getSettings("comms",[]);var func=comms[name];data=V.isArray(data)?data:[data];if(V.isValid(func)&&typeof(func)=="function"){V.once(function(){func.apply(caller,data)})}else{comms[name]=data}};V.hasCommand=function(name){var comms=V.getSettings("comms",[]);var func=comms[name];return(V.isValid(func)&&typeof(func)=="function")};V.cleanCommand=function(name){var comms=V.getSettings("comms",[]);delete comms[name]};V.registEvent=function(name,func,isTop){var fun=function(name,func,isTop){var events=V.getSettings("events",[]);var funs=events[name];if(!V.isValid(funs)){funs=[];events[name]=funs}if(typeof(func)=="function"){if(isTop&&!funs.top){funs.top=func;funs.unshift(func)}else{if(isTop&&funs.top){V.showException("V.registEvent:"+name+" 事件已经有订阅者被置顶!")}funs.push(func)}var ecall=V.getSettings("eventcall",{});ecall=ecall[name]?ecall[name]:{};if(ecall.time&&ecall.time>=(new Date().getTime())){V.once(function(){func.apply(ecall.caller,ecall.data)})}}};if(V.isArray(name)){V.each(name,function(v){fun(v,func,isTop)},null,true)}else{fun(name,func,isTop)}};V.callEvent=function(name,data){var caller=arguments.caller;var events=V.getSettings("events",[]);var funs=events[name];data=V.isArray(data)?data:[data];if(V.isValid(funs)&&V.isArray(funs)){V.each(funs,function(func){V.tryC(function(){func.apply(caller,data)})})}var ecall=V.getSettings("eventcall",{});if(!ecall[name]){ecall[name]={}}ecall=ecall[name];ecall.time=new Date().add("n",1).getTime();ecall.data=data;ecall.caller=caller};V.hasEvent=function(name){var events=V.getSettings("events",[]);var funs=events[name];if(V.isValid(funs)&&V.isArray(funs)){return true}return false};V.cleanEvent=function(name){var events=V.getSettings("events",[]);delete events[name]};V.getEvent=function(event){return event?event:window.event};V.getTarget=function(event){return event.target||event.srcElement};V.cancel=function(event){if(event.preventDefault){event.preventDefault()}else{event.returnValue=false}};V.stopProp=function(event){if(event.stopPropagation){event.stopPropagation()}else{event.cancelBobble=true}};V.formatPrice=function(number,decimals,dec_point,thousands_sep){number=(number+"").replace(/[^0-9+-Ee.]/g,"");var n=!isFinite(+number)?0:+number,prec=!isFinite(+decimals)?2:Math.abs(decimals),sep=(typeof thousands_sep==="undefined")?",":thousands_sep,dec=(typeof dec_point==="undefined")?".":dec_point,s="",toFixedFix=function(n,prec){var k=Math.pow(10,prec);return""+Math.round(n*k)/k};s=(prec?toFixedFix(n,prec):""+Math.round(n)).split(".");if(s[0].length>3){s[0]=s[0].replace(/B(?=(?:d{3})+(?!d))/g,sep)}if((s[1]||"").length<prec){s[1]=s[1]||"";s[1]+=new Array(prec-s[1].length+1).join("0")}return s.join(dec)};V.qs=(function(){return new function(qs){this.params={};if(qs==null){qs=location.search.substring(1,location.search.length)}this.get=function(key,default_){var value=this.params[key];return(value!=null)?value:default_};this.contains=function(key){var value=this.params[key];return(value!=null)};if(qs.length==0){return}qs=qs.replace(/\+/g," ");var args=qs.split("&");for(var i=0;i<args.length;i++){var pair=args[i].split("=");var name=decodeURIComponent(pair[0]);var value=(pair.length==2)?decodeURIComponent(pair[1]):name;this.params[name]=value}}})();Date.prototype.add=function(interval,number){var d=new Date(this.getTime());var k={y:"FullYear",q:"Month",m:"Month",w:"Date",d:"Date",h:"Hours",n:"Minutes",s:"Seconds",ms:"MilliSeconds"};var n={q:3,w:7};eval("d.set"+k[interval]+"(d.get"+k[interval]+"()+"+((n[interval]||1)*number)+")");return d};Date.prototype.diff=function(interval,objDate2){var d=this,i={},t=d.getTime(),t2=objDate2.getTime();i.y=objDate2.getFullYear()-d.getFullYear();i.q=i.y*4+Math.floor(objDate2.getMonth()/4)-Math.floor(d.getMonth()/4);i.m=i.y*12+objDate2.getMonth()-d.getMonth();i.ms=objDate2.getTime()-d.getTime();i.w=Math.floor((t2+345600000)/(604800000))-Math.floor((t+345600000)/(604800000));i.d=Math.floor(t2/86400000)-Math.floor(t/86400000);i.h=Math.floor(t2/3600000)-Math.floor(t/3600000);i.n=Math.floor(t2/60000)-Math.floor(t/60000);i.s=Math.floor(t2/1000)-Math.floor(t/1000);return i[interval]};Date.prototype.sub=function(interval,objDate2){return -1*Date.prototype.diff.apply(this,[interval,objDate2])};Date.prototype.toString=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};var week={"0":"/u65e5","1":"/u4e00","2":"/u4e8c","3":"/u4e09","4":"/u56db","5":"/u4e94","6":"/u516d"};if(fmt){}else{fmt="yyyy/MM/dd HH:mm:ss"}if(/(y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}if(/(E+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,((RegExp.$1.length>1)?(RegExp.$1.length>2?"/u661f/u671f":"/u5468"):"")+week[this.getDay()+""])}for(var k in o){if(new RegExp("("+k+")").test(fmt)){fmt=fmt.replace(RegExp.$1,(RegExp.$1.length==1)?(o[k]):(("00"+o[k]).substr((""+o[k]).length)))}}return fmt};var index=0;V.random=function(){return parseInt(""+(new Date()).getTime()+(index++))};V.hash=function(str,caseSensitive){caseSensitive=V.getValue(caseSensitive,false);if(!caseSensitive){str=str.toLowerCase()}var hash=1315423911,i,ch;for(i=str.length-1;i>=0;i--){ch=str.charCodeAt(i);hash^=((hash<<5)+ch+(hash>>2))}return(hash&2147483647)};String.prototype.endWith=function(str){if(str==null||str==""||this.length==0||str.length>this.length){return false}if(this.substring(this.length-str.length)==str){return true}else{return false}return true};String.prototype.startWith=function(str){if(str==null||str==""||this.length==0||str.length>this.length){return false}if(this.substr(0,str.length)==str){return true}else{return false}return true};String.prototype.eq=function(str,isOri){str=str+"";return isOri?(this==str):(this.toLowerCase()==str.toLowerCase())};if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx,escapable,gap,indent,meta,rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());V.toJsonString=function(obj){return JSON.stringify(obj)};V.json=function(txt){return JSON.parse(txt)}})(VJ,jQuery);(function(V,$){V.config={};var C=V.config;C.Configs={ConfigConverts:{AppSettings:{type:"VJ.config.AppSettingsConfigConvert"}}};C.Config=function(){var _=this;_.data={};_.getValue=function(key){return _.data[key]};_.setValue=function(key,value){_.data[key]=value};_.merge=function(config){_.data=V.merge(_.data,config.data)}};C.ConfigConvert=function(){var _=this;_.toConfig=function(val){return null};_.toStrings=function(config){return""};_.needConfig=false};C.AppSettingsConfigConvert=function(){var _=this;V.inherit.apply(_,[C.ConfigConvert,[]]);_.toConfig=function(val){var conf=new C.Config();val=V.getValue(val,{});for(var i in val){conf.data[i]=val[i]}return conf}};C.ConfigManager=function(parent,resource){var _=this;var dic={};var data={};var hasUpdate=false;_.getConfig=function(key){if(!V.isValid(data[key])){data[key]=new C.ProxyConfig(_,key)}return data};_.getConfigValue=function(config,key){var func=function(){if(parent){return parent.getConfigValue(config,key)}else{return null}};if(!dic[config]){return func.apply(_,[])}else{var value=dic[config].getValue(key);return !value?func.apply(_,[]):value}};_.setConfigValue=function(config,key,value){hasUpdate=true;var func=function(){if(parent){parent.setConfigValue(config,key,value)}};if(!dic[config]){func.apply(_,[])}else{dic[config].setValue(key,value)}};_.update=function(){if(hasUpdate){_.adapter.update(_,dic,resource)}};var that=_;if(parent==null){dic.ConfigConverts=new function(){var _=this;V.inherit.apply(_,[C.Config,[]]);_.data.ConfigConverts=new function(){var _=this;_.toConfig=function(val){return new function(){var _=this;V.inherit.apply(_,[C.Config,[]]);for(var i in val){_.data[i]=(function(){var conf=val[i];if(conf.path){V.include(conf.path)}return V.create2(conf.type,[])})()}}};_.toStrings=function(config){V.showException("基础解析器不支持此功能")}}}}_.adapter=C.ConfigAdapter.prototype.getInstance();_.adapter.fill(_,dic,resource)};C.ProxyConfig=function(config,confkey){var _=this;V.inhert(C.Config,[]);_.getValue=function(key){return config.getConfigValue(confkey,key)};_.setValue=function(key,value){return config.setConfigValue(confkey,key,value)};_.merge=function(config){V.showException("不支持的功能")}};C.ConfigAdapter=function(){var _=this;_.fill=function(cm,dic,resource){resource=resource.load();if(typeof(resource)=="string"){resource=eval("("+resource+")")}for(var i in resource){var convert=cm.getConfigValue("ConfigConverts",i);if(!convert){V.showException("ConfigConverts 没有找到对应的解析器"+i)}else{var val=convert.toConfig(resource[i],convert.needConfig?cm:null);if(!val){console.log("ConfigConverts 解析失败"+i+":");console.log(resource[i])}else{if(dic[i]){dic[i].merge(val)}else{dic[i]=val}}}}};_.update=function(cm,dic,resource){var data={};for(var i in dic){var convert=cm.getConfigValue("ConfigConverts",i);if(!convert){V.showException("ConfigConverts 没有找到对应的解析器"+i)}else{var val=convert.toString(dic[i]);if(!val){console.log("ConfigConverts 解析失败"+i+":");console.log(dic[i])}else{data[i]=val}}}resource.save((function(){var ret="{";for(var i in data){ret=ret+i+":"+data[i]+","}if(ret.substr(ret.length-1)==","){ret=ret.substr(0,ret.length-1)}return ret+"}"})())}};C.ConfigAdapter.prototype.getInstance=function(){if(!C.ConfigAdapter.prototype.instance){C.ConfigAdapter.prototype.instance=new C.ConfigAdapter()}return C.ConfigAdapter.prototype.instance};C.getConfigManagerFromObj=function(cm,obj){if(!obj){return cm}return new C.ConfigManager(cm,(function(){return new function(){var _=this;if(typeof(obj)==="string"){obj=eval("("+obj+")")}_.load=function(){return obj};_.save=function(){V.showException("getConfigManagerFromObj不支持此方式")}}})())};C.getConfigManagerFromJS=function(cm,name,path){if(!name){return cm}if(path){if(typeof(path)=="string"&&path.indexOf(";")>=0){path=path.split(";")}if(V.isArray(path)){for(var i in path){V.include(path[i])}}else{V.include(path)}}return new C.ConfigManager(cm,(function(){return new function(){var _=this;if(typeof(name)==="string"){name=eval("("+name+")")}_.load=function(){return name};_.save=function(){V.showException("getConfigManagerFromJS不支持此方式")}}})())};C.getBaseConfigManager=function(){if(!C.baseConfig){C.baseConfig=C.getConfigManagerFromObj(null,C.Configs)}return C.baseConfig};C.getApplicationConfigManagerFromJS=function(name,path){return C.getConfigManagerFromJS(C.getBaseConfigManager(),name,path)};C.getApplicationConfigManagerFromObj=function(obj){return C.getConfigManagerFromObj(C.getBaseConfigManager(),obj)}})(VJ,jQuery);(function(a,b){a.collection={};var c=a.collection;c.Pool=function(f,h,e){var d=this;var g={};g.data=[];g.have=[];g.use={};g.KEY="_____poolid";g.addUse=function(i){if(i){if(!a.isValid(i[g.KEY])){i[g.KEY]=a.random()}g.use[i[g.KEY]]=i}};g.delUse=function(i){if(i){if(a.isValid(i[g.KEY])&&a.isValid(g.use[i[g.KEY]])){delete g.use[i[g.KEY]]}}};e=a.getValue(e,10);g.clearer=new function(){var i=this;var j=null;i.start=function(){j=window.setTimeout(function(){var l=g.have.length>0?g.have[0].endDate:null;if(a.isValid(l)&&new Date().diff("ms",l)>0){i.start()}else{while(g.have.length>0){var m=g.have.shift();if(m.dispose){m.dispose();m=null}}g.data=[];for(var k in g.use){g.data.push(g.use[k])}i.start()}},500)};i.stop=function(){if(j){window.clearTimeout(j)}j=null}};g.clearer.start();d.getValue=function(){var i=g.have.pop();if(i){i=i.value;g.addUse(i);return i}else{if(g.data.length<f){i=h();g.addUse(i);g.data.push(i);return i}else{return null}}};d.setValue=function(i){g.delUse(i);if(a.isValid(i)&&a.isValid(i[g.KEY])){g.have.push({endDate:new Date().add("s",e),value:i})}};d.dispose=function(){g.clearer.stop();while(g.have.length>0){var k=g.have.shift();if(k.dispose){k.dispose();k=null}}g.data=[];for(var j in use){g.data.push(use[j])}}}})(VJ,jQuery);(function(V,$){V.middler={};V.config.Configs=V.merge(V.config.Configs,{ConfigConverts:{Middler:{type:"VJ.middler.MiddlerConfigConvert"}}});var M=V.middler;M.Middler=function(cm){var _=this;var KEY="Middler";_.getObjectByAppName=function(app,name){return cm.getConfigValue(KEY,new function(){var _=this;_.getValue=function(config){return config.getValueByName(app,name)}})};_.setObjectByAppName=function(app,name,val){return cm.setConfigValue(KEY,new function(){var _=this;_.setValue=function(config,val){return config.setValueByName(app,name,val)}},val)};_.getTypeByAppName=function(app,name){return cm.getConfigValue(KEY,new function(){var _=this;_.getValue=function(config){return config.getTypeByName(app,name)}})}};M.MiddlerConfig=function(){var _=this;V.inherit.apply(_,[V.config.Config,[]]);_.getValue=function(key){return key.getValue(_)};_.setValue=function(key,val){return key.setValue(_,val)};_.merge=function(config){if(config.data){_.data={};for(var i in config.data){_.data[i]=config.data[i]}}};_.getValueByName=function(app,name){if(_.data[app]&&_.data[app][name]){return _.data[app][name].getValue()}else{return null}};_.setValueByName=function(app,name,val){if(_.data[app]&&_.data[app][name]){return _.data[app][name].setValue(val)}else{return null}};_.getTypeByName=function(app,name){if(_.data[app]&&_.data[app][name]){return _.data[app][name].getType()}else{return null}}};M.MiddlerConfigConvert=function(){var _=this;var __={};V.inherit.apply(_,[V.config.ConfigConvert,[]]);__.scripts={},__.spascripts=[];__.loadScript=function(key){if(__.scripts[key]){console.log(key+"代码已经注入")}else{if(__.scripts._skey){console.log(__.scripts._skey+"已注册但是尚未有代码注入")}else{if(__.spascripts.length>0){__.scripts[key]=__.spascripts.pop()}else{__.scripts._skey=key}}}};__.clearload=function(){delete __.scripts._skey};__.getScript=function(key){return __.scripts[key]};V.registScript=__.registScript=function(func){if(__.scripts._skey){var key=__.scripts._skey;delete __.scripts._skey;__.scripts[key]=func}else{__.spascripts.push(func)}};_.needConfig=true;__.convertParas=function(config,params,defParam,app,pcm){var _=this;var paras=[];params=V.getValue(params,[]);for(var i in params){var val=params[i];if(typeof(val)=="object"){if(val.ref){var index=val.ref.indexOf("/")>=0?val.ref.indexOf("/"):val.ref.indexOf("\\")>=0?val.ref.indexOf("\\"):-1;var appName=index>=0?val.ref.substr(0,index):defParam.app;var name=appName?val.ref.substr(index+1):val.ref;paras.push({ref:appName,name:name})}else{if(val.type){var name=V.random()+"";app[name]=__.convertContainer(config,val,defParam,app,pcm);paras.push({ref:defParam.app,name:name})}else{if(val.path){var name=V.random()+"";app[name]=__.convertContainer(config,val,defParam,app,pcm);paras.push({ref:defParam.app,name:name})}else{if(val.self){paras.push(pcm)}else{if(val.middler){paras.push(new M.Middler(pcm))}else{if(val.params){var _v={params:val.params};for(var i in val){if(i!="params"){if(val[i].type){var name=V.random()+"";app[name]=__.convertContainer(config,val[i],defParam,app,pcm);_v[i]={ref:defParam.app,name:name}}else{if(val[i].ref){var index=val[i].ref.indexOf("/")>=0?val[i].ref.indexOf("/"):val[i].ref.indexOf("\\")>=0?val[i].ref.indexOf("\\"):-1;var appName=index>=0?val[i].ref.substr(0,index):defParam.app;name=appName?val[i].ref.substr(index+1):val[i].ref;_v[i]={ref:defParam.app,name:name}}else{_v[i]=val[i]}}}}paras.push(_v)}else{paras.push(val)}}}}}}}else{if(V.isArray(val)){var name=V.random()+"";app[name]=__.convertContainer(config,{params:val},defParam,app,pcm);paras.push({ref:defParam.app,name:name})}else{paras.push(val)}}}return new function(){var _=this;_.getParas=function(){var ret=[];for(var i in paras){var val=paras[i];if(val.ref){val=config.getValueByName(val.ref,val.name)}else{if(val.params){for(var i in val){if(i!="params"&&val[i].ref){val[i]=config.getValueByName(val[i].ref,val[i].name)}}}}ret.push(val)}return ret}}};__.convertCreater=function(config,v,defParam,app,pcm){var method=V.getValue(v.method,defParam.method);var path=V.getValue(v.path,defParam.path);var spapath=V.getValue(v.spapath,false);var host=V.getValue(v.host,defParam.host);var type=((V.isValid(v.type)&&v.type.indexOf(".")==0)?defParam.pack:"")+v.type;if(type=="undefined"&&!V.isValid(v.ref)){if(V.isValid(v.path)||V.isValid(v.spapath)){type=v.type=""+V.random()}else{if(V.isValid(v.params)){method="objects"}else{method="self"}}}var constructorparalength=V.getValue(v.constructorparalength,defParam.constructorparalength);var para=__.convertParas(config,v.params,V.merge(defParam,{path:path,pack:defParam.pack,host:host}),app,pcm);if(spapath){__.spaloadScript(type);__.clearload()}return new function(){var _=this;_.getType=function(){if(path){__.loadScript(type);V.each(path.split(";"),function(v){if(defParam.host&&v.toLowerCase().indexOf("../")<0&&v.toLowerCase().indexOf("http://")<0){v=defParam.host+v}V.include(v)},function(){__.clearload()},true)}var paras=para.getParas();return __.getScript(type)?__.getScript(type):eval("("+type+")")};_.getValue=function(){if(path){__.loadScript(type);V.each(path.split(";"),function(v){if(defParam.host&&v.toLowerCase().indexOf("../")<0&&v.toLowerCase().indexOf("http://")<0){v=defParam.host+v}V.include(v)},function(){__.clearload()},true)}else{if(spapath){__.spaloadScript(type)}}var paras=para.getParas();switch(method){case"self":return v;break;case"objects":return paras;break;default:case"constructor":return __.getScript(type)?V.create(__.getScript(type),paras):V.create2(type,paras);break;case"bean":var val=__.getScript(type)?V.create(__.getScript(type),[]):eval("(new "+type+"())");if(paras){for(var i in paras){if(typeof(paras[i])==="object"){if(paras[i].params&&val["set"+paras[i].params]){var me='(val["set'+paras[i].params+'"](w,paras[i][w]))';for(var w in paras[i]){if(w!="params"){eval(me)}}}else{val=V.merge(val,paras[i])}}}}return val;case"factory":return __.getScript(type)?__.getScript(type).apply(__.getScript(type),paras):eval("("+type+".apply("+type+",paras))");case"factorybean":var val=__.getScript(type)?__.getScript(type).apply(__.getScript(type),paras):eval("("+type+".apply("+type+",paras))");if(paras){var q=0;for(var i in paras){if((!constructorparalength||q>=constructorparalength)&&typeof(paras[i])==="object"){if(paras[i].params&&val["set"+paras[i].params]){var me='(val["set'+paras[i].params+'"](w,paras[i][w]))';for(var w in paras[i]){if(w!="params"){eval(me)}}}else{val=V.merge(val,paras[i])}}q++}}return val;case"constructorbean":var val=__.getScript(type)?V.create(__.getScript(type),paras):V.create2(type,paras);if(paras){var q=0;for(var i in paras){if((!constructorparalength||q>=constructorparalength)&&typeof(paras[i])==="object"){if(paras[i].params&&val["set"+paras[i].params]){var me='(val["set'+paras[i].params+'"](w,paras[i][w]))';for(var w in paras[i]){if(w!="params"){eval(me)}}}else{val=V.merge(val,paras[i])}}q++}}return val}}}};__.convertContainer=function(config,v,defParam,app,pcm){var mode=V.getValue(v.mode,defParam.mode);var size=V.getValue(v.size,defParam.size);var creater=__.convertCreater(config,v,defParam,app,pcm);var getType=function(){return creater.getType()};switch(mode){default:case"static":return new function(){var obj=null;var _=this;_.getType=getType;_.getValue=function(){if(obj==null){obj=creater.getValue()}return obj};_.setValue=function(val){if(obj===val){}else{val=null}}};break;case"instance":return new function(){var _=this;_.getType=getType;_.getValue=function(){return creater.getValue()};_.setValue=function(v){if(v.dispose){V.tryC(v.dispose)}}};break;case"pool":return new function(){var _=this;_.getType=getType;var pool=new V.collection.Pool(size,function(){return creater.getValue()});_.getValue=function(){return pool.getValue()};_.setValue=function(v){pool.setValue(v)}};break}};__.convertApp=function(config,v,app,pcm){var keys={method:"constructor",mode:"static",path:false,pack:false,constructorparalength:false,size:50,app:app,host:""};return new function(){var _=this;var defParam={};for(var i in keys){defParam[i]=V.getValue(v[i],keys[i])}defParam.app=app;for(var i in v){if(keys[i]||keys[i]==false){}else{_[i]=__.convertContainer(config,v[i],defParam,_,pcm)}}}};_.toConfig=function(val,pcm){var config=new M.MiddlerConfig();for(var i in val){var app=__.convertApp(config,val[i],i,pcm);config.data[i]=app}return config};_.toStrings=function(val){V.showException("Middler 不支持此操作")}};M.getMiddlerFromJS=function(type,path){return new M.Middler(V.config.getApplicationConfigManagerFromJS(type,path))};M.getMiddlerFromObj=function(obj){return new M.Middler(V.config.getApplicationConfigManagerFromObj(obj))};M.getObjectByAppName=function(cm,app,name){if(!V.middlers){V.middlers={}}if(!cm.randomid){cm.randomid=V.random();V.middlers[cm.randomid]=new M.Middler(cm)}return V.middlers[cm.randomid].getObjectByAppName(app,name)};M.getTypeByAppName=function(cm,app,name){if(!V.middlers){V.middlers={}}if(!cm.randomid){cm.randomid=V.random();V.middlers[cm.randomid]=new M.Middler(cm)}return V.middlers[cm.randomid].getTypeByAppName(app,name)}})(VJ,jQuery);(function(V,$){V.ni={};var N=V.ni;V.config.Configs=V.merge(V.config.Configs,{ConfigConverts:{Ni:{type:"VJ.ni.NiDataConfigConvert"}}});N.NiDataConfig=function(){var _=this,__={};V.inherit.apply(_,[V.config.Config,[]])};N.NiDataConfigConvert=function(){var _=this,__={};V.inherit.apply(_,[V.config.ConfigConvert,[]]);_.toConfig=function(val){var ret=new N.NiDataConfig();if(val){if(typeof(val)=="object"){for(var i in val){if(val[i]){ret.data[i]=VJ.merge({params:{}},val[i])}}}}return ret};_.toStrings=function(config){V.showException("VJ.ni.NiDataConfigConvert不支持此功能")}};N.NiTemplate=function(res,cm){var _=this,__={};_.lstCmd=[];_.KEY="Ni";_._addCommand=function(name,params,func){var cmd=cm.getConfigValue(_.KEY,name);var command=name;var template="";if(cmd){command=cmd.command;params=V.merge(cmd.params,V.getValue(params,{}));template=cmd.template}_.lstCmd.push({name:command,params:params,func:func,template:template,key:name,dbtype:(cmd&&cmd.dbtype)?cmd.dbtype:"tjson"})};_._excute=function(){var _cms=_.lstCmd;_.lstCmd=[];if(_cms.length>0){V.tryC(function(){var conn=res.getDBConnection();if(_cms.length>1){conn.transaction=true}var cmd=res.getDBCommand();cmd.connection=conn;V.whileC2(function(){return _cms.shift()},function(v,next){cmd.command=v.name;cmd.params=v.params;cmd.dbtype=v.dbtype;var _func=v.func;cmd.excute(_.result,function(data){V.tryC(function(){if(!data){data=false}_.result.add(data,v.key);if(_func){_func(_.result)}});next()})},function(){if(conn.transaction&&conn.commit){conn.commit()}res.backDBConnection(conn)})})}else{V.showException("不能调用空的命令对象!")}return _.result};_.result=new N.NiDataResult();_.transaction=false;_.excute=function(name,params,func){_._addCommand(name,params,func);if(!_.transaction){_.commit()}return _.result};_.commit=function(){return _._excute()}};N.NiTemplateManager=function(cm,appName){var _=this,__={};_.KEY=V.getValue(appName,"Ni");__.middler=new V.middler.Middler(cm);_.excute=function(tempName,name,params,func){var temp=__.middler.getObjectByAppName(_.KEY,tempName);if(temp){temp.excute(name,params,function(data){V.tryC(function(){if(func){func(data)}});__.middler.setObjectByAppName(_.KEY,tempName,temp)})}else{throw new Error("没有找到Template:"+tempName)}}};N.NiDataResult=function(){var _=this,__={};__.data={};__.kv={};__.datas=[];_.get=function(key){return __.data[key]?__.data[key]:__.kv[key]?__.kv[key][1]:null};_.add=function(data,name){if(data&&!__.kv[name]){__.data[__.datas.length]=data;__.kv[name]=[__.datas.length,data];__.datas.push(data)}else{if(__.kv[name]){var id=__.kv[name][0];__.data[id]=data;__.kv[name]=[__.datas.length,data];__.datas[id]=data}}};_.last=function(){return _.get(__.datas.length-1)};_.each=function(key,func){var val=_.get(key);if(val&&V.isArray(val)){V.each(val,func)}};_.clear=function(){__.datas=[];__.data={};__.kv={}};_.hasData=function(key){return key?(function(){var v=_.get(key);if(v){for(var k in v){return true}}return false})():(__.datas.length>0&&(function(){var hasData=false;V.each(__.datas,function(v){if(!hasData&&v){for(var k in v){hasData=true}}},null,true);return hasData})())}};N.NiDataResource=function(factory,params){var _=this,__={};_.fac=factory;_.params=V.getValue(params,{});_.getDBConnection=function(){var conn=_.fac.createDBConnection();conn.params=V.merge(conn.params,_.params);conn.params.resource=V.getValue(_.params.resource,conn.params.resource);if(!conn.isOpen){conn.open()}return conn};_.backDBConnection=function(conn){_.fac.backDBConnection(conn)};_.getDBCommand=function(){return _.fac.createDBCommand()}};N.NiInstanceDataResource=function(factory,params){var _=this;V.inherit.apply(_,[N.NiDataResource,[factory,params]])};N.NiStaticDataResource=function(factory,params){var _=this,__={};__.conn=null;V.inherit.apply(_,[N.NiDataResource,[factory,params]]);__.getDBConnection=_.getDBConnection;_.getDBConnection=function(){if(!__.conn){__.conn=__.getDBConnection()}return __.conn};_.backDBConnection=function(conn){if(conn!=__.conn){if(conn.isOpen&&conn.close){conn.close()}}}};N.NiPoolDataResource=function(factory,params,size){var _=this,__={};V.inherit.apply(_,[N.NiDataResource,[factory,params]]);__.getDBConnection=_.getDBConnection;size=V.getValue(size,50);__.pool=new VJ.collection.Pool(size,function(){var conn=__.getDBConnection();conn.dispose=conn.close;return conn});_.getDBConnection=function(){var val=__.pool.getValue();return val};_.backDBConnection=function(conn){__.pool.setValue(conn)}};N.NiDataFactory=function(){var _=this,__={};_.createDBConnection=function(){return new NiDataConnection()};_.createDBCommand=function(){return new N.NiDataCommand()};_.backDBConnection=function(conn){if(conn.isOpen){conn.close()}}};N.NiDataConnection=function(){var _=this,__={};_.isOpen=false;_.params={};_.open=function(){_.isOpen=true};_.close=function(){_.isOpen=false};_.invoke=function(cmd,func){func(false)}};N.NiDataCommand=function(){var _=this,__={};_.connection=null;_.command="";_.params={dbtype:"json"};_.excute=function(result,func){if(!_.connection||!_.connection.isOpen){V.showException("数据库未连接");if(func){func(false)}return}else{_.connection.invoke(_,function(data){try{var hasFalse=false;switch(typeof(data)){case"string":data=data.replace(/[\r\n]+/g,"");if(data.replace(/^(\[+\]+)/g,"").length===0){hasFalse=true}else{hasFalse=(data.toLowerCase().indexOf("[false")>=0?(data.toLowerCase().indexOf("[false:")>=0?(function(){var _data=data.toLowerCase().match(/\[false:[^\]]+\]/g);if(_data&&_data.length>0){return _data[0].substr(7,_data[0].length-8)}else{return true}})():true):false)}if(!hasFalse){try{data=eval("("+data.replace(/[\r\n]+/g,"")+")")}catch(e){console.log(data)}}break;case"object":if(data){$(data).each(function(i,v){v=v+"";hasFalse=(hasFalse||v=="False"||v=="false")})}else{hasFalse=true}break;case"undefined":default:V.showException("V.NiDataCommand success方法 name:typeof错误 type:"+data);hasFalse=true;break}if(hasFalse){data=(hasFalse==true?false:hasFalse)}else{switch(_.dbtype){default:case"json":break;case"tjson":data=V.evalTJson(data);break}}if(func){func(data)}}catch(e){V.showException("V._ajaxOption success方法",e);if(func){func(false)}}})}}};N.NiAjaxDataFactory=function(){var _=this,__={};V.inherit.apply(_,[N.NiDataFactory,[]]);__.AjaxConnection=function(){var _=this,__={};V.inherit.apply(_,[N.NiDataConnection,[]]);_.params=V.merge({host:"",dbtype:"json"},_.params);_.invoke=function(cmd,func){V.ajax(V.merge(_.params,{url:(cmd.command.indexOf("http:")>=0?"":_.params.host)+cmd.command,data:cmd.params,success:function(data,status){try{if(func){func(data)}}catch(e){V.showException("V._ajaxOption success方法",e)}},error:function(request,status,error){V.showException("V._ajaxOption error方法 status:"+status,error);if(func){func(false)}}}))}};_.createDBConnection=function(){return new __.AjaxConnection()};_.backDBConnection=function(){console.log("back conn")}};N.NiObjectDataFactory=function(){var _=this,__={};V.inherit.apply(_,[N.NiDataFactory,[]]);__.ObjectConnection=function(){var _=this,__={};V.inherit.apply(_,[N.NiDataConnection,[]]);_.params=V.merge({resource:{}},_.params);__.open=_.open;__.close=_.close;_.open=function(){switch(typeof(_.params.resource)){case"string":_.params.resource=eval("("+_.params.resource+")");break;case"object":if(V.isArray(_.params.resource)){throw new Error("不能使用数组作为资源")}break;default:throw new Error("N.NiObjectDataFactory 无法找到<"+_.params.resource+">对象");break}__.open()};_.close=function(){if(_.params.resource){delete _.params.resource}__.close()};_.invoke=function(cmd,func){try{var data=null;if(typeof(cmd.command)=="function"){data=cmd.command(_.params.resource,cmd.params)}else{data=eval("("+cmd.command+")(_.params.resource,cmd.params)")}if(typeof(data)=="function"){V.tryC(function(){if(func){data(func)}})}else{V.tryC(function(){if(func){func(data)}})}}catch(e){V.showException("V._ajaxOption success方法",e);if(func){func(false)}}}};_.createDBConnection=function(){return new __.ObjectConnection()}};N.NiSocketDataFactory=function(){var _=this,__={};V.inherit.apply(_,[N.NiDataFactory,[]]);var ws=window.WebSocket||window.MozWebSocket;if(!ws){throw new Error(V.userAgent.name+"不支持WebSocket!");return}__.SocketConnection=function(){var _=this,__={};V.inherit.apply(_,[N.NiDataConnection,[]]);_.params=V.merge({url:"",veshurl:""},_.params);__.open=_.open;__.close=_.close;__.conn=null;__.datas=[];__.senddatas=[];__.calls={};__.addData=function(data){__.datas.push(data);__.callback()};__.callback=function(){if(__.datas.length>0){V.whileC(function(){return __.datas.shift()},function(val){if(typeof(val)=="string"){val=eval("("+val+")")}if(val._id&&val.response){if(__.calls[val._id]){__.calls[val._id].datas.push(val.response)}else{__.calls[val._id]={datas:[],func:null,index:val._id};__.calls[val._id].datas.push(val.response)}__.callfunc(val._id)}else{V.showException("未找到消息处理者"+V.toJsonString(val))}})}};__.callfunc=function(index){var oCall=__.calls[index];if(oCall&&oCall.datas.length>0&&oCall.func){V.whileC(function(){return oCall.datas.shift()},function(val){oCall.func(val,oCall.index)},function(){})}};__.addCalls=function(cmd,func){var index=cmd.params._id?cmd.params._id:V.random();if(!__.calls[index]){__.calls[index]={datas:[],func:func,index:index}}else{if(cmd.params._id){}else{__.calls[index].func=func}}var val={_id:index,request:{}};val.request[cmd.command]=cmd.params;__.senddatas.push(V.toJsonString(val));__.callsend()};__.callsend=function(){if(_.isOpen){V.whileC(function(){return __.senddatas.shift()},function(v){__.conn.send(v)})}};_.open=function(){if(!_.isOpen&&!__.conn){__.conn=new ws(_.params.url);__.conn.onopen=function(){_.isError=false;__.open();__.conn.send(V.toJsonString({cookies:document.cookie}));__.callsend()};__.conn.onclose=function(){__.close();__.conn=null;if(_.params.reopen){V.once(_.open,1000)}};__.conn.onmessage=function(evt){try{_.isError=false;if(evt.data){__.addData(evt.data)}}catch(e){V.showException("VJ.ni.NiSocketDataFactory.onmessage",e)}};__.conn.onerror=function(e){try{if(!_.isError&&(e.currentTarget.readyState==2||e.currentTarget.readyState==3)&&_.params.veshurl){V.ajax({url:_.params.veshurl,jsonp:_.params.jsonp,data:{},success:function(data,status){try{console.log("--------------------------------------------");console.log(data);_.open()}catch(e){V.showException("V._ajaxOption success方法",e)}},error:function(request,status,error){V.showException("V._ajaxOption error方法 status:"+status,error);if(func){func(false)}}})}else{__.addData(false)}_.isError=true;__.conn=null;V.showException("VJ.ni.NiSocketDataFactory.onerror:"+V.toJsonString(e))}catch(e){V.showException("VJ.ni.NiSocketDataFactory.onerror",e)}}}};_.close=function(){_.params.reopen=false;__.conn.close()};_.invoke=function(cmd,func){try{__.addCalls(cmd,func)}catch(e){V.showException("V._ajaxOption success方法",e);if(func){func(false)}}}};__.SocketCommand=function(){var _=this,__={};V.inherit.apply(_,[N.NiDataCommand,[]]);_.excute=function(result,func){if(!_.connection||_.connection.isError){V.showException("WebSocket连接失败");if(func){func(false)}return}else{_.connection.invoke(_,function(data,_id){try{var hasFalse=false;switch(typeof(data)){case"string":data=data.replace(/[\r\n]+/g,"");if(data.replace(/^(\[+\]+)/g,"").length===0){hasFalse=true}else{hasFalse=(data.toLowerCase().indexOf("[false")>=0?(data.toLowerCase().indexOf("[false:")>=0?(function(){var _data=data.toLowerCase().match(/\[false:[^\]]+\]/g);if(_data&&_data.length>0){return _data[0].substr(7,_data[0].length-8)}else{return true}})():true):false)}if(!hasFalse){data=eval("("+data.replace(/[\r\n]+/g,"").replace(/\\"/g,'"')+")")}break;case"object":if(data){$(data).each(function(i,v){v=v+"";hasFalse=(hasFalse||v=="False"||v=="false")})}else{hasFalse=true}break;case"undefined":default:V.showException("V.NiSocketDataCommand success方法 name:typeof错误 type:"+(data));hasFalse=true;break}if(result.firstregist){result.firstregist=false}if(hasFalse){data=false}else{if(data._regist){result.firstregist=true;data=false}else{switch(_.dbtype){default:case"json":break;case"tjson":data=V.evalTJson(data);break}}}result._id=_id;if(func){var val=func(data,_id);if(val&&val.close){__.conn.close()}}}catch(e){V.showException("V.ni.NiSocketCommand invoke方法",e);if(func){func(false)}}})}}};_.createDBConnection=function(){return new __.SocketConnection()};_.backDBConnection=function(){console.log("back conn")};_.createDBCommand=function(){return new __.SocketCommand()}};N.NiSqliteDataFactory=function(){var _=this,__={};V.inherit.apply(_,[N.NiDataFactory,[]]);__.SqliteConnection=function(){var _=this,__={};V.inherit.apply(_,[N.NiDataConnection,[]]);_.params=V.merge(_.params,{name:"",version:"1.0",desc:"",size:2*1024*1024});__.open=_.open;__.close=_.close;_.open=function(){if(!_.isOpen){if(openDatabase){__.conn=openDatabase(_.params.name,_.params.version,_.params.desc,_.params.size);__.open()}else{V.showException(V.userAgent.name+"不支持WebDB!")}}};_.close=function(){delete __.conn;__.close()};_.invoke=function(cmd,func){if(!_.isOpen||!__.conn){throw new Error("数据库连接已关闭")}V.tryC(function(){var cms=cmd.command.split(";");var params=V.getValue(cmd.params.data,[]);if((cmd.command.split("?").length-1)!=params.length){V.showException(cmd.command+"参数数目与输入值数目不符!!");if(func){func(false)}}var w=0;var ret=[];var cmslength=cms.length-1;V.whileC(function(){var command=cms.shift();return""==command?null:command},function(command){var _w=command.split("?").length-1;var p=params.slice(w,w+_w);w+=_w;__.conn.transaction(function(tx){tx.executeSql(command,p,function(tran,data){var i=-1;var _data=[];V.whileC(function(){i++;return i<data.rows.length?data.rows.item(i):null},function(v){_data.push(V.merge({},v))},function(){ret.push(_data);if(ret.length>=cmslength){if(func){func(ret)}}},true)},function(tran,error){console.log(error);V.showException(error);if(func){func(false)}})})},function(){},true)})}};_.createDBConnection=function(){return new __.SqliteConnection()}};N.NiTemplateDecorator=function(res,cacheres,cm,params){var _=this,__={};V.inherit.apply(_,[N.NiTemplate,[res,cm]]);_.KEY="Ni";__._addCommand=_._addCommand;__._excute=_._excute;_.lstCmd2={};__.params=V.getValue(params,{});_.setCommand=function(res,params){params=V.merge(__.params,params);try{res[params.cacheKey]=V.toJsonString({data:params.cacheValue,date:(params.timeout?new Date().add(params.timeout.interval,params.timeout.number).getTime():false)})}catch(error){console.log("localStorage可能不被支持")}return null};_.clearCommand=function(res,params){if(res.removeItem){res.removeItem(params.cacheKey,null)}else{if(res[params.cacheKey]){delete res[params.cacheKey]}}return null};_.cacheCommand=function(res,params){var val=null;if(res[params.cacheKey]){val=V.json(res[params.cacheKey])}if(val){if(val.date){if(parseFloat(val.date)<new Date().getTime()){delete res[params.cacheKey];return null}}return val.data}else{return null}};_._addCommand=function(name,params,func){var index=_.lstCmd.length;__._addCommand(name,params,func);if(_.lstCmd.length!=index){var command=null;var cmd=cm.getConfigValue(_.KEY,name+".Cache");if(!cmd){cmd=cm.getConfigValue(_.KEY,name+".Clear");if(cmd){command=V.getValue(cmd.command,_.clearCommand)}}else{command=V.getValue(cmd.command,_.cacheCommand)}if(cmd){_.lstCmd2[index]={name:command,key:name,params:V.merge(_.lstCmd[_.lstCmd.length-1].params,{cacheKey:V.hash(name+".Set."+V.toJsonString(_.lstCmd[_.lstCmd.length-1].params))})}}}};_._excute=function(){var _cms=_.lstCmd;_.lstCmd=[];if(_cms.length>0){V.tryC(function(){var conn=res.getDBConnection();var cmd=res.getDBCommand();cmd.connection=conn;var i=0;var func=function(v,next){cmd.command=v.name;cmd.params=v.params;cmd.dbtype=v.dbtype;var _func=v.func;cmd.excute(_.result,function(data){V.tryC(function(){if(!data){data=false}_.result.add(data,v.key);if(_func){V.tryC(function(){_func(_.result)})}});if(data&&data.length>0&&!(data.length==1&&data[0].length==0)){var _nicmd=cm.getConfigValue(_.KEY,v.key+".Set");if(_nicmd){var _conn=cacheres.getDBConnection();var _cmd=cacheres.getDBCommand();_cmd.connection=_conn;_cmd.command=V.getValue(_nicmd.command,_.setCommand);_cmd.params=V.merge(_nicmd.params,cmd.params,{cacheKey:V.hash(v.key+".Set."+V.toJsonString(cmd.params)),cacheValue:data});_cmd.excute(_.result,function(data){V.tryC(function(){cacheres.backDBConnection(_conn)})})}}i++;next()})};V.whileC2(function(){return _cms.shift()},function(v,next){var _nicmd=_.lstCmd2[i];if(_nicmd){i++;var _conn=cacheres.getDBConnection();var _cmd=cacheres.getDBCommand();_cmd.connection=_conn;_cmd.command=_nicmd.name;_cmd.params=V.merge(_nicmd.params,v.params);_cmd.excute(_.result,function(data){V.tryC(function(){try{cacheres.backDBConnection(_conn)}catch(e){}if(!data){data=false}if(data){_.result.add(data,v.key);if(v.func){V.tryC(function(){v.func(_.result)})}next()}else{func(v,next)}})})}else{i++;func(v,next)}},function(){res.backDBConnection(conn)})})}else{V.showException("不能调用空的命令对象!")}return _.result}};N.NiLazyTemplateDecorator=function(res,cacheres,cm,params){var _=this,__={};__.lazyExp=V.getValue(params.lazyExp,function(p){return true});params=VJ.merge({},params);if(params&&params.lazyExp){delete params.lazyExp}V.inherit.apply(_,[N.NiTemplateDecorator,[res,cacheres,cm,params]]);_._excute=function(){var _cms=_.lstCmd;_.lstCmd=[];if(_cms.length>0){V.tryC(function(){var conn=res.getDBConnection();var cmd=res.getDBCommand();cmd.connection=conn;var i=0;var func=function(v){cmd.command=v.name;cmd.params=v.params;cmd.dbtype=v.dbtype;var _func=v.func;cmd.excute(_.result,function(data){V.tryC(function(){if(!data){data=false}_.result.add(data,v.key);if(_func){V.tryC(function(){_func(_.result)})}});if(data&&data.length>0&&!(data.length==1&&data[0].length==0)&&__.lazyExp(v.params)){var _nicmd=cm.getConfigValue(_.KEY,v.key+".Set");if(_nicmd){var _conn=cacheres.getDBConnection();var _cmd=cacheres.getDBCommand();_cmd.connection=_conn;_cmd.command=V.getValue(_nicmd.command,_.setCommand);_cmd.params=V.merge(_nicmd.params,cmd.params,{cacheKey:V.hash(v.key+".Set."+V.toJsonString(cmd.params)),cacheValue:data});_cmd.excute(_.result,function(data){V.tryC(function(){cacheres.backDBConnection(_conn)})})}}})};V.whileC2(function(){return _cms.shift()},function(v,next){var _nicmd=_.lstCmd2[i];if(_nicmd&&__.lazyExp(v.params)){i++;var _conn=cacheres.getDBConnection();var _cmd=cacheres.getDBCommand();_cmd.connection=_conn;_cmd.command=_nicmd.name;_cmd.params=V.merge(_nicmd.params,v.params);_cmd.excute(_.result,function(data){V.tryC(function(){try{cacheres.backDBConnection(_conn)}catch(e){}if(!data){data=false}if(data){_.result.add(data,v.key);if(v.func){V.tryC(function(){v.func(_.result)})}}func(v,next)})})}else{i++;func(v,next)}},function(){res.backDBConnection(conn)})})}else{V.showException("不能调用空的命令对象!")}return _.result}};N.NiMultiTemplateDecorator=function(res,cm,relcm,appName){var _=this,__={};V.inherit.apply(_,[N.NiTemplate,[res,cm]]);_.KEY=V.getValue(appName,"Ni");__.ni=new N.NiTemplateManager(relcm,_.KEY);__._addCommand=_._addCommand;__._excute=_._excute;__.lstCmd={};_._addCommand=function(name,params,func){var index=_.lstCmd.length;__._addCommand(name,params,func);if(_.lstCmd.length!=index){var cmd=_.lstCmd[_.lstCmd.length-1];if(cmd.template){__.lstCmd[index]=true}}};_._excute=function(){var _cms=_.lstCmd;_.lstCmd=[];if(_cms.length>0){V.tryC(function(){var conn=res.getDBConnection();var cmd=res.getDBCommand();cmd.connection=conn;var i=0;var func=function(v,next){cmd.command=v.name;cmd.params=v.params;var _func=v.func;cmd.excute(_.result,function(data){V.tryC(function(){if(!data){data=false}_.result.add(data,v.key);if(_func){_func(_.result)}});next()})};var _cms2=__.lstCmd;__.lstCmd=[];V.whileC2(function(){return _cms.shift()},function(_v,next){var v=_v;if(_cms2[i]){i++;__.ni.excute(v.template,v.key,v.params,function(result){V.tryC(function(){var data=result.get(v.key);_.result.add(data,v.key);if(v.func){v.func(_.result)}});next()})}else{i++;func(v,next)}},function(){res.backDBConnection(conn);_cms2=null})})}else{V.showException("不能调用空的命令对象!")}return _.result}}})(VJ,jQuery);(function(V,$){V.viewmodel={APP:"VESH.viewmodel",NIAPP:"Ni"};var M=V.viewmodel;V.view={APP:"VESH.view"};var W=V.view;M.Control=function(){var _=this,__={};_.bind=function(view){_.v=view;_.config=_.v.config;_.middler=_.v.middler;_.ni=_.v.ni;_.session=_.v.session};_.data=V.getValue(_.data,{})};var WTemplates={};W.getTemplate=function(path,func){if(!V.isValid(path)||V.getType(path)!="string"){throw new Error("控件模板不能为空或者非字符串!")}if(!WTemplates[path]){WTemplates[path]=new function(){var _=this,__={};__.funs=[];__.node=$('<div style="display:none;"></div>').appendTo(window.document.body);_.addCallback=function(fun){if(__.template){fun($(__.template))}else{if(fun){__.funs.push(fun)}}};_.callback=function(){V.whileC(function(){return __.funs.shift()},function(v){v($(__.template))},function(){})};if(path.indexOf("<")>=0){__.node.append(path);__.template=__.node[0].innerHTML;__.node.remove()}else{__.node.load(path,function(){__.template=__.node[0].innerHTML;__.node.remove();_.callback()})}}}WTemplates[path].addCallback(func)};W.Action=function(){this.go=function(node,func){if(func){func()}}};W.CssAction=function(css){var __={};V.inherit.apply(this,[W.Action,[]]);__.go=this.go;__.css=V.getValue(css,"");this.go=function(node,func){if(V.isValid(__.css)){node=$(node);node.css("animation",css).css("-webkit-animation",css).css("-webkit-animation-play-state","running").css("-moz-animation",css).css("-moz-animation-play-state","running").css("-o-animation",css).css("-o-animation-play-state","running");node.one("webkitAnimationEnd",function(){node.css("-webkit-animation","").css("-moz-animation","").css("-o-animation","");if(func){func()}});node.one("mozAnimationEnd",function(){node.css("-webkit-animation","").css("-moz-animation","").css("-o-animation","");if(func){func()}});node.one("MSAnimationEnd",function(){node.css("-webkit-animation","").css("-moz-animation","").css("-o-animation","");if(func){func()}});node.one("oanimationend",function(){node.css("-webkit-animation","").css("-moz-animation","").css("-o-animation","");if(func){func()}});node.one("animationend",function(){node.css("-webkit-animation","").css("-moz-animation","").css("-o-animation","");if(func){func()}})}}};W.Control=function(path,params){var _=this,__={};_.path=path;_.vm=null;_.events={};_.params=V.getValue(params,{});__.desc="";_.addDesc=function(d){__.desc+=(d+"\r\n")};_.desc=function(){console.log(__.desc+"VJ.view.Control\r\n数据定义：\r\npath:html模板定义\r\nvm:虚拟控件对象\r\nevents:事件对象\r\nparams:默认参数对象\r\n")};_.init=function(parent,node,params){_.parent=parent;_.config=_.parent.config;_.middler=_.parent.middler;_.ni=_.parent.ni;_.session=_.parent.session;_.node=node;_.params=V.merge(_.params,{data:V.getValue(params,{})})};_.bind=function(vm){_.vm=V.merge(_.params,V.getValue(vm,{data:{}}));V.forC(_.vm,function(k,v){vm[k]=v;if(k.toLowerCase().indexOf("on")==0){_.events[k.toLowerCase().substring(2)]=v}},function(){_.vm=vm},true);_.get=function(){return _.vm.data};_.vm.nodeName=_.nodeName;_.vm.update=function(){var as=Array.prototype.slice.call(arguments);as=V.getValue(as,[null]);if(as[0]){V.merge(_.vm.data,as[0],true)}as[0]=as[0]?as[0]:V.merge({},_.vm.data);_.render.apply(_,as)};_.vm.call=function(){_.call.apply(_.parent.vms,arguments)};_.vm.add=function(){_.addControl.apply(_,arguments)};_.vm.desc=function(){_.desc()};_.vm.get=function(key){_.vm.data=V.merge(_.vm.data,_.fill());return key?_.vm.data[key]:_.vm.data};_.vm.bind(_);if(_.path){W.getTemplate(_.path,function(node){_.replaceNode(node);_.onLoad(node)})}else{_.node.show();_.onLoad(_.node)}};_.onLoad=function(node){_.render(_.vm.data);_.call("load")};_.fill=function(){return{}};_.render=function(data){V.forC(data,function(key,value){switch(key){case"dispose":if(value){_.dispose()}break;case"attr":V.forC(value,function(key2,value2){_.node.attr(key2,value2)},function(){});break;case"enable":if(value){_.node.removeAttr("disabled")}else{_.node.attr("disabled","disabled")}break;case"invisible":if(value){_.node.children().show()}else{_.node.children().hide()}break;case"visible":if(value){_.node.show()}else{_.node.hide()}break;case"addclass":_.node.addClass(value);break;case"removeclass":_.node.removeClass(value);break;case"animate":if(typeof(value)=="string"){_.animate(value)}else{var ret=[];V.forC(value,function(k2,v2){ret.push([k2,v2])},function(){var i=0;var _f=function(){var v2=ret[i];i++;_.animate(v2[0],function(){if(typeof(v2[1])=="function"){V.tryC(function(){v2[1]()})}if(i<ret.length){_f()}})};_f()})}break;case"globalposition":if(_.node.attr("position")){V.showException("W.Control.data.postion 不允许重复设置!"+_.node.attr("position"))}else{_.node.attr("position",value.toLowerCase());_.node.css("position","absolute");var parent=$(window);switch(value.toLowerCase()){case"top":parent.scroll(function(){_.node.css("top",document.body.scrollTop+"px")});_.node.css("top",document.body.scrollTop+"px");break;case"bottom":parent.scroll(function(){console.log(document.body.scrollTop+":"+$(window).height()+":"+_.node.height()+":"+(document.body.scrollTop+$(window).height()-_.node.height()));_.node.css("top",(document.body.scrollTop+$(window).height()-_.node.height())+"px")});_.node.css("top",(document.body.scrollTop+$(window).height()-_.node.height())+"px");break}}break;case"position":if(_.node.attr("position")){V.showException("W.Control.data.postion 不允许重复设置!"+_.node.attr("position"))}else{_.node.attr("position",value.toLowerCase());_.node.css("position","absolute");var parent=_.node.parent();switch(value.toLowerCase()){case"top":parent.scroll(function(){console.log("scroll");_.node.css("top",parent.get(0).scrollTop+"px")});_.node.css("top",parent.get(0).scrollTop+"px");break;case"bottom":parent.scroll(function(){_.node.css("top",(parent.get(0).scrollTop+$(document).height()-_.node.height())+"px")});_.node.css("top",(parent.get(0).scrollTop+$(document).height()-_.node.height())+"px");break}}break;case"valid":V.merge(_.get(),_.fill(),true);if(_.valid){_.valid(data.value||_.get().value,value)}else{if(value){value()}}break;case"show":_.vm.data.visible=true;_.animate(value,function(){});V.once(function(){_.node.show()},1);break;case"hide":_.animate(value,function(){_.node.hide();_.vm.data.visible=false});break;case"desc":_.desc();break}});return data};_.bindEvent=function(node,k,v){node=$(node);if(typeof(node[k])=="function"){node[k](function(e){if(node.parents("[disabled]").length>0){return}_.call(k,{e:e})})}};_.initControls=function(vm,node){if(vm.controls||node.find("[_]").length>0){var cons=V.getValue(vm.controls,{});_.controls=[];_.vs={};_.vms=cons;_.models=_.vms;var p=node.find("[_]").toArray();V.each(p,function(v1){var v=$(v1);var id=v.attr("id");var json=eval("({"+v.attr("_")+"})");var type=json.type?json.type:(id&&cons[id]&&cons[id].type)?cons[id].type:null;var nodeName=type?type.toLowerCase():v[0].nodeName.toLowerCase();var obj=_.middler.getObjectByAppName(W.APP,nodeName);if(!obj){V.showException("配置文件中没有找到对象类型定义:"+nodeName)}obj.init(_,v,V.isValid(v.attr("_"))?json:null);obj.page=_.page;_.controls.push(obj);if(!id){id=nodeName+V.random()}obj.nodeName=nodeName;if(!cons[id]){cons[id]={data:{}}}_.vs[id]=obj;V.inherit.apply(cons[id],[M.Control,[]]);obj.bind(cons[id])},function(){V.forC(cons,function(key,v){if(v.type&&!v.v){var obj=_.middler.getObjectByAppName(W.APP,v.type);if(!obj){throw new Error("配置文件中没有找到对象类型定义:"+v.type)}var node2=V.newEl("div");node.append(node2);obj.init(_,node2,null);obj.page=_.page;_.controls.push(obj);_.vs[key]=obj;V.inherit.apply(v,[M.Control,[]]);obj.bind(v)}},function(){})},true)}};_.replaceNode=function(node){node=$(node);var attrs=_.node[0].attributes;if(attrs){var i=attrs.length;V.whileC(function(){i--;return i>=0?{key:attrs[i].name,val:attrs[i].value}:null},function(v){var n=v.key.toLowerCase()=="id"?$(node[0]):node;if(n.length>1){for(var i=0;i<n.length;i++){var _n=$(n[i]);if(V.isValid(v.val)&&v.val!="false"){_n.attr(v.key,((V.isValid(_n.attr(v.key))&&_n.attr(v.key)!=v.val)?_n.attr(v.key)+" ":"")+v.val)}}}else{if(V.isValid(v.val)&&v.val!="false"){n.attr(v.key,((V.isValid(n.attr(v.key))&&n.attr(v.key)!=v.val)?n.attr(v.key)+" ":"")+v.val)}}},function(){},true)}_.initControls(_.vm,node);node.append(_.node.children());if(_.node[0].nodeName.toLowerCase()=="body"){_.node.empty().append(node)}else{_.node.after(node).remove()}_.node=node};_.validate=function(input){if(_.middler){var obj=_.middler.getObjectByAppName(W.APP,"ValidateManager");if(obj){obj.validate(_,input)}}};_.call=function(name,param){if(param){V.merge(_.vm.data,param,true)}V.merge(_.vm.data,_.fill(),V.getValue(param,{}),true);name=name.toLowerCase();if(_.events[name]){V.once(function(){var val=_.events[name].apply(_.parent.vms,[_.vm.data,_.vm]);if(val&&val!={}){V.merge(_.vm.data,val,true);_.render(val)}})}};_.animate=function(name,func){_._animate(name,null,func)};_._animate=function(name,node,func){name=name||"";var action=_.middler.getObjectByAppName(W.APP,name);if(action){action.go(node?node:_.node,func||null)}};_.onError=function(text){_.get().isError=true;_.call("error",{error:text})};_.onClearError=function(){_.call("clearerror")};_.onSuccess=function(){delete _.get().isError;_.call("success")};_.dispose=function(){V.tryC(function(){_.call("dispose");_.clearControl()});_.node.remove()};_.addControl=function(node,v){if(!_.controls){_.controls=[];_.vs={};_.vms={};_.models=_.vms}var obj=_.middler.getObjectByAppName(W.APP,v.type);if(!obj){throw new Error("配置文件中没有找到对象类型定义:"+v.type)}node=node?node:V.newEl("div").appendTo(_.node);obj.init(_,node,v);obj.page=_.page;_.controls.push(obj);var key=V.getValue(v.id,V.random());if(_.vs[key]){V.showException("控件id为"+id+"的子控件已经存在，请更换id名");return}_.vs[key]=obj;V.inherit.apply(v,[M.Control,[]]);_.vms[key]=v;obj.bind(v);return v};_.removeControl=function(id){delete _.vms[id];if(_.vs[id]){var val=_.vs[id];delete _.vs[id];_.controls=$.grep(_.controls,function(v,i){return v!=val});if(val){val.dispose()}}};_.clearControl=function(){if(_.controls){var vs=_.vs;var div=$('<div style="display:none;"></div>').appendTo(window.document.body);_.node.children().appendTo(div);V.forC(vs,function(k,v){v.dispose()},function(){div.remove()})}_.controls=[];_.vs={};_.vms={};_.models=_.vms}};M.Page=function(cm,data){var _=this,__={};_.vms=V.getValue(data,{});_.models=_.vms;V.inherit.apply(_,[M.Control,[]]);_.page=_.vms.page?_.vms.page:{};_.data=_.page.data?_.page.data:{};if(cm){switch(V.getType(cm)){case"object":case"Object":if(cm.getConfigValue){_.config=cm}else{_.config=V.config.getApplicationConfigManagerFromObj(cm)}break;case"string":cm=eval("("+cm+")");_.config=V.config.getApplicationConfigManagerFromObj(cm)}}else{_.config=V.config.getApplicationConfigManagerFromObj()}_.middler=new V.middler.Middler(_.config);_.ni=new V.ni.NiTemplateManager(_.config,M.NIAPP);_.session=_.middler.getObjectByAppName(M.APP,"SessionDataManager");_.hasRight=function(name,isAdmin){if(V.getValue(isAdmin,false)&&(typeof(User)=="undefined"||!V.isValid(User))){return false}if(User){if(!V.isValid(Pers)){V.showException("permission.js不存在");return false}var id=V.getValue(Pers[name],"_");return(V.getValue(User.PIDS,"").indexOf(","+id+",")>=0)}return false};_.getModels=function(id){return id?(_.vms[id]?_.vms[id]:null):_.vms};_.setModels=function(id,v){_.vms[id]=v};__.bind=_.bind;_.bind=function(view){__.bind(view);_.page.v=view};var _page=_.middler.getObjectByAppName(W.APP,"page");if(!_page){throw new Error("没有找到page对应的页面view层对象")}_page.ready(function(){_page.init(_,$(document.body));_page.bind(_)})};W.Page=function(path){var _=this,__={};V.inherit.apply(_,[W.Control,[path]]);_.vs={};_.controls=[];__.render=_.render;__.onLoad=_.onLoad;__.dispose=_.dispose;_.bind=function(page){var vm=page.page;_.page=page;if(vm){_.vm=vm;_.vm.data=V.merge(_.params,V.getValue(_.vm.data,{}));_.vm.update=function(){var as=Array.prototype.slice.call(arguments);as=V.getValue(as,[null]);if(as[0]){V.merge(_.vm.data,as[0],true)}as[0]=as[0]?as[0]:V.merge({},_.vm.data);_.render.apply(_,as)};_.vm.call=function(){_.call.apply(_.page.getModels(),arguments)};_.vm.add=function(){_.addControl.apply(_,arguments)};_.vm.desc=function(){_.desc()};_.vm.get=function(key){_.vm.data=V.merge(_.vm.data,_.fill());return key?_.vm.data[key]:_.vm.data};V.forC(vm,function(key,value){key=key.toLowerCase();if(key.indexOf("on")==0){_.events[key.substring(2)]=value}},function(){page.bind(_)},true)}else{_.vm={data:V.merge(_.params,{})}}_.vms=_.page.vms;_.models=_.vms;if(_.path){W.getTemplate(_.path,function(node){_.replaceNode(node);_.onLoad(node)})}else{_.node.show();_.onLoad(_.node)}_.middler=page.middler;_.ni=page.ni;_.session=page.session;_.config=page.config};_.dispose=function(){_.session.updateAll();_.call("dispose");_.clearControl();$("body").empty();window.close()};_.ready=function(func){$(function(){func();_.bindControl(_.node)});window.onbeforeunload=_.dispose};_.onReady=function(){};_.call=function(name,param){if(param){V.merge(_.vm.data,param,true)}V.merge(_.vm.data,_.fill(),V.getValue(param,{}),true);name=name.toLowerCase();if(_.events[name]){V.once(function(){var val=_.events[name].apply(_.page.getModels(),[_.vm.data,_.vm]);if(val&&val!={}){V.merge(_.vm.data,val,true);_.render(val)}})}};_.bindControl=function(node){var p=node.find("[_]").toArray();V.whileC(function(){return p.shift()},function(v1){var v=$(v1);var id=v.attr("id");var json=eval("({"+v.attr("_")+"})");var type=json.type?json.type:(id&&_.page.getModels(id)&&_.page.getModels(id).type)?_.page.getModels(id).type:null;var nodeName=type?type.toLowerCase():v[0].nodeName.toLowerCase();var obj=_.middler.getObjectByAppName(W.APP,nodeName);if(!obj){V.showException("配置文件中没有找到对象类型定义:"+nodeName)}obj.init(_,v,V.isValid(v.attr("_"))?json:null);obj.page=_;if(!id){id=nodeName+V.random()}obj.nodeName=nodeName;if(!_.page.getModels(id)){_.page.setModels(id,{data:{}})}_.vs[id]=obj;V.inherit.apply(_.page.getModels(id),[M.Control,[]]);obj.bind(_.page.getModels(id))},function(){V.forC(_.page.getModels(),function(key,v){if(v.type&&!v.v){var obj=_.middler.getObjectByAppName(W.APP,v.type);if(!obj){throw new Error("配置文件中没有找到对象类型定义:"+v.type)}var node2=V.newEl("div");node.append(node2);obj.init(_,node2,null);obj.page=_;_.controls.push(obj);_.vs[key]=obj;V.inherit.apply(v,[M.Control,[]]);obj.bind(v)}},function(){_.onReady();_.call("start")},true)})};_.addControl=function(node,v){var obj=_.middler.getObjectByAppName(W.APP,v.type);if(!obj){throw new Error("配置文件中没有找到对象类型定义:"+v.type)}node=node?node:V.newEl("div").appendTo(_.node);obj.init(_,node,v);obj.page=_;_.controls.push(obj);var key=V.getValue(v.id,V.random());if(_.vs[key]){V.showException("控件id为"+id+"的控件已经存在，请更换id名");return}_.vs[key]=obj;V.inherit.apply(v,[M.Control,[]]);_.vm.vms[key]=v;obj.bind(v);return v};_.removeControl=function(id){delete _.vm.vms[id];if(_.vs[id]){var val=_.vs[id];delete _.vs[id];_.controls=$.grep(_.controls,function(v,i){return v!=val});if(val){val.dispose()}}};_.clearControl=function(){if(_.controls){var vs=_.vs;var div=$('<div style="display:none;"></div>').appendTo(window.document.body);_.node.children().appendTo(div);V.forC(vs,function(k,v){v.dispose()},function(){div.remove()},true)}_.controls=[];_.vs={};_.vm.vms={};_.models=_.vm.vms};_.onLoad=function(node){V.forC(_.events,function(k,v){switch(k){case"resize":$(window).resize(function(){V.userAgent.refresh();_.call("resize",{height:V.userAgent.height,width:V.userAgent.width})});break;default:_.bindEvent(node,k,v);break}},function(){__.onLoad(node)},true)};_.render=function(data){data=__.render(data);V.forC(data,function(key,value){switch(key){case"title":document.title=value;if(data!=_.vm.data){delete data[key]}break;case"close":_.dispose();break}});return data}};M.SessionDataManager=function(ada){var _=this,__={};__.ada=ada;__.data={};if(!__.ada){throw new Error("SessionDataManager 需要设置SessionDataAdapter")}_.get=function(name){if(!__.data[name]){__.data[name]={};__.data[name]=__.ada.fill(name)}return __.data[name]};_.data=_.get;_.update=function(name,data){__.data[name]=V.merge(_.data(name),V.getValue(data,{}));__.ada.update(__.data[name],name)};_.clear=function(name){__.ada.clear(name)};_.updateAll=function(){var ret=[];for(var i in __.data){ret.push({key:i,value:__.data[i]})}V.whileC(function(){ret.shift()},function(v){_.update(v.key,v.value)},function(){},true)};_.isLogin=function(){return false}};M.SessionDataAdapter=function(resource){var _=this,__={};__.resource=resource;__.ress={};_.setResource=function(name,res){__.ress[name]=res};_.getResource=function(name){return __.ress[name]?__.ress[name]:__.resource};_.fill=function(name){return V.getValue(_.getResource(name).load(name),{})};_.update=function(data,name){_.getResource(name).save(name,V.getValue(data,{}))};_.clear=function(name){_.getResource(name).clear(name)}};M.SessionDataResource=function(){var _=this,__={};_.load=function(name){return""};_.save=function(name,data){};_.clear=function(name){}};M.SessionDataResourceDecorator=function(){var _=this,__={};V.inherit.apply(_,[M.SessionDataResource,[]]);__.res=Array.prototype.slice(arguments,0);console.log(__.res);_.load=function(name){var val=undefined;V.each(__.res,function(v){try{val=val?val:v.load(name)}catch(e){}},null,true);return val};_.save=function(name,data){V.each(__.res,function(v){try{v.save(name,data)}catch(e){}})};_.clear=function(name){V.each(__.res,function(v){try{v.clear(name)}catch(e){}})}};M.CookieDataResource=function(param){var _=this,__={};V.inherit.apply(_,[M.SessionDataResource,[]]);if(!$.cookie){V.include("ref/jquery.cookie.js")}if(!$.cookie){V.showException("下载不到jquery.cookie.js")}__.param=V.getValue(param,{});_.load=function(name){var val=$.cookie(name);var data={};if(val){var args=decodeURIComponent(val).replace(/\+/g," ").split("&");if(args.length==1&&args[0].indexOf("{")==0){return eval("("+args[0]+")")}else{for(var i=0;i<args.length;i++){var pair=args[i].split("=");var name=decodeURIComponent(pair[0]);var value=(pair.length==2)?decodeURIComponent(pair[1]):name;data[name]=value}return data}for(var i=0;i<args.length;i++){var pair=args[i].split("=");var name=decodeURIComponent(pair[0]);var value=(pair.length==2)?decodeURIComponent(pair[1]):name;data[name]=value}return data}else{return{}}};_.save=function(name,data){switch(typeof(data)){case"string":case"String":$.cookie(name,data,__.param);break;default:case"object":case"Object":$.cookie(name,V.encHtml(V.toJsonString(V.getValue(data,{}))),__.param);break}};_.clear=function(name){$.cookie(name,"",{expires:-1})}};M.StorageDataResource=function(storage,timeout){var _=this,__={};V.inherit.apply(_,[M.SessionDataResource,[]]);__.storage=V.getValue(storage,window.sessionStorage);switch(typeof(__.storage)){case"string":__.storage=eval("("+__.storage+")");break;case"object":if(V.isArray(__.storage)){throw new Error("不能使用数组作为资源")}break;default:throw new Error("M.StorageDataResource 无法找到<"+storage+">对象");break}__.timeout=V.getValue(timeout,{interval:"h",number:"8"});if(!storage){throw new Error("不可使用此对象缓存，当前浏览器版本不支持!")}_.load=function(name){var val=null;if(__.storage.getItem){val=V.json(__.storage.getItem(name))}else{val=__.storage[name]}if(val){if(val.date){if(parseFloat(val.date)<new Date().getTime()){delete __.storage[name];return null}return val.data}}return null};_.save=function(name,str){str=V.getValue(str,"");if(!str){if(__.storage.removeItem){__.storage.removeItem(name)}else{delete __.storage[name]}return}if(__.storage.setItem){__.storage.setItem(name,V.toJsonString({data:str,date:(__.timeout?new Date().add(__.timeout.interval,__.timeout.number).getTime():false)}))}else{__.storage[name]={data:str,date:(__.timeout?new Date().add(__.timeout.interval,__.timeout.number).getTime():false)}}};_.clear=function(name){_.save(name)}};W.ValidateManager=function(){var _=this,__={};_.validate=function(control,input){var middler=control.middler;var datas=control.get();if(datas.validate){var regs=[];V.forC(datas.validate,function(k,v){var reg=middler.getObjectByAppName(W.APP,k);if(!reg){throw new Error("没找到对应的reg处理对象"+k)}if(typeof(v)=="string"){v={reg:"",error:v}}else{v=V.merge({reg:"",error:""},v)}reg.init(control,v.reg,v.error,input);regs.push(reg)},function(){control.valid=function(text,func){if(control.isError){control.onClearError()}var success=true;var data=Array.prototype.slice.call(regs,0);V.whileC2(function(){return data.shift()},function(reg,next){reg.validate(text,function(suc){success=success&&(suc&&suc.length>0);if(success){next()}else{control.isError=true;control.onError(reg.error)}})},function(){if(success){control.isError=false;control.onSuccess();if(func){func()}}})}})}}};W.Regex=function(reg,error){var _=this,__={};__.reg=V.getValue(reg,"");__.error=V.getValue(error,"");_.init=function(control,reg,error,input){_.cont=control;_.reg=V.getValue(__.reg,reg);_.error=V.getValue(error,__.error);if(!V.isValid(_.reg)){throw new Error("Regex默认使用reg属性完成判断reg属性不能为空!")}else{if(typeof(_.reg)=="string"){_.reg=eval(_.reg)}}};_.validate=function(text,func){func((text+"").match(_.reg))}}})(VJ,jQuery);(function(b,c,a,d){a.Box=function(h,f){var e=this,g={};b.inherit.apply(e,[a.Control,[h||"<div></div>",f||{border:1}]]);g.render=e.render;g.onLoad=e.onLoad;e.onLoad=function(i){b.forC(e.events,function(l,j){e.bindEvent(e.node,l,j)},null,true);g.onLoad(i)};e.render=function(i){i=g.render(i);b.forC(i,function(l,j){switch(l.toLowerCase()){case"border":e.node.css({border:"solid "+j+"px"});break;case"key":e.node.css({"text-align":"center","line-height":e.node.height()+"px","vertical-align":"middle",margin:"0 auto",minwidth:"40px",minheight:"20px"}).html(j);break}});return i}};a.FillControl=function(h,f){var e=this,g={};b.inherit.apply(e,[a.Control,[h||"<div></div>",f||{}]]);g.onLoad=e.onLoad;g.render=e.render;g.replaceNode=e.replaceNode;e.onLoad=function(i){b.forC(e.events,function(l,j){if(l.toLowerCase()=="click"){e.node.on("click","input",function(k){var m=c(this);e.call("click",{e:k,vid:m.val(),name:m.attr("name")});b.stopProp(k);return false});e.node.on("click","a,.click",function(k){var m=c(this);e.call("click",{e:k,vid:m.attr("vid")||m.attr("href"),name:m.attr("name")});b.stopProp(k);return false})}else{e.bindEvent(e.node,l,j)}},null,true);g.onLoad(i)};e.replaceNode=function(){g.content=e.node.html();g.replaceNode.apply(e,arguments)};e.render=function(i){i=g.render(i);b.forC(i,function(l,j){switch(l.toLowerCase()){case"value":e.node.html(b.format(g.content,j));break}});return i}};a.History=function(h,f){var e=this,g={};b.inherit.apply(e,[a.Control,[h||'<span style="display:none;"></span>',f||{}]]);g.onLoad=e.onLoad;g.render=e.render;e.fill=function(){return{hash:window.location.hash.replace(/#/g,"")}};e.onLoad=function(i){b.forC(e.events,function(l,j){switch(l.toLowerCase()){case"change":c(window).bind("hashchange",function(k){if(e.lastAction!=window.location.hash.replace(/#/g,"")){e.call("change",{lastAction:e.lastAction});e.lastAction=e.get().history.pop()}});break}},function(){g.onLoad(i)})};e.render=function(i){if(i){delete i.visible;delete i.invisible}i=g.render(i);b.forC(i,function(l,j){switch(l.toLowerCase()){case"add":if(!e.get().history){e.get().history=[]}if(window.location.hash){var m=e.get().history;if(!(m.length>0&&m[m.length-1]==window.location.hash.replace(/#/g,""))){m.push(window.location.hash.replace(/#/g,""))}}j=j.replace(/#/g,"");if(e.lastAction!=j){window.location.hash=j;e.lastAction=j}break;case"remove":e.get().history.pop();break;case"back":if(e.get().history&&e.get().history.length>0&&j){window.location.hash=e.get().history.pop()}break}});return i}};a.Panel=function(k,i,e,h,g){var f=this,j={};b.inherit.apply(f,[a.Control,[k||"<div></div>",i||{}]]);j.onLoad=f.onLoad;j.render=f.render;j.hasRender=false;j.status={panelid:b.random(),transform:{tx:0,ty:0,scale:1,angle:0,rx:0,ry:0,rz:0},callevent:{value:false},limit:b.getValue(e,0),limitBack:b.getValue(h,true),lock:g?g:false,startX:0,startY:0};f.status=j.status;j.moving=false;f.am=function(l,n,m){if(!j.status.lock&&!j.moving){b.once(function(){j.status.transform=b.merge(j.status.transform,n);var o=b.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d(0,0,0,{angle}deg)",j.status.transform);l.css("webkitTransform",o).css("mozTransform",o).css("transform",o);j.moving=false},m||(1000/60));j.moving=true}};f.onLoad=function(l){b.forC(f.events,function(n,m){switch(n.toLowerCase()){case"up":b.merge(j.status,{vol:true,up:true},true);break;case"down":b.merge(j.status,{vol:true,down:true},true);break;case"upout":b.merge(j.status,{vol:true,upout:true},true);break;case"downout":b.merge(j.status,{vol:true,downout:true},true);break;case"left":b.merge(j.status,{hor:true,left:true},true);break;case"right":b.merge(j.status,{hor:true,right:true},true);break;case"leftout":b.merge(j.status,{hor:true,leftout:true},true);break;case"rightout":b.merge(j.status,{hor:true,rightout:true},true);break;case"scale":b.merge(j.status,{pinch:true},true);break;case"rotate":b.merge(j.status,{rotate:true},true);break;case"dblclick":b.merge(j.status,{dblclick:true},true);default:f.bindEvent(l,n,m);break}},function(){l.attr("panelid",j.status.panelid);j.status.panelaction=(function(){var m=[];if(j.status.vol){m.push("vol")}if(j.status.hor){m.push("hor")}if(j.status.pinch){m.push("pinch")}if(j.status.rotate){m.push("rotate")}if(j.status.dblclick){m.push("dblclick")}return m})();l.attr("panelaction",j.status.panelaction.join(","));j.onLoad(l)})};f.fill=function(){return{}};f.render=function(l){l=j.render(l);b.forC(l,function(n,m){switch(n.toLowerCase()){case"width":f.node.width(m);break;case"height":f.node.height(m);break}},null,true);if(!j.hasRender){j.document=c(document);j.hasRender=true;j.finalMove=false;j.mc=new Hammer.Manager(f.node[0]);j.mc.add(new Hammer.Pan({threshold:0,pointers:0}));if(j.status.rotate||j.status.pinch){j.mc.add(new Hammer.Rotate({threshold:0})).recognizeWith(j.mc.get("pan"))}if(j.status.pinch){j.mc.add(new Hammer.Pinch({threshold:0})).recognizeWith([j.mc.get("pan"),j.mc.get("rotate")])}if(j.status.dblclick){j.mc.add(new Hammer.Tap({event:"doubletap",taps:2}))}j.mc.on(b.format("panleft panright panup pandown {pinorrot} {doubleclick}",{pinorrot:j.status.rotate?"rotatestart rotatemove rotateend rotate":(j.status.pinch?"pinchstart pinchmove pinchend":""),doubleclick:j.status.dblclick?"doubletap":""}),function(n){var m=n.target.hasAttribute("panelid")?c(n.target):c(n.target).parents("[panelid]:first");m=m.length>0?m:null;if(m&&m.attr("panelid")==j.status.panelid){switch(n.type){case"panright":case"panleft":case"swiperight":case"swipeleft":if(c.inArray("hor",j.status.panelaction)<0){m=c(m).parents("[panelid]:first");m=m.length>0?m:null}break;case"panup":case"pandown":case"swipeup":case"swipedown":if(c.inArray("vol",j.status.panelaction)<0){m=c(m).parents("[panelid]:first");m=m.length>0?m:null}break;case"pinchstart":case"pinchmove":case"pinchin":case"pinchout":case"pinchend":if(c.inArray("pinch",j.status.panelaction)<0){m=c(m).parents("[panelid]:first");m=m.length>0?m:null}break;case"rotate":case"rotatestart":case"rotatemove":case"rotateend":if(c.inArray("rotate",j.status.panelaction)<0){m=c(m).parents("[panelid]:first");m=m.length>0?m:null}break;case"doubletap":if(c.inArray("dblclick",j.status.panelaction)<0){m=c(m).parents("[panelid]:first");m=m.length>0?m:null}break}}if(m&&m.attr("panelid")!=j.status.panelid&&m.attr("panelaction")!=""){var o=m.attr("panelaction").split(",");switch(n.type){case"panright":case"panleft":case"swiperight":case"swipeleft":if(c.inArray("hor",o)>=0){return}break;case"panup":case"pandown":case"swipeup":case"swipedown":if(c.inArray("vol",o)>=0){return}break;case"pinchstart":case"pinchmove":case"pinchin":case"pinchout":case"pinchend":if(c.inArray("pinch",o)>=0){return}break;case"rotate":case"rotatestart":case"rotatemove":case"rotateend":if(c.inArray("rotate",o)>=0){return}break;case"doubletap":if(c.inArray("dblclick",o)>=0){return}break}}if(!j.finalMove){f.node.removeClass("animate").find(".animate").removeClass("animate");switch(n.type){case"panright":case"swiperight":if(j.status.hor&&!j.rotating&&!j.finalMove&&Math.abs(n.deltaX)>Math.abs(n.deltaY)){j.status.lastAction="right";j.finalMove=false||f.onRight(n,j.status)}else{if(!j.status.hor&&document.body.clientWidth<document.body.scrollWidth){if(j.status.startX==0){j.status.startX=j.document.scrollLeft()}j.document.scrollLeft(Math.max(j.status.startX-n.deltaX,0))}}break;case"panleft":case"swipeleft":if(j.status.hor&&!j.rotating&&!j.finalMove&&Math.abs(n.deltaX)>Math.abs(n.deltaY)){j.status.lastAction="left";j.finalMove=false||f.onLeft(n,j.status)}else{if(!j.status.hor&&document.body.clientWidth<document.body.scrollWidth){if(j.status.startX==0){j.status.startX=j.document.scrollLeft()}j.document.scrollLeft(Math.min(j.status.startX-n.deltaX,document.body.scrollWidth-document.body.clientWidth))}}break;case"panup":case"swipeup":if(j.status.vol&&!j.rotating&&!j.finalMove&&Math.abs(n.deltaX)<Math.abs(n.deltaY)){j.status.lastAction="up";j.finalMove=false||f.onUp(n,j.status)}else{if(!j.status.vol&&window.screen.availHeight<document.body.scrollHeight){if(j.status.startY==0){j.status.startY=j.document.scrollTop()}j.document.scrollTop(Math.max(j.status.startY-n.deltaY,document.body.scrollHeight-document.body.clientHeight))}}break;case"pandown":case"swipedown":if(j.status.vol&&!j.rotating&&!j.finalMove&&Math.abs(n.deltaX)<Math.abs(n.deltaY)){j.status.lastAction="down";j.finalMove=false||f.onDown(n,j.status)}else{if(!j.status.vol&&window.screen.availHeight<document.body.scrollHeight){if(j.status.startY==0){j.status.startY=j.document.scrollTop()}j.document.scrollTop(Math.min(j.status.startY-n.deltaY,document.body.scrollHeight))}}break;case"pinchstart":j.rotating=true;case"pinchmove":j.finalMove=false||f.onScale(n,j.status);break;case"pinchin":case"pinchout":j.status.lastAction="scale";j.scale=n.scale;break;case"pinchend":j.rotating=false;break;case"rotate":case"rotatestart":j.rotating=true;case"rotatemove":j.status.lastAction="rotate";j.status.angle=n.angle;j.finalMove=false||f.onRotate(n,j.status);if(j.pinch){j.status.scale=n.scale}break;case"rotateend":j.rotating=false;break}if(j.finalMove){b.once(function(){if(j.status.callevent.value){f.onFinal(j.status)}f.onBackAnimate(f.node,j.status);j.status.callevent.value=false;b.once(function(){j.finalMove=false},300)},100)}}});j.mc.on("hammer.input",function(m){if(m.isFinal&&!j.finalMove){b.once(function(){if(j.status.callevent.value){f.onFinal(j.status)}f.onBackAnimate(f.node,j.status);j.status.callevent.value=false;b.once(function(){j.finalMove=false},300)},100)}})}return l};f.onLeft=function(l,m){if(Math.abs(l.deltaX)<Math.max(30,f.node.width()*m.limit)){f.am(f.node,{tx:(m.left||m.leftout)?l.deltaX:Math.max(0,l.deltaX),ty:0})}else{m.callevent.value=true;return m.limitBack}};f.onRight=function(l,m){if(Math.abs(l.deltaX)<Math.max(30,f.node.width()*m.limit)){f.am(f.node,{tx:(m.right||m.rightout)?l.deltaX:Math.max(0,l.deltaX),ty:0})}else{m.callevent.value=true;return m.limitBack}};f.onUp=function(l,m){if(Math.abs(l.deltaY)<Math.max(30,f.node.height()*m.limit)){f.am(f.node,{ty:(m.up||m.upout)?l.deltaY:Math.max(0,l.deltaY),tx:0})}else{m.callevent.value=true;return m.limitBack}};f.onDown=function(l,m){if(Math.abs(l.deltaY)<Math.max(30,f.node.height()*m.limit)){f.am(f.node,{ty:(m.down||m.downout)?l.deltaY:Math.min(0,l.deltaY),tx:0})}else{m.callevent.value=true;return m.limitBack}};f.onScale=function(l,m){if(Math.abs(l.scale-1)<m.limit){f.am(f.node,{scale:l.scale})}else{m.callevent.value=true}};f.onRotate=function(l,m){f.am(f.node,{angle:l.rotation,scale:m.pinch?l.scale:1});m.callevent.value=true};f.onBackAnimate=function(l,n){b.merge(n.transform,{tx:0,ty:0,scale:1,angle:0,rx:0,ry:0,rz:0,startX:0,startY:0},true);switch(n.lastAction){case"left":if(n.leftout){n.transform.tx=screen.width*-1}break;case"right":if(n.rightout){n.transform.tx=screen.width}break;case"up":if(n.upout){n.transform.ty=screen.height*-1}break;case"down":if(n.downout){n.transform.ty=screen.height}break}var m=b.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d({rx},{ry},{rz},{angle}deg)",n.transform);l.addClass("animate").css("webkitTransform",m).css("mozTransform",m).css("transform",m);switch(n.lastAction){case"left":if(n.leftout){l.hide()}break;case"right":if(n.rightout){l.hide()}break;case"up":if(n.upout){l.hide()}break;case"down":if(n.downout){l.hide()}break}};f.onFinal=function(l){switch(l.lastAction){case"left":if(l.leftout){f.call("leftout")}else{f.call("left")}break;case"right":if(l.rightout){f.call("rightout")}else{f.call("right")}break;case"up":if(l.upout){f.call("upout")}else{f.call("up")}break;case"down":if(l.downout){f.call("downout")}else{f.call("down")}break;case"scale":f.call("scale",{scale:l.scale});break;case"rotate":if(l.pinch){if(l.scale!=1){f.call("scale",{scale:l.scale})}}f.call("rotate",{angle:l.angle});break}}};a.PagePanel=function(j,k,h,e,g){var f=this,i={};b.inherit.apply(f,[j.getTypeByAppName("VESH.view","panel"),[b.getValue(k,'<div style="overflow:hidden;"><div style="display:none;"></div></div>'),b.merge(b.getValue(h,{}),{data:{direction:"hor",value:0},onLeft:function(m,l){f.change(true)},onRight:function(m,l){f.change(false)},onUp:function(m,l){f.change(true)},onDown:function(m,l){f.change(false)}},true),e||0.2,g||true,true]]);i.onLoad=f.onLoad;i.render=f.render;f.lock=false;f.onLoad=function(m){m.removeClass("animate");f.panel=m.find("div:first");f.children=f.panel.siblings();f.length=f.children.length;f.children.width(m.width()).height(m.height()).css("overflow","hidden").css("position","relative");f.children.addClass("noactive");f.panel.append(f.children);var l=f.get().direction;switch(l){case"vol":f.vol=true;delete f.events.left;delete f.events.right;f.panel.css("height",f.length+"00%").css("width","100%");break;case"hor":default:f.hor=true;delete f.events.up;delete f.events.down;f.panel.css("width",f.length+"00%").css("height","100%");f.children.css("float","left");break}b.forC(f.events,function(o,n){o=o.toLowerCase();switch(o){case"change":break;default:f.bindEvent(m,o,n);break}},function(){i.onLoad(m)})};i.onLeft=f.onLeft;f.onLeft=function(l,m){if(f.vol||f.lock){return}i.distance=Math.abs(l.deltaX);return i.onLeft(l,m)};i.onRight=f.onRight;f.onRight=function(l,m){if(f.vol||f.lock){return}i.distance=Math.abs(l.deltaX);return i.onRight(l,m)};i.onUp=f.onUp;f.onUp=function(l,m){if(f.hor||f.lock){return}i.distance=Math.abs(l.deltaY);return i.onUp(l,m)};i.onDown=f.onDown;f.onDown=function(l,m){if(f.hor||f.lock){return}i.distance=Math.abs(l.deltaY);return i.onDown(l,m)};i.first=true;f.render=function(l){l=i.render(l);b.forC(l,function(o,n){switch(o.toLowerCase()){case"value":f.change(n,true,i.first);i.first=false;break;case"freeze":case"lock":f.lock=n;break;case"height":f.children.height(n);break;case"width":f.children.width(n);break;case"values":var m=b.newEl("div","","").css("display","none;");b.each(n,function(p){m.append(p)},function(){f.children=m.children();f.length=f.children.length;f.children.width(f.node.width()).height(f.node.height()).css("overflow","hidden").css("position","relative");f.children.addClass("noactive");f.panel.empty().append(f.children);if(f.vol){f.panel.css("height",f.length+"00%").css("width","100%")}else{f.panel.css("width",f.length+"00%").css("height","100%");f.children.css("float","left")}f.change(f.index==NaN?0:f.index,true,true);m.remove()},false);break}},function(){},true)};f.change=function(o,l,n){o=(""+o).toLowerCase();var m=Math.ceil(i.distance/(f.hor?f.node.width():f.node.height()));o=Math.max(0,Math.min(f.children.length-1,o=="true"?(f.get().value+m):(o=="false"?(f.get().value-m):parseInt(o))));f.index=o;if(!l&&o!=parseInt(f.get().value)){f.call("change",{value:o})}else{f.onBackAnimate(f.panel,f.status,n)}};f.onBackAnimate=function(l,m,n){b.once(function(){b.merge(m.transform,{tx:0,ty:0,scale:1,angle:0,rx:0,ry:0,rz:0,startX:0,startY:0},true);if(f.hor){m.transform.tx-=(f.node.width()*f.index)}else{if(f.vol){m.transform.ty-=(f.node.height()*f.index)}}var o=b.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d({rx},{ry},{rz},{angle}deg)",m.transform);if(!n){f.panel.addClass("animate")}f.panel.css("webkitTransform",o).css("mozTransform",o).css("transform",o).show()},10)}};a.ScrollPanel=function(j,k,h,e,g){var f=this,i={};b.inherit.apply(f,[j.getTypeByAppName("VESH.view","panel"),[b.getValue(k,'<div style="overflow:hidden;"><div style="display:none;"></div></div>'),b.merge(b.getValue(h,{}),{data:{direction:"vol"},onLeft:function(m,l){f.call("next")},onRight:function(m,l){f.call("reload")},onUp:function(m,l){f.call("next")},onDown:function(m,l){f.call("reload")}},true),e||0.2,g||true]]);i.onLoad=f.onLoad;i.render=f.render;f.lock=false;b.merge(f.status.transform,{x:0,y:0},true);f.onLoad=function(m){m.removeClass("animate");f.panel=m.find("div:first");f.children=f.panel.siblings();f.length=f.children.length;f.value=Math.max(0,Math.min(f.children.length,parseInt(f.value)));f.children.css("position","relative");f.children.addClass("noactive");f.panel.append(f.children);var l=f.get().direction;switch(l){case"vol":f.vol=true;delete f.events.left;delete f.events.right;f.panel.css("width","100%");f.children.css("width","100%");break;case"hor":default:f.hor=true;delete f.events.up;delete f.events.down;f.panel.css("height","100%");if(f.children.width()){f.panel.width(f.children.width())}f.children.css("height","100%").css("float","left");break}b.forC(f.events,function(o,n){o=o.toLowerCase();switch(o){case"next":case"reload":break;default:f.bindEvent(m,o,n);break}},function(){i.onLoad(m)})};f.onLeft=function(m,n){if(f.vol||f.lock){return}i.distance=Math.abs(m.deltaX);var l=n.transform.x+m.deltaX;if(l<(f.node.width()-5-f.panel.width())){n.callevent.value=true}if(l>Math.min(-n.limit,(f.node.width()-n.limit-f.panel.width()))){f.am(f.panel,{tx:(n.left||n.leftout)?l:Math.max(0,m.deltaX),ty:0})}else{return n.limitBack}};f.onRight=function(m,n){if(f.vol||f.lock){return}i.distance=Math.abs(m.deltaX);var l=n.transform.x+m.deltaX;if(l>5){n.callevent.value=true}if(l<n.limit){f.am(f.panel,{tx:(n.right||n.rightout)?l:Math.max(0,m.deltaX),ty:0})}else{return n.limitBack}};f.onUp=function(l,m){if(f.hor||f.lock){return}i.distance=Math.abs(l.deltaY);var n=m.transform.y+l.deltaY;if(n<(f.node.height()-5-f.panel.height())){m.callevent.value=true}if(n>Math.min(-m.limit,(f.node.height()-m.limit-f.panel.height()))){f.am(f.panel,{ty:(m.up||m.upout)?n:Math.max(0,l.deltaY),tx:0})}else{return m.limitBack}};f.onDown=function(l,m){if(f.hor||f.lock){return}i.distance=Math.abs(l.deltaY);var n=m.transform.y+l.deltaY;if(n>5){m.callevent.value=true}if(n<m.limit){f.am(f.panel,{ty:(m.down||m.downout)?n:Math.max(0,l.deltaY),tx:0})}else{return m.limitBack}};f.onScale=function(l,m){if(Math.abs(l.scale-1)*Math.min(f.node.width(),f.node.height)<m.limit){f.am(f.panel,{scale:l.scale})}else{m.callevent.value=true}};f.addControl=function(n,l){if(!f.controls){f.controls=[];f.vs={};f.vms={};f.models=f.vms}var o=f.middler.getObjectByAppName(a.APP,l.type);if(!o){throw new Error("配置文件中没有找到对象类型定义:"+l.type)}n=n?n:b.newEl("div").appendTo(f.panel);o.init(f,n,l);o.page=f.page;f.controls.push(o);var m=b.getValue(l.id,b.random());if(f.vs[m]){b.showException("控件id为"+id+"的子控件已经存在，请更换id名");return}f.vs[m]=o;b.inherit.apply(l,[d.Control,[]]);f.vms[m]=l;o.bind(l);return l};f.render=function(l){l=i.render(l);b.forC(l,function(n,m){switch(n.toLowerCase()){case"value":f.onValue([m],function(o){switch(typeof(o)){case"string":f.panel.empty().append(o);break;case"object":f.panel.empty();f.addControl(null,o);break}});break;case"values":f.onValue(m,function(o){switch(typeof(o)){case"string":f.panel.empty().append(o);break;case"object":if(!b.isArray(o)){o=[o]}f.panel.empty();b.each(o,function(p){f.addControl(null,p)});break}});break;case"addvalues":f.onValue(m,function(o){switch(typeof(o)){case"string":f.panel.append(o);break;case"object":if(!b.isArray(o)){o=[o]}b.each(o,function(p){f.addControl(null,p)});break}});break;case"top":if(m){f.get().top=false;f.onBackAnimate(f.node,b.merge(f.status,{transform:{tx:0,ty:0}},true))}break;case"bottom":if(m){f.get().bottom=false;f.onBackAnimate(f.node,b.merge(f.status,{transform:{tx:f.status.vol?0:(f.node.width()-f.panel.width()),ty:f.status.hor?0:(f.node.height()-f.panel.height())}},true))}break;case"freeze":case"lock":f.lock=m;break}},function(){},true);f.panel.show();return l};f.onValue=function(l,m){if(!b.isArray(l)){l=[l]}var n=b.sb();b.each(l,function(o){if(typeof(o)=="string"){n.append(o)}else{n.append(b.toJsonString(o))}},function(){m(n.clear());n=null})};f.onBackAnimate=function(l,m){b.once(function(){if(m.vol&&m.transform.ty<0&&m.transform.ty>(f.node.height()-f.panel.height())){m.transform.y=m.transform.ty;return}if(m.hor&&m.transform.tx<0&&m.transform.tx>(f.node.width()-f.panel.width())){m.transform.x=m.transform.tx;return}b.merge(m.transform,{tx:Math.min(0,Math.max(f.node.width()-f.panel.width(),m.transform.tx)),ty:Math.min(0,Math.max(f.node.height()-f.panel.height(),m.transform.ty)),scale:1,angle:0,rx:0,ry:0,rz:0,startX:0,startY:0},true);b.merge(m.transform,{x:m.transform.tx,y:m.transform.ty},true);var n=b.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d({rx},{ry},{rz},{angle}deg)",m.transform);f.panel.addClass("animate").css("webkitTransform",n).css("mozTransform",n).css("transform",n).show()},10)}}})(VJ,jQuery,VJ.view,VJ.viewmodel);