!function(V,$,W,M){W.Box=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<div class="c_box"></div>',t||{border:1}]]),n.render=a.render,n.onLoad=a.onLoad,a.onLoad=function(e){V.forC(a.events,function(e,t){a.bindEvent(a.node,e,t)},null,!0),n.onLoad(e)},a.render=function(e){return e=n.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"border":a.node.css({border:"solid "+t+"px"});break;case"key":a.node.css({"text-align":"center","line-height":a.node.height()+"px","vertical-align":"middle",margin:"0 auto",minwidth:"40px",minheight:"20px"}).html(t)}}),e}},W.FillControl=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<div class="c_fillControl"></div>',t||{}]]),n.onLoad=a.onLoad,n.render=a.render,n.replaceNode=a.replaceNode,a.onLoad=function(e){V.forC(a.events,function(e,t){"click"==e.toLowerCase()?(a.node.on("click","input",function(e){var t=$(this);return a.call("click",{e:e,vid:t.val(),name:t.attr("name")}),V.stopProp(e),!1}),a.node.on("click","a,.click",function(e){var t=$(this);return!(!t.attr("href")||!(t.attr("href").indexOf("http://")>=0||t.attr("href").indexOf("https://")>=0))||(a.call("click",{e:e,vid:t.attr("vid")||t.attr("href"),name:t.attr("name")}),V.stopProp(e),!1)})):a.bindEvent(a.node,e,t)},null,!0),n.onLoad(e)},a.replaceNode=function(){n.content=a.node.html(),n.replaceNode.apply(a,arguments)},a.render=function(e){return e=n.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"value":a.node.html(V.format(n.content,t))}}),e}},W.History=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<span class="c_history" style="display:none;"></span>',t||{}]]),n.onLoad=a.onLoad,n.render=a.render,a.fill=function(){return{hash:window.location.hash.replace(/#/g,"")}},a.onLoad=function(e){V.forC(a.events,function(e,t){switch(e.toLowerCase()){case"change":$(window).bind("hashchange",function(e){a.lastAction!=window.location.hash.replace(/#/g,"")&&(a.call("change",{lastAction:a.lastAction}),a.lastAction=a.get().history.pop())})}},function(){n.onLoad(e)})},a.render=function(e){return e&&(delete e.visible,delete e.invisible),e=n.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"add":if(a.get().history||(a.get().history=[]),window.location.hash){var n=a.get().history;n.length>0&&n[n.length-1]==window.location.hash.replace(/#/g,"")||n.push(window.location.hash.replace(/#/g,""))}t=t.replace(/#/g,""),a.lastAction!=t&&(window.location.hash=t,a.lastAction=t);break;case"remove":a.get().history.pop();break;case"back":a.get().history&&a.get().history.length>0&&t&&(window.location.hash=a.get().history.pop())}}),e}},W.Panel=function(e,t,a,n,o){var s=this,i={};V.inherit.apply(s,[W.Control,[e||'<div class="c_panel"></div>',t||{}]]),i.onLoad=s.onLoad,i.render=s.render,i.hasRender=!1,i.status={panelid:V.random(),transform:{tx:0,ty:0,scale:1,angle:0,rx:0,ry:0,rz:0},callevent:{value:!1},limit:V.getValue(a,0),limitBack:V.getValue(n,!0),lock:o||!1,startX:0,startY:0},s.status=i.status,i.moving=!1,s.am=function(e,t,a){i.status.lock||i.moving||(V.once(function(){i.status.transform=V.merge(i.status.transform,t);var a=V.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d(0,0,0,{angle}deg)",i.status.transform);e.css("webkitTransform",a).css("mozTransform",a).css("transform",a),i.moving=!1},a||1e3/60),i.moving=!0)},s.onLoad=function(e){V.forC(s.events,function(t,a){switch(t.toLowerCase()){case"up":V.merge(i.status,{vol:!0,up:!0},!0);break;case"down":V.merge(i.status,{vol:!0,down:!0},!0);break;case"upout":V.merge(i.status,{vol:!0,upout:!0},!0);break;case"downout":V.merge(i.status,{vol:!0,downout:!0},!0);break;case"left":V.merge(i.status,{hor:!0,left:!0},!0);break;case"right":V.merge(i.status,{hor:!0,right:!0},!0);break;case"leftout":V.merge(i.status,{hor:!0,leftout:!0},!0);break;case"rightout":V.merge(i.status,{hor:!0,rightout:!0},!0);break;case"scale":V.merge(i.status,{pinch:!0},!0);break;case"rotate":V.merge(i.status,{rotate:!0},!0);break;case"dblclick":V.merge(i.status,{dblclick:!0},!0);default:s.bindEvent(e,t,a)}},function(){e.attr("panelid",i.status.panelid),i.status.panelaction=function(){var e=[];return i.status.vol&&e.push("vol"),i.status.hor&&e.push("hor"),i.status.pinch&&e.push("pinch"),i.status.rotate&&e.push("rotate"),i.status.dblclick&&e.push("dblclick"),e}(),e.attr("panelaction",i.status.panelaction.join(",")),i.onLoad(e)})},s.fill=function(){return{}},s.render=function(e){return e=i.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"width":s.node.width(t);break;case"height":s.node.height(t)}},null,!0),i.hasRender||(i.document=$(document),i.hasRender=!0,i.finalMove=!1,i.mc=new Hammer.Manager(s.node[0]),i.mc.add(new Hammer.Pan({threshold:0,pointers:0})),(i.status.rotate||i.status.pinch)&&i.mc.add(new Hammer.Rotate({threshold:0})).recognizeWith(i.mc.get("pan")),i.status.pinch&&i.mc.add(new Hammer.Pinch({threshold:0})).recognizeWith([i.mc.get("pan"),i.mc.get("rotate")]),i.status.dblclick&&i.mc.add(new Hammer.Tap({event:"doubletap",taps:2})),i.mc.on(V.format("panleft panright panup pandown {pinorrot} {doubleclick}",{pinorrot:i.status.rotate?"rotatestart rotatemove rotateend rotate":i.status.pinch?"pinchstart pinchmove pinchend":"",doubleclick:i.status.dblclick?"doubletap":""}),function(e){var t=e.target.hasAttribute("panelid")?$(e.target):$(e.target).parents("[panelid]:first");if((t=t.length>0?t:null)&&t.attr("panelid")==i.status.panelid)switch(e.type){case"panright":case"panleft":case"swiperight":case"swipeleft":$.inArray("hor",i.status.panelaction)<0&&(t=$(t).parents("[panelid]:first"),t=t.length>0?t:null);break;case"panup":case"pandown":case"swipeup":case"swipedown":$.inArray("vol",i.status.panelaction)<0&&(t=$(t).parents("[panelid]:first"),t=t.length>0?t:null);break;case"pinchstart":case"pinchmove":case"pinchin":case"pinchout":case"pinchend":$.inArray("pinch",i.status.panelaction)<0&&(t=$(t).parents("[panelid]:first"),t=t.length>0?t:null);break;case"rotate":case"rotatestart":case"rotatemove":case"rotateend":$.inArray("rotate",i.status.panelaction)<0&&(t=$(t).parents("[panelid]:first"),t=t.length>0?t:null);break;case"doubletap":$.inArray("dblclick",i.status.panelaction)<0&&(t=$(t).parents("[panelid]:first"),t=t.length>0?t:null)}if(t&&t.attr("panelid")!=i.status.panelid&&""!=t.attr("panelaction")){var a=t.attr("panelaction").split(",");switch(e.type){case"panright":case"panleft":case"swiperight":case"swipeleft":if($.inArray("hor",a)>=0)return;break;case"panup":case"pandown":case"swipeup":case"swipedown":if($.inArray("vol",a)>=0)return;break;case"pinchstart":case"pinchmove":case"pinchin":case"pinchout":case"pinchend":if($.inArray("pinch",a)>=0)return;break;case"rotate":case"rotatestart":case"rotatemove":case"rotateend":if($.inArray("rotate",a)>=0)return;break;case"doubletap":if($.inArray("dblclick",a)>=0)return}}if(!i.finalMove){switch(s.node.removeClass("animate").find(".animate").removeClass("animate"),e.type){case"panright":case"swiperight":i.status.hor&&!i.rotating&&!i.finalMove&&Math.abs(e.deltaX)>Math.abs(e.deltaY)?(i.status.lastAction="right",i.finalMove=s.onRight(e,i.status)):!i.status.hor&&document.body.clientWidth<document.body.scrollWidth&&(0==i.status.startX&&(i.status.startX=i.document.scrollLeft()),i.document.scrollLeft(Math.max(i.status.startX-e.deltaX,0)));break;case"panleft":case"swipeleft":i.status.hor&&!i.rotating&&!i.finalMove&&Math.abs(e.deltaX)>Math.abs(e.deltaY)?(i.status.lastAction="left",i.finalMove=s.onLeft(e,i.status)):!i.status.hor&&document.body.clientWidth<document.body.scrollWidth&&(0==i.status.startX&&(i.status.startX=i.document.scrollLeft()),i.document.scrollLeft(Math.min(i.status.startX-e.deltaX,document.body.scrollWidth-document.body.clientWidth)));break;case"panup":case"swipeup":i.status.vol&&!i.rotating&&!i.finalMove&&Math.abs(e.deltaX)<Math.abs(e.deltaY)?(i.status.lastAction="up",i.finalMove=s.onUp(e,i.status)):!i.status.vol&&window.screen.availHeight<document.body.scrollHeight&&(0==i.status.startY&&(i.status.startY=i.document.scrollTop()),i.document.scrollTop(Math.max(i.status.startY-e.deltaY,document.body.scrollHeight-document.body.clientHeight)));break;case"pandown":case"swipedown":i.status.vol&&!i.rotating&&!i.finalMove&&Math.abs(e.deltaX)<Math.abs(e.deltaY)?(i.status.lastAction="down",i.finalMove=s.onDown(e,i.status)):!i.status.vol&&window.screen.availHeight<document.body.scrollHeight&&(0==i.status.startY&&(i.status.startY=i.document.scrollTop()),i.document.scrollTop(Math.min(i.status.startY-e.deltaY,document.body.scrollHeight)));break;case"pinchstart":i.rotating=!0;case"pinchmove":i.finalMove=s.onScale(e,i.status);break;case"pinchin":case"pinchout":i.status.lastAction="scale",i.scale=e.scale;break;case"pinchend":i.rotating=!1;break;case"rotate":case"rotatestart":i.rotating=!0;case"rotatemove":i.status.lastAction="rotate",i.status.angle=e.angle,i.finalMove=s.onRotate(e,i.status),i.pinch&&(i.status.scale=e.scale);break;case"rotateend":i.rotating=!1}i.finalMove&&V.once(function(){i.status.callevent.value&&s.onFinal(i.status),s.onBackAnimate(s.node,i.status),i.status.callevent.value=!1,V.once(function(){i.finalMove=!1},300)},100)}}),i.mc.on("hammer.input",function(e){e.isFinal&&!i.finalMove&&V.once(function(){i.status.callevent.value&&s.onFinal(i.status),s.onBackAnimate(s.node,i.status),i.status.callevent.value=!1,V.once(function(){i.finalMove=!1},300)},100)})),e},s.onLeft=function(e,t){if(!(Math.abs(e.deltaX)<Math.max(30,s.node.width()*t.limit)))return t.callevent.value=!0,t.limitBack;s.am(s.node,{tx:t.left||t.leftout?e.deltaX:Math.max(0,e.deltaX),ty:0})},s.onRight=function(e,t){if(!(Math.abs(e.deltaX)<Math.max(30,s.node.width()*t.limit)))return t.callevent.value=!0,t.limitBack;s.am(s.node,{tx:t.right||t.rightout?e.deltaX:Math.max(0,e.deltaX),ty:0})},s.onUp=function(e,t){if(!(Math.abs(e.deltaY)<Math.max(30,s.node.height()*t.limit)))return t.callevent.value=!0,t.limitBack;s.am(s.node,{ty:t.up||t.upout?e.deltaY:Math.max(0,e.deltaY),tx:0})},s.onDown=function(e,t){if(!(Math.abs(e.deltaY)<Math.max(30,s.node.height()*t.limit)))return t.callevent.value=!0,t.limitBack;s.am(s.node,{ty:t.down||t.downout?e.deltaY:Math.min(0,e.deltaY),tx:0})},s.onScale=function(e,t){Math.abs(e.scale-1)<t.limit?s.am(s.node,{scale:e.scale}):t.callevent.value=!0},s.onRotate=function(e,t){s.am(s.node,{angle:e.rotation,scale:t.pinch?e.scale:1}),t.callevent.value=!0},s.onBackAnimate=function(e,t){switch(V.merge(t.transform,{tx:0,ty:0,scale:1,angle:0,rx:0,ry:0,rz:0,startX:0,startY:0},!0),t.lastAction){case"left":t.leftout&&(t.transform.tx=-1*screen.width);break;case"right":t.rightout&&(t.transform.tx=screen.width);break;case"up":t.upout&&(t.transform.ty=-1*screen.height);break;case"down":t.downout&&(t.transform.ty=screen.height)}var a=V.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d({rx},{ry},{rz},{angle}deg)",t.transform);switch(e.addClass("animate").css("webkitTransform",a).css("mozTransform",a).css("transform",a),t.lastAction){case"left":t.leftout&&e.hide();break;case"right":t.rightout&&e.hide();break;case"up":t.upout&&e.hide();break;case"down":t.downout&&e.hide()}},s.onFinal=function(e){switch(e.lastAction){case"left":e.leftout?s.call("leftout"):s.call("left");break;case"right":e.rightout?s.call("rightout"):s.call("right");break;case"up":e.upout?s.call("upout"):s.call("up");break;case"down":e.downout?s.call("downout"):s.call("down");break;case"scale":s.call("scale",{scale:e.scale});break;case"rotate":e.pinch&&1!=e.scale&&s.call("scale",{scale:e.scale}),s.call("rotate",{angle:e.angle})}}},W.PagePanel=function(e,t,a,n,o){var s=this,i={};V.inherit.apply(s,[e.getTypeByAppName("VESH.view","panel"),[V.getValue(t,'<div style="overflow:hidden;"  class="c_pagePanel"><div style="display:none;"></div></div>'),V.merge(V.getValue(a,{}),{data:{direction:"hor",value:0},onLeft:function(e,t){s.change(!0)},onRight:function(e,t){s.change(!1)},onUp:function(e,t){s.change(!0)},onDown:function(e,t){s.change(!1)}},!0),n||.2,o||!0,!0]]),i.onLoad=s.onLoad,i.render=s.render,s.lock=!1,s.onLoad=function(e){switch(e.removeClass("animate"),s.panel=e.find("div:first"),s.children=s.panel.siblings(),s.length=s.children.length,s.children.css("overflow","hidden").css("position","relative"),s.children.addClass("noactive"),s.panel.append(s.children),s.get().direction){case"vol":s.vol=!0,delete s.events.left,delete s.events.right,s.panel.css("height",s.length+"00%").css("width","100%"),s.children.css("height",Math.floor(1e4/s.length)/100+"%").css("width","100%");break;case"hor":default:s.hor=!0,delete s.events.up,delete s.events.down,s.panel.css("width",s.length+"00%").css("height","100%"),s.children.css("width",Math.floor(1e4/s.length)/100+"%").css("height","100%").css("float","left")}V.forC(s.events,function(t,a){switch(t=t.toLowerCase()){case"change":break;default:s.bindEvent(e,t,a)}},function(){i.onLoad(e)})},i.onLeft=s.onLeft,s.onLeft=function(e,t){if(!s.vol&&!s.lock)return i.distance=Math.abs(e.deltaX),i.onLeft(e,t)},i.onRight=s.onRight,s.onRight=function(e,t){if(!s.vol&&!s.lock)return i.distance=Math.abs(e.deltaX),i.onRight(e,t)},i.onUp=s.onUp,s.onUp=function(e,t){if(!s.hor&&!s.lock)return i.distance=Math.abs(e.deltaY),i.onUp(e,t)},i.onDown=s.onDown,s.onDown=function(e,t){if(!s.hor&&!s.lock)return i.distance=Math.abs(e.deltaY),i.onDown(e,t)},i.first=!0,s.render=function(e){e=i.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"value":s.change(t,!0,i.first),i.first=!1;break;case"freeze":case"lock":s.lock=t;break;case"height":case"width":break;case"values":var a=V.newEl("div","","").css("display","none;");V.each(t,function(e){a.append(e)},function(){s.children=a.children(),s.length=s.children.length,s.children.css("overflow","hidden").css("position","relative"),s.children.addClass("noactive"),s.panel.empty().append(s.children),s.vol?(s.panel.css("height",s.length+"00%").css("width","100%"),s.children.css("height",Math.floor(1e4/s.length)/100+"%").css("width","100%")):(s.panel.css("width",s.length+"00%").css("height","100%"),s.children.css("width",Math.floor(1e4/s.length)/100+"%").css("height","100%"),s.children.css("float","left")),s.change(NaN==s.index?0:s.index,!0,!0),a.remove()},!1)}},function(){},!0)},s.change=function(e,t,a){e=(""+e).toLowerCase();var n=Math.ceil(i.distance/(s.hor?s.node.width():s.node.height()));e=Math.max(0,Math.min(s.children.length-1,"true"==e?s.get().value+n:"false"==e?s.get().value-n:parseInt(e))),s.index=e,t||e==parseInt(s.get().value)?s.onBackAnimate(s.panel,s.status,a):s.call("change",{value:e})},s.onBackAnimate=function(e,t,a){V.once(function(){V.merge(t.transform,{tx:0,ty:0,scale:1,angle:0,rx:0,ry:0,rz:0,startX:0,startY:0},!0),s.hor?t.transform.tx-=s.node.width()*s.index:s.vol&&(t.transform.ty-=s.node.height()*s.index);var e=V.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d({rx},{ry},{rz},{angle}deg)",t.transform);a||s.panel.addClass("animate"),s.panel.css("webkitTransform",e).css("mozTransform",e).css("transform",e).show()},10)}},W.ScrollPanel=function(e,t,a,n,o){var s=this,i={};V.inherit.apply(s,[e.getTypeByAppName("VESH.view","panel"),[V.getValue(t,'<div style="overflow:hidden;"  class="c_scrollPanel"><div style="display:none;"></div></div>'),V.merge(V.getValue(a,{}),{data:{direction:"vol"},onLeft:function(e,t){s.call("next")},onRight:function(e,t){s.call("reload")},onUp:function(e,t){s.call("next")},onDown:function(e,t){s.call("reload")}},!0),n||.2,o||!0]]),i.onLoad=s.onLoad,i.render=s.render,s.lock=!1,V.merge(s.status.transform,{x:0,y:0},!0),s.onLoad=function(e){switch(e.removeClass("animate"),s.panel=e.find("div:first"),s.children=s.panel.siblings(),s.length=s.children.length,s.value=Math.max(0,Math.min(s.children.length,parseInt(s.value))),s.children.css("position","relative"),s.children.addClass("noactive"),s.panel.append(s.children),s.get().direction){case"vol":s.vol=!0,delete s.events.left,delete s.events.right,s.panel.css("width","100%"),s.children.css("width","100%");break;case"hor":default:s.hor=!0,delete s.events.up,delete s.events.down,s.panel.css("height","100%"),s.children.width()&&s.panel.width(s.children.width()),s.children.css("height","100%").css("float","left")}V.forC(s.events,function(t,a){switch(t=t.toLowerCase()){case"next":case"reload":break;default:s.bindEvent(e,t,a)}},function(){i.onLoad(e)})},s.onLeft=function(e,t){if(!s.vol&&!s.lock){i.distance=Math.abs(e.deltaX);var a=t.transform.x+e.deltaX;if(a<s.node.width()-5-s.panel.width()&&(t.callevent.value=!0),!(a>Math.min(-t.limit,s.node.width()-t.limit-s.panel.width())))return t.limitBack;s.am(s.panel,{tx:t.left||t.leftout?a:Math.max(0,e.deltaX),ty:0})}},s.onRight=function(e,t){if(!s.vol&&!s.lock){i.distance=Math.abs(e.deltaX);var a=t.transform.x+e.deltaX;if(a>5&&(t.callevent.value=!0),!(a<t.limit))return t.limitBack;s.am(s.panel,{tx:t.right||t.rightout?a:Math.max(0,e.deltaX),ty:0})}},s.onUp=function(e,t){if(!s.hor&&!s.lock){i.distance=Math.abs(e.deltaY);var a=t.transform.y+e.deltaY;if(a<s.node.height()-5-s.panel.height()&&(t.callevent.value=!0),!(a>Math.min(-t.limit,s.node.height()-t.limit-s.panel.height())))return t.limitBack;s.am(s.panel,{ty:t.up||t.upout?a:Math.max(0,e.deltaY),tx:0})}},s.onDown=function(e,t){if(!s.hor&&!s.lock){i.distance=Math.abs(e.deltaY);var a=t.transform.y+e.deltaY;if(a>5&&(t.callevent.value=!0),!(a<t.limit))return t.limitBack;s.am(s.panel,{ty:t.down||t.downout?a:Math.max(0,e.deltaY),tx:0})}},s.onScale=function(e,t){Math.abs(e.scale-1)*Math.min(s.node.width(),s.node.height)<t.limit?s.am(s.panel,{scale:e.scale}):t.callevent.value=!0},s.addControl=function(e,t){s.controls||(s.controls=[],s.vs={},s.vms={},s.models=s.vms);var a=s.middler.getObjectByAppName(W.APP,t.type);if(!a)throw new Error("配置文件中没有找到对象类型定义:"+t.type);e=e||V.newEl("div").appendTo(s.panel),a.init(s,e,t.data),a.page=s.page,s.controls.push(a);var n=V.getValue(t.id,V.random());return s.vs[n]?void V.showException("控件id为"+id+"的子控件已经存在，请更换id名"):(s.vs[n]=a,V.inherit.apply(t,[M.Control,[]]),s.vms[n]=t,a.bind(t),t)},s.render=function(e){return e=i.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"value":s.onValue([t],function(e){switch(typeof e){case"string":s.panel.empty().append(e);break;case"object":s.panel.empty(),s.addControl(null,e)}});break;case"values":s.onValue(t,function(e){switch(typeof e){case"string":s.panel.empty().append(e);break;case"object":V.isArray(e)||(e=[e]),s.panel.empty(),V.each(e,function(e){s.addControl(null,e)})}});break;case"addvalues":s.onValue(t,function(e){switch(typeof e){case"string":s.panel.append(e);break;case"object":V.isArray(e)||(e=[e]),V.each(e,function(e){s.addControl(null,e)})}});break;case"top":t&&(s.get().top=!1,s.onBackAnimate(s.node,V.merge(s.status,{transform:{tx:0,ty:0}},!0)));break;case"bottom":t&&(s.get().bottom=!1,s.onBackAnimate(s.node,V.merge(s.status,{transform:{tx:s.status.vol?0:s.node.width()-s.panel.width(),ty:s.status.hor?0:s.node.height()-s.panel.height()}},!0)));break;case"freeze":case"lock":s.lock=t}},function(){},!0),s.panel.show(),e},s.onValue=function(e,t){V.isArray(e)||(e=[e]);var a=V.sb();V.each(e,function(e){"string"==typeof e?a.append(e):a.append(V.toJsonString(e))},function(){t(a.clear()),a=null})},s.onBackAnimate=function(e,t){V.once(function(){if(t.vol&&t.transform.ty<0&&t.transform.ty>s.node.height()-s.panel.height())return void(t.transform.y=t.transform.ty);if(t.hor&&t.transform.tx<0&&t.transform.tx>s.node.width()-s.panel.width())return void(t.transform.x=t.transform.tx);V.merge(t.transform,{tx:Math.min(0,Math.max(s.node.width()-s.panel.width(),t.transform.tx)),ty:Math.min(0,Math.max(s.node.height()-s.panel.height(),t.transform.ty)),scale:1,angle:0,rx:0,ry:0,rz:0,startX:0,startY:0},!0),V.merge(t.transform,{x:t.transform.tx,y:t.transform.ty},!0);var e=V.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d({rx},{ry},{rz},{angle}deg)",t.transform);s.panel.addClass("animate").css("webkitTransform",e).css("mozTransform",e).css("transform",e).show()},10)}},W.TextBox=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<span class="c_textBox"><span style="display:none;"></span><input type="text"/></span>',t||{}]]),n.render=a.render,n.onLoad=a.onLoad,a.onLoad=function(e){a.txt=e.find("span:first"),a.input=e.find("input:first"),V.forC(a.events,function(t,n){switch(t){case"hover":a.node.hover(function(){e.parents("[disabled]").length>0||a.call("Hover",{hover:!0})},function(){e.parents("[disabled]").length>0||a.call("Hover",{hover:!1})});break;case"error":a.get().validate&&a.validate(a,a.input);break;default:a.bindEvent(a.input,t,n)}},function(){n.onLoad(e)},!0)},a.fill=function(){var e=$.trim(a.input.val());return e=e==a.vm.data.title||e==a.vm.data.error?"":e,{text:e,value:e}},a.render=function(e){return e=n.render(e),V.forC(e,function(t,n){switch(t){case"enable":n?a.input.removeAttr("disabled"):a.input.attr("disabled","disabled");break;case"title":n?(a.input.focus(function(){a.input.val()!=n&&a.input.text()!=n&&a.input.val()!=a.vm.data.error&&a.input.text()!=a.vm.data.error||a.input.val("")}),a.input.off("blur").on("blur",function(){""==a.input.val()&&""==a.input.text()&&a.render({value:n})})):a.input.off("blur").off("focus").focus(function(){a.input.val()!=a.vm.data.error&&a.input.text()!=a.vm.data.error||a.input.val("")});break;case"text":case"value":"boolean"!=typeof n&&"false"!=(""+n).toLowerCase()&&"undefined"!=(""+n).toLowerCase()?(a.input.val(n),a.vm.data.title&&!V.isValid(n)&&a.input.val(a.vm.data.title)):(delete a.vm.data.value,delete a.vm.data.text,a.input.val(""));break;case"name":a.input.attr("name",n),delete e[t];break;case"key":a.txt.text(n).show(),delete e[t];break;case"size":a.input.attr("size",n),delete e[t];break;case"kind":a.input.attr("type",n),delete e[t];break;case"maxlength":a.input.attr("maxlength",n),delete e[t]}}),e},a.animate=function(e,t){a._animate(e,a.input,t)}},W.RadioBox=function(e,t){var a=this,n={};V.inherit.apply(a,[W.TextBox,[e||'<span class="c_radioBox"><span style="display:none;"></span><input type="radio"/></span>',t]]),n.render=a.render,n.onLoad=a.onLoad,a.fill=function(){var e={checked:!!a.input.attr("checked")};return e.value=e.checked,e},a.render=function(e){return e=n.render(e),V.forC(e,function(t,n){switch(t){case"checked":case"value":V.setChecked(a.input,n),delete e[t]}}),e}},W.CheckBox=function(e,t){var a=this;V.inherit.apply(a,[W.RadioBox,[e||'<span class="c_checkBox"><span style="display:none;"></span><input type="checkbox"/></span>',t]])},W.Select=function(path,vm){var _=this,__={};V.inherit.apply(_,[W.Control,[path||'<span class="c_select"><span style="display:none;"></span><select></select></span>',vm]]),__.render=_.render,__.onLoad=_.onLoad,_.onLoad=function(e){_.txt=e.find("span:first"),_.sel=e.find("select:first"),V.forC(_.events,function(e,t){_.bindEvent(_.sel,e,t)},null,!0),_.events.error&&_.get().validate&&_.validate(_,_.input),__.onLoad(e)},_.fill=function(){return{value:_.sel.find("option:selected").val()}},_.render=function(data){data=__.render(data);var setValue=function(e){_.vm.data.preValue=_.sel.find(":selected").val(),_.sel.find(":selected").attr("selected",!1),_.sel.find('option[value="'+e+'"]').attr("selected",!0)};return V.forC(data,function(key,value){switch(key){case"values":if("string"==V.getType(value)&&(value=eval("("+value+")")),V.userAgent.ie7||V.userAgent.ie8)V.forC(value,function(e,t){var a=document.createElement("OPTION");_.sel.get(0).appendChild(a),_.vm.data.value&&_.vm.data.value==t&&(a.selected=!0),a.innerText=e,a.value=t},function(){V.once(function(){_.sel.css("display","none").css("display","block")})},!0);else{var sb=V.sb();V.forC(value,function(e,t){sb.appendFormat('<option value="{value}">{key}</option>',{key:e,value:t})},function(){_.sel.empty().html(sb.clear()),sb=null,_.vm.data.value&&setValue(_.vm.data.value)})}break;case"value":setValue(value);break;case"name":_.sel.attr("name",value);break;case"key":_.txt.text(value).show();break;case"enable":value?_.sel.removeAttr("disabled"):_.sel.attr("disabled","disabled")}}),data},_.animate=function(e,t){_._animate(e,_.sel,t)}},W.RadioList=function(e,t,a){var n=this,o={};V.inherit.apply(n,[W.Control,[e||'<span class="c_RadioList"><span></span><ul></ul></span>',a||{}]]),o.onLoad=n.onLoad,o.render=n.render,n.content=V.getValue(t,'<li><span class="c_RadioList_li"><input name="{name}" type="radio" value="{value}"/><span>{key}</span></span></li>'),n.fill=function(){return{value:n.ul.find(":radio:checked").val()}},n.onLoad=function(e){n.title=e.find("span:first"),n.ul=e.find("ul"),n.vm.data.name=V.getValue(n.vm.data.name,"radio"),V.forC(n.events,function(t,a){n.bindEvent(e,t,a)},function(){o.onLoad(e)})},n.render=function(e){e=o.render(e);var t=function(e){V.setChecked(n.ul.find(":radio:checked"),!1),V.setChecked(n.ul.find(':radio[value="'+e+'"]'),!0)};return V.forC(e,function(e,a){switch(e){case"key":n.title.html(a);break;case"values":var o=V.sb();V.forC(a,function(e,t){o.appendFormat(n.content,{key:e,value:t,name:n.vm.data.name})},function(){n.ul.empty().append(o.toString()),o.clear(),o=null,n.vm.data.value&&t(n.vm.data.value)});break;case"value":t(a);break;case"name":n.node.find(":radio").attr("name",a);break;case"enable":value?n.node.find(":radio").removeAttr("disabled"):n.node.find(":radio").attr("disabled","disabled")}}),e},n.animate=function(e,t){n._animate(e,n.ul,t)}},W.CheckList=function(e,t,a){var n=this,o={};V.inherit.apply(n,[W.Control,[e||'<div class="c_CheckList"><span></span><ul></ul></div>',a||{}]]),o.onLoad=n.onLoad,o.render=n.render,n.content=V.getValue(t,'<li><span class="c_CheckList_li"><input name="{name}" type="checkbox" value="{value}"/><span>{key}</span></span></li>'),n.fill=function(){return n.ul.children().length>0?{value:function(){var e=[];return n.ul.find(":checkbox:checked").each(function(t,a){e.push($(a).val())}),e.join(",")}()}:{}},n.onLoad=function(e){n.title=e.find("span:first"),n.ul=e.find("ul"),n.vm.data.name=V.getValue(n.vm.data.name,"check"),V.forC(n.events,function(t,a){n.bindEvent(e,t,a)},function(){o.onLoad(e)})},n.render=function(e){e=o.render(e);var t=function(e){e=V.getValue(e+"",""),V.setChecked(n.ul.find(":checkbox:checked"),!1),V.each(e.split(","),function(e){V.setChecked(n.ul.find(':checkbox[value="'+e+'"]'),!0)})};return V.forC(e,function(e,a){switch(e){case"key":n.title.html(a);break;case"values":var o=V.sb();V.forC(a,function(e,t){o.appendFormat(n.content,{key:e,value:t,name:n.vm.data.name})},function(){n.ul.empty().append(o.clear()),o=null,n.vm.data.value&&t(n.vm.data.value)});break;case"value":t(a);break;case"name":n.node.find(":checkbox").attr("name",a);break;case"enable":value?n.node.find(":checkbox").removeAttr("disabled"):n.node.find(":checkbox").attr("disabled","disabled")}}),e},n.animate=function(e,t){n._animate(e,n.sel,t)}},W.Hidden=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<input class="c_hidden" type="hidden"/>',t]]),n.render=a.render,n.onLoad=a.onLoad,a.onLoad=function(e){V.forC(a.events,function(t,n){switch(t.toLowerCase()){case"error":a.get().validate&&a.validate(a,a.node);break;default:a.bindEvent(e,t,n)}},null,!0),n.onLoad(e)},a.fill=function(){return{val:a.node.val()}},a.render=function(e){return e=n.render(e),V.forC(e,function(e,t){switch(e){case"value":a.node.val(t);break;case"name":a.node.attr("name",t)}}),e}},W.PasswordBox=function(e,t){var a=this,n={};V.inherit.apply(a,[W.TextBox,[e||'<span class="c_passwordBox"><span style="display:none;"></span><input type="password"/></span>',t]]),n.render=a.render,a.render=function(e){return e=n.render(e),V.forC(e,function(e,t){switch(e){case"alt":case"passchar":a.input.attr("alt",t)}}),e}},W.Button=function(e,t){var a=this,n={};V.inherit.apply(a,[W.TextBox,[e||'<span class="c_button"><span style="display:none;"></span><input type="button"/></span>',t]]),n.render=a.render,a.fill=function(){return{}},a.render=function(e){return e=n.render(e),V.forC(e,function(e,t){switch(e){case"name":a.input.attr("name",t);break;case"key":a.txt.text(t).show();break;case"text":a.input.val(t)}}),e}},W.Submit=function(e,t){var a=this;V.inherit.apply(a,[W.Button,[e||'<span class="c_submit"><span style="display:none;"></span><input type="submit"/></span>',t]])},W.Reset=function(e,t){var a=this;V.inherit.apply(a,[W.Button,[e||'<span class="c_reset"><span style="display:none;"></span><input type="reset"/></span>',t]])},W.Form=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<form method="get" action="" class="c_form"></form>',t||{data:{enctype:"multipart/form-data"}}]]),n.render=a.render,n.onLoad=a.onLoad,a.onLoad=function(e){V.forC(a.events,function(t,n){a.bindEvent(e,t,n)},function(){n.onLoad(e)},!0),a.cons=[],e.find("[_]").each(function(e,t){a.cons.push($(t).attr("id"))})},a.fill=function(){var e={};return a.cons&&V.each(a.cons,function(t){var n=a.parent.vms[t]?a.parent.vms[t]:a.page.vms[t];n&&"fill"!=n.nodeName&&(e[t]=n.get().value)},null,!0),{value:e}},a.render=function(e){return V.forC(e,function(t,n){switch(t){case"method":a.node.attr("method",n);break;case"action":a.node.attr("action",n);break;case"target":a.node.attr("target",n);break;case"name":a.node.attr("name",n);break;case"enctype":a.node.attr("enctype",n);break;case"valid":if(n){delete e.valid;var o=Array.prototype.slice.call(a.cons,0);V.whileC2(function(){return o.shift()},function(e,t){var n=a.parent.vms[e]?a.parent.vms[e]:a.page.vms[e];n&&n.update({valid:t})},function(){n.apply(null,[])})}break;case"enable":n=!!n,delete e.enable,V.each(a.cons,function(e){var t=a.parent.vms[e]?a.parent.vms[e]:a.page.vms[e];t&&t.update({enable:n})});break;case"value":n?(a.vm.data.value=n,V.each(a.cons,function(e){var t=a.parent.vms[e]?a.parent.vms[e]:a.page.vms[e];t&&("fill"==t.nodeName?t.update({value:n||{}}):void 0!=n[e]&&t.update({value:n[e]}))})):a.node[0].reset()}},function(){n.render(e)}),e}},W.Router=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Panel,[e||'<div style="display:none;" class="c_router"></div>',t||{data:{showaction:"fadeInRight",hideaction:"fadeOutRight"}}]]),n.render=a.render,n.onLoad=a.onLoad,a.addDesc("Router:"),a.addDesc("\t负责提供SPA条件下的页面的前进和后退转换与大小统一设置允许定义 showaction与hideaction作为显示隐藏动画 而且默认显示第一个页面并调用其Active事件和canActive属性 isActive属性，Resize事件 "),a.addDesc("属性:"),a.addDesc("\tshowaction:config中定义的show动画"),a.addDesc("\thideaction:config中定义的hide动画"),a.addDesc("\tnext:按照顺序进行下一个canActive的控件 当输入id时按照ID进行切换,并通知内部子控件的Active事件"),a.addDesc("\tprev:按照顺序回滚上一个canActive的控件 当输入id时按照ID进行寻找如果属于子控件，而且历史上访问过子控件那么将子控件之后的历史全部删除，如果子控件已经canActive为真且切换至子控件，否则只删除记录不切换。并通知内部子控件的Active事件"),a.addDesc("\tsize:设置控件的高宽，并通知内部控件onSize事件"),a.addDesc("\tvalues:清理内部控件，重新addControl内部控件，设置其隐藏状态，并自动设置其size属性和第一个控件的active事件"),a.addDesc("\taddvalues:addControl新内部控件，并自动设置其size和第一个可用控件的active事件"),a.addDesc("事件:"),a.addDesc("\tonChange:不论前进还是后退更新当前value（子控件ID）值"),a.addDesc("附加给内部子控件的事件:"),a.addDesc("\tActive:触发内部控件的事件，并设置其isActive属性为真"),a.addDesc("\tonInactive:触发内部控件的事件，并设置其isActive属性为假"),a.addDesc("\tonResize:触发内部控件的事件，并设置其width,height,size属性"),a.addDesc("附加给内部子控件的属性:"),a.addDesc("\tcanActive:为真时不可被重新设置到"),a.onLoad=function(e){V.forC(a.events,function(t,n){switch(t.toLowerCase()){case"change":break;default:a.bindEvent(e,t,n)}},function(){n.onLoad(e)},!0),a.reload(e),n.cons.length>0&&(a.vm.data.next=n.cons[0])},a.reload=function(e){n.cons=[],n.vms={},n.his=[],e.children().each(function(e,t){var o=$(t).hide().attr("id");if(o){var s=a.vms[o]?a.vms[o]:a.parent.vms[o]?a.parent.vms[o]:a.page.vms[o];s?(n.cons.push(o),n.vms[o]=s,V.merge(s,{canActive:s.data&&s.data.canActive||!0,isActive:!1},!0)):V.showException("不是VJ控件，自动隐藏")}else V.showException("没有找到id,自动隐藏")})},a.change=function(e){e&&(a.vm.data.value&&(n.vms[a.vm.data.value].update({hide:a.vm.data.hideaction,isActive:!1}),n.vms[a.vm.data.value].call("inactive")),n.vms[e]&&(n.vms[e].update({showaction:a.vm.data.showaction,isActive:!0}),n.vms[e].call("active")),a.call("change",{value:e,visible:!0}))},a.render=function(e){return V.forC(e,function(e,t){switch(e.toLowerCase()){case"value":n.his.push(t),a.change(t);break;case"next":if(t){
if(t==a.vm.data.value)return;if(!n.vms[t]||t==a.vm.data.value){t=null;for(var o=!1,s=0;s<n.cons.length;s++)o&&V.getValue(n.vms[n.cons[s]].canActive,!0)?(t=n.cons[s],s=n.cons.length):n.cons[s]==a.vm.data.value&&(o=!0)}n.his.push(t),a.change(t)}break;case"prev":if(t){if(t==a.vm.data.value)return;if(n.vms[t]&&t!=a.vm.data.value){var o=!1,i=Array.prototype.slice.call(n.his,0);V.whileC(function(){return o?null:i.pop()},function(e){e==t&&(o=!0,n.his=i,n.his.push(e))},null,!0),o&&V.getValue(n.vms[t].data.canActive,!0)||(t=null)}else t=null,V.whileC(function(){return null==t?n.his.pop():null},function(e){V.getValue(n.vms[e].data.canActive,!0)&&(t=e)},null,!0);a.change(t)}break;case"size":t&&t.width&&t.height&&(a.node.width(t.width),a.node.height(t.height),a.node.children().width(t.width),a.node.children().height(t.height),V.each(n.cons,function(e){n.vms[e].call("size",{size:t})}));break;case"clear":V.forC(n.vms,function(e,t){a.removeControl(e)},function(){n.cons=[],n.vms={},n.his=[],delete a.vm.data.value});break;case"addvalues":case"values":V.next(function(t,o){"values"==e.toLowerCase()?V.forC(n.vms,function(e,t){a.removeControl(e)},function(){n.cons=[],n.vms={},n.his=[],delete a.vm.data.value,o()}):o()},function(e,o){V.each(t,function(e){e.onActive=e.onActive?e.onActive:function(e,t){t.update({show:e.showaction}),V.once(function(){t.call("showed")},500)},a.addControl(null,e)},function(){a.reload(a.node),n.cons.length>0&&a.render({size:a.vm.data.size,value:n.cons[0]})})})}},function(){n.render(e)}),e}}}(VJ,jQuery,VJ.view,VJ.viewmodel);