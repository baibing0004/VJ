!function(V,$,W,M){W.Box=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<div class="c_box"></div>',t||{border:1}]]),n.render=a.render,n.onLoad=a.onLoad,a.onLoad=function(e){V.forC(a.events,function(e,t){a.bindEvent(a.node,e,t)},null,!0),n.onLoad(e)},a.render=function(e){return e=n.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"border":a.node.css({border:"solid "+t+"px"});break;case"key":a.node.css({"text-align":"center","line-height":a.node.height()+"px","vertical-align":"middle",margin:"0 auto",minwidth:"40px",minheight:"20px"}).html(t)}}),e}},W.FillControl=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<div class="c_fillControl"></div>',t||{}]]),n.onLoad=a.onLoad,n.render=a.render,n.replaceNode=a.replaceNode,a.onLoad=function(e){V.forC(a.events,function(e,t){"click"==e.toLowerCase()?(a.node.on("click","input",function(e){var t=$(this);return a.call("click",{e:e,vid:t.val(),name:t.attr("name")}),V.stopProp(e),!1}),a.node.on("click","a,.click",function(e){var t=$(this);return!(!t.attr("href")||!(t.attr("href").indexOf("http://")>=0||t.attr("href").indexOf("https://")>=0))||(a.call("click",{e:e,vid:t.attr("vid")||t.attr("href"),name:t.attr("name")}),V.stopProp(e),!1)})):a.bindEvent(a.node,e,t)},null,!0),n.onLoad(e)},a.replaceNode=function(){n.content=a.node.html(),n.replaceNode.apply(a,arguments)},a.render=function(e){return e=n.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"value":a.node.html(V.format(n.content,t))}}),e}},W.History=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<span class="c_history" style="display:none;"></span>',t||{}]]),n.onLoad=a.onLoad,n.render=a.render,a.fill=function(){return{hash:window.location.hash.replace(/#/g,"")}},a.onLoad=function(e){V.forC(a.events,function(e,t){switch(e.toLowerCase()){case"change":$(window).bind("hashchange",function(e){a.lastAction!=window.location.hash.replace(/#/g,"")&&(a.call("change",{lastAction:a.lastAction}),a.lastAction=a.get().history.pop())})}},function(){n.onLoad(e)})},a.render=function(e){return e&&(delete e.visible,delete e.invisible),e=n.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"add":if(a.get().history||(a.get().history=[]),window.location.hash){var n=a.get().history;n.length>0&&n[n.length-1]==window.location.hash.replace(/#/g,"")||n.push(window.location.hash.replace(/#/g,""))}t=t.replace(/#/g,""),a.lastAction!=t&&(window.location.hash=t,a.lastAction=t);break;case"remove":a.get().history.pop();break;case"back":a.get().history&&a.get().history.length>0&&t&&(window.location.hash=a.get().history.pop())}}),e}},W.Panel=function(e,t,a,n,o){var i=this,s={};V.inherit.apply(i,[W.Control,[e||'<div class="c_panel"></div>',t||{}]]),s.onLoad=i.onLoad,s.render=i.render,s.hasRender=!1,s.status={panelid:V.random(),transform:{tx:0,ty:0,scale:1,angle:0,rx:0,ry:0,rz:0},callevent:{value:!1},limit:V.getValue(a,0),limitBack:V.getValue(n,!0),lock:o||!1,startX:0,startY:0},i.status=s.status,s.moving=!1,i.am=function(e,t,a){s.status.lock||s.moving||(V.once(function(){s.status.transform=V.merge(s.status.transform,t);var a=V.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d(0,0,0,{angle}deg)",s.status.transform);e.css("webkitTransform",a).css("mozTransform",a).css("transform",a),s.moving=!1},a||1e3/60),s.moving=!0)},i.onLoad=function(e){V.forC(i.events,function(t,a){switch(t.toLowerCase()){case"up":V.merge(s.status,{vol:!0,up:!0},!0);break;case"down":V.merge(s.status,{vol:!0,down:!0},!0);break;case"upout":V.merge(s.status,{vol:!0,upout:!0},!0);break;case"downout":V.merge(s.status,{vol:!0,downout:!0},!0);break;case"left":V.merge(s.status,{hor:!0,left:!0},!0);break;case"right":V.merge(s.status,{hor:!0,right:!0},!0);break;case"leftout":V.merge(s.status,{hor:!0,leftout:!0},!0);break;case"rightout":V.merge(s.status,{hor:!0,rightout:!0},!0);break;case"scale":V.merge(s.status,{pinch:!0},!0);break;case"rotate":V.merge(s.status,{rotate:!0},!0);break;case"dblclick":V.merge(s.status,{dblclick:!0},!0);default:i.bindEvent(e,t,a)}},function(){e.attr("panelid",s.status.panelid),s.status.panelaction=function(){var e=[];return s.status.vol&&e.push("vol"),s.status.hor&&e.push("hor"),s.status.pinch&&e.push("pinch"),s.status.rotate&&e.push("rotate"),s.status.dblclick&&e.push("dblclick"),e}(),e.attr("panelaction",s.status.panelaction.join(",")),s.onLoad(e)})},i.fill=function(){return{}},i.render=function(e){return e=s.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"width":i.node.width(t);break;case"height":i.node.height(t)}},null,!0),s.hasRender||(s.document=$(document),s.hasRender=!0,s.finalMove=!1,s.mc=new Hammer.Manager(i.node[0]),s.mc.add(new Hammer.Pan({threshold:0,pointers:0})),(s.status.rotate||s.status.pinch)&&s.mc.add(new Hammer.Rotate({threshold:0})).recognizeWith(s.mc.get("pan")),s.status.pinch&&s.mc.add(new Hammer.Pinch({threshold:0})).recognizeWith([s.mc.get("pan"),s.mc.get("rotate")]),s.status.dblclick&&s.mc.add(new Hammer.Tap({event:"doubletap",taps:2})),s.mc.on(V.format("panleft panright panup pandown {pinorrot} {doubleclick}",{pinorrot:s.status.rotate?"rotatestart rotatemove rotateend rotate":s.status.pinch?"pinchstart pinchmove pinchend":"",doubleclick:s.status.dblclick?"doubletap":""}),function(e){var t=e.target.hasAttribute("panelid")?$(e.target):$(e.target).parents("[panelid]:first");if((t=t.length>0?t:null)&&t.attr("panelid")==s.status.panelid)switch(e.type){case"panright":case"panleft":case"swiperight":case"swipeleft":$.inArray("hor",s.status.panelaction)<0&&(t=$(t).parents("[panelid]:first"),t=t.length>0?t:null);break;case"panup":case"pandown":case"swipeup":case"swipedown":$.inArray("vol",s.status.panelaction)<0&&(t=$(t).parents("[panelid]:first"),t=t.length>0?t:null);break;case"pinchstart":case"pinchmove":case"pinchin":case"pinchout":case"pinchend":$.inArray("pinch",s.status.panelaction)<0&&(t=$(t).parents("[panelid]:first"),t=t.length>0?t:null);break;case"rotate":case"rotatestart":case"rotatemove":case"rotateend":$.inArray("rotate",s.status.panelaction)<0&&(t=$(t).parents("[panelid]:first"),t=t.length>0?t:null);break;case"doubletap":$.inArray("dblclick",s.status.panelaction)<0&&(t=$(t).parents("[panelid]:first"),t=t.length>0?t:null)}if(t&&t.attr("panelid")!=s.status.panelid&&""!=t.attr("panelaction")){var a=t.attr("panelaction").split(",");switch(e.type){case"panright":case"panleft":case"swiperight":case"swipeleft":if($.inArray("hor",a)>=0)return;break;case"panup":case"pandown":case"swipeup":case"swipedown":if($.inArray("vol",a)>=0)return;break;case"pinchstart":case"pinchmove":case"pinchin":case"pinchout":case"pinchend":if($.inArray("pinch",a)>=0)return;break;case"rotate":case"rotatestart":case"rotatemove":case"rotateend":if($.inArray("rotate",a)>=0)return;break;case"doubletap":if($.inArray("dblclick",a)>=0)return}}if(!s.finalMove){switch(i.node.removeClass("animate").find(".animate").removeClass("animate"),e.type){case"panright":case"swiperight":s.status.hor&&!s.rotating&&!s.finalMove&&Math.abs(e.deltaX)>Math.abs(e.deltaY)?(s.status.lastAction="right",s.finalMove=i.onRight(e,s.status)):!s.status.hor&&document.body.clientWidth<document.body.scrollWidth&&(0==s.status.startX&&(s.status.startX=s.document.scrollLeft()),s.document.scrollLeft(Math.max(s.status.startX-e.deltaX,0)));break;case"panleft":case"swipeleft":s.status.hor&&!s.rotating&&!s.finalMove&&Math.abs(e.deltaX)>Math.abs(e.deltaY)?(s.status.lastAction="left",s.finalMove=i.onLeft(e,s.status)):!s.status.hor&&document.body.clientWidth<document.body.scrollWidth&&(0==s.status.startX&&(s.status.startX=s.document.scrollLeft()),s.document.scrollLeft(Math.min(s.status.startX-e.deltaX,document.body.scrollWidth-document.body.clientWidth)));break;case"panup":case"swipeup":s.status.vol&&!s.rotating&&!s.finalMove&&Math.abs(e.deltaX)<Math.abs(e.deltaY)?(s.status.lastAction="up",s.finalMove=i.onUp(e,s.status)):!s.status.vol&&window.screen.availHeight<document.body.scrollHeight&&(0==s.status.startY&&(s.status.startY=s.document.scrollTop()),s.document.scrollTop(Math.max(s.status.startY-e.deltaY,document.body.scrollHeight-document.body.clientHeight)));break;case"pandown":case"swipedown":s.status.vol&&!s.rotating&&!s.finalMove&&Math.abs(e.deltaX)<Math.abs(e.deltaY)?(s.status.lastAction="down",s.finalMove=i.onDown(e,s.status)):!s.status.vol&&window.screen.availHeight<document.body.scrollHeight&&(0==s.status.startY&&(s.status.startY=s.document.scrollTop()),s.document.scrollTop(Math.min(s.status.startY-e.deltaY,document.body.scrollHeight)));break;case"pinchstart":s.rotating=!0;case"pinchmove":s.finalMove=i.onScale(e,s.status);break;case"pinchin":case"pinchout":s.status.lastAction="scale",s.scale=e.scale;break;case"pinchend":s.rotating=!1;break;case"rotate":case"rotatestart":s.rotating=!0;case"rotatemove":s.status.lastAction="rotate",s.status.angle=e.angle,s.finalMove=i.onRotate(e,s.status),s.pinch&&(s.status.scale=e.scale);break;case"rotateend":s.rotating=!1}s.finalMove&&V.once(function(){s.status.callevent.value&&i.onFinal(s.status),i.onBackAnimate(i.node,s.status),s.status.callevent.value=!1,V.once(function(){s.finalMove=!1},300)},100)}}),s.mc.on("hammer.input",function(e){e.isFinal&&!s.finalMove&&V.once(function(){s.status.callevent.value&&i.onFinal(s.status),i.onBackAnimate(i.node,s.status),s.status.callevent.value=!1,V.once(function(){s.finalMove=!1},300)},100)})),e},i.onLeft=function(e,t){if(!(Math.abs(e.deltaX)<Math.max(30,i.node.width()*t.limit)))return t.callevent.value=!0,t.limitBack;i.am(i.node,{tx:t.left||t.leftout?e.deltaX:Math.max(0,e.deltaX),ty:0})},i.onRight=function(e,t){if(!(Math.abs(e.deltaX)<Math.max(30,i.node.width()*t.limit)))return t.callevent.value=!0,t.limitBack;i.am(i.node,{tx:t.right||t.rightout?e.deltaX:Math.max(0,e.deltaX),ty:0})},i.onUp=function(e,t){if(!(Math.abs(e.deltaY)<Math.max(30,i.node.height()*t.limit)))return t.callevent.value=!0,t.limitBack;i.am(i.node,{ty:t.up||t.upout?e.deltaY:Math.max(0,e.deltaY),tx:0})},i.onDown=function(e,t){if(!(Math.abs(e.deltaY)<Math.max(30,i.node.height()*t.limit)))return t.callevent.value=!0,t.limitBack;i.am(i.node,{ty:t.down||t.downout?e.deltaY:Math.min(0,e.deltaY),tx:0})},i.onScale=function(e,t){Math.abs(e.scale-1)<t.limit?i.am(i.node,{scale:e.scale}):t.callevent.value=!0},i.onRotate=function(e,t){i.am(i.node,{angle:e.rotation,scale:t.pinch?e.scale:1}),t.callevent.value=!0},i.onBackAnimate=function(e,t){switch(V.merge(t.transform,{tx:0,ty:0,scale:1,angle:0,rx:0,ry:0,rz:0,startX:0,startY:0},!0),t.lastAction){case"left":t.leftout&&(t.transform.tx=-1*screen.width);break;case"right":t.rightout&&(t.transform.tx=screen.width);break;case"up":t.upout&&(t.transform.ty=-1*screen.height);break;case"down":t.downout&&(t.transform.ty=screen.height)}var a=V.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d({rx},{ry},{rz},{angle}deg)",t.transform);switch(e.addClass("animate").css("webkitTransform",a).css("mozTransform",a).css("transform",a),t.lastAction){case"left":t.leftout&&e.hide();break;case"right":t.rightout&&e.hide();break;case"up":t.upout&&e.hide();break;case"down":t.downout&&e.hide()}},i.onFinal=function(e){switch(e.lastAction){case"left":e.leftout?i.call("leftout"):i.call("left");break;case"right":e.rightout?i.call("rightout"):i.call("right");break;case"up":e.upout?i.call("upout"):i.call("up");break;case"down":e.downout?i.call("downout"):i.call("down");break;case"scale":i.call("scale",{scale:e.scale});break;case"rotate":e.pinch&&1!=e.scale&&i.call("scale",{scale:e.scale}),i.call("rotate",{angle:e.angle})}}},W.PagePanel=function(e,t,a,n,o){var i=this,s={};V.inherit.apply(i,[e.getTypeByAppName("VESH.view","panel"),[V.getValue(t,'<div style="overflow:hidden;"  class="c_pagePanel"><div style="display:none;"></div></div>'),V.merge(V.getValue(a,{}),{data:{direction:"hor",value:0},onLeft:function(e,t){i.change(!0)},onRight:function(e,t){i.change(!1)},onUp:function(e,t){i.change(!0)},onDown:function(e,t){i.change(!1)}},!0),n||.2,o||!0,!0]]),s.onLoad=i.onLoad,s.render=i.render,i.lock=!1,i.onLoad=function(e){switch(e.removeClass("animate"),i.panel=e.find("div:first"),i.children=i.panel.siblings(),i.length=i.children.length,i.children.width(e.width()).height(e.height()).css("overflow","hidden").css("position","relative"),i.children.addClass("noactive"),i.panel.append(i.children),i.get().direction){case"vol":i.vol=!0,delete i.events.left,delete i.events.right,i.panel.css("height",i.length+"00%").css("width","100%");break;case"hor":default:i.hor=!0,delete i.events.up,delete i.events.down,i.panel.css("width",i.length+"00%").css("height","100%"),i.children.css("float","left")}V.forC(i.events,function(t,a){switch(t=t.toLowerCase()){case"change":break;default:i.bindEvent(e,t,a)}},function(){s.onLoad(e)})},s.onLeft=i.onLeft,i.onLeft=function(e,t){if(!i.vol&&!i.lock)return s.distance=Math.abs(e.deltaX),s.onLeft(e,t)},s.onRight=i.onRight,i.onRight=function(e,t){if(!i.vol&&!i.lock)return s.distance=Math.abs(e.deltaX),s.onRight(e,t)},s.onUp=i.onUp,i.onUp=function(e,t){if(!i.hor&&!i.lock)return s.distance=Math.abs(e.deltaY),s.onUp(e,t)},s.onDown=i.onDown,i.onDown=function(e,t){if(!i.hor&&!i.lock)return s.distance=Math.abs(e.deltaY),s.onDown(e,t)},s.first=!0,i.render=function(e){e=s.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"value":i.change(t,!0,s.first),s.first=!1;break;case"freeze":case"lock":i.lock=t;break;case"height":i.panel.children().height(t);break;case"width":i.panel.children().width(t);break;case"values":var a=V.newEl("div","","").css("display","none;");V.each(t,function(e){a.append(e)},function(){i.children=a.children(),i.length=i.children.length,i.children.width(i.node.width()).height(i.node.height()).css("overflow","hidden").css("position","relative"),i.children.addClass("noactive"),i.panel.empty().append(i.children),i.vol?i.panel.css("height",i.length+"00%").css("width","100%"):(i.panel.css("width",i.length+"00%").css("height","100%"),i.children.css("float","left")),i.change(NaN==i.index?0:i.index,!0,!0),a.remove()},!1)}},function(){},!0)},i.change=function(e,t,a){e=(""+e).toLowerCase();var n=Math.ceil(s.distance/(i.hor?i.node.width():i.node.height()));e=Math.max(0,Math.min(i.children.length-1,"true"==e?i.get().value+n:"false"==e?i.get().value-n:parseInt(e))),i.index=e,t||e==parseInt(i.get().value)?i.onBackAnimate(i.panel,i.status,a):i.call("change",{value:e})},i.onBackAnimate=function(e,t,a){V.once(function(){V.merge(t.transform,{tx:0,ty:0,scale:1,angle:0,rx:0,ry:0,rz:0,startX:0,startY:0},!0),i.hor?t.transform.tx-=i.node.width()*i.index:i.vol&&(t.transform.ty-=i.node.height()*i.index);var e=V.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d({rx},{ry},{rz},{angle}deg)",t.transform);a||i.panel.addClass("animate"),i.panel.css("webkitTransform",e).css("mozTransform",e).css("transform",e).show()},10)}},W.ScrollPanel=function(e,t,a,n,o){var i=this,s={};V.inherit.apply(i,[e.getTypeByAppName("VESH.view","panel"),[V.getValue(t,'<div style="overflow:hidden;"  class="c_scrollPanel"><div style="display:none;"></div></div>'),V.merge(V.getValue(a,{}),{data:{direction:"vol"},onLeft:function(e,t){i.call("next")},onRight:function(e,t){i.call("reload")},onUp:function(e,t){i.call("next")},onDown:function(e,t){i.call("reload")}},!0),n||.2,o||!0]]),s.onLoad=i.onLoad,s.render=i.render,i.lock=!1,V.merge(i.status.transform,{x:0,y:0},!0),i.onLoad=function(e){switch(e.removeClass("animate"),i.panel=e.find("div:first"),i.children=i.panel.siblings(),i.length=i.children.length,i.value=Math.max(0,Math.min(i.children.length,parseInt(i.value))),i.children.css("position","relative"),i.children.addClass("noactive"),i.panel.append(i.children),i.get().direction){case"vol":i.vol=!0,delete i.events.left,delete i.events.right,i.panel.css("width","100%"),i.children.css("width","100%");break;case"hor":default:i.hor=!0,delete i.events.up,delete i.events.down,i.panel.css("height","100%"),i.children.width()&&i.panel.width(i.children.width()),i.children.css("height","100%").css("float","left")}V.forC(i.events,function(t,a){switch(t=t.toLowerCase()){case"next":case"reload":break;default:i.bindEvent(e,t,a)}},function(){s.onLoad(e)})},i.onLeft=function(e,t){if(!i.vol&&!i.lock){s.distance=Math.abs(e.deltaX);var a=t.transform.x+e.deltaX;if(a<i.node.width()-5-i.panel.width()&&(t.callevent.value=!0),!(a>Math.min(-t.limit,i.node.width()-t.limit-i.panel.width())))return t.limitBack;i.am(i.panel,{tx:t.left||t.leftout?a:Math.max(0,e.deltaX),ty:0})}},i.onRight=function(e,t){if(!i.vol&&!i.lock){s.distance=Math.abs(e.deltaX);var a=t.transform.x+e.deltaX;if(a>5&&(t.callevent.value=!0),!(a<t.limit))return t.limitBack;i.am(i.panel,{tx:t.right||t.rightout?a:Math.max(0,e.deltaX),ty:0})}},i.onUp=function(e,t){if(!i.hor&&!i.lock){s.distance=Math.abs(e.deltaY);var a=t.transform.y+e.deltaY;if(a<i.node.height()-5-i.panel.height()&&(t.callevent.value=!0),!(a>Math.min(-t.limit,i.node.height()-t.limit-i.panel.height())))return t.limitBack;i.am(i.panel,{ty:t.up||t.upout?a:Math.max(0,e.deltaY),tx:0})}},i.onDown=function(e,t){if(!i.hor&&!i.lock){s.distance=Math.abs(e.deltaY);var a=t.transform.y+e.deltaY;if(a>5&&(t.callevent.value=!0),!(a<t.limit))return t.limitBack;i.am(i.panel,{ty:t.down||t.downout?a:Math.max(0,e.deltaY),tx:0})}},i.onScale=function(e,t){Math.abs(e.scale-1)*Math.min(i.node.width(),i.node.height)<t.limit?i.am(i.panel,{scale:e.scale}):t.callevent.value=!0},i.addControl=function(e,t){i.controls||(i.controls=[],i.vs={},i.vms={},i.models=i.vms);var a=i.middler.getObjectByAppName(W.APP,t.type);if(!a)throw new Error("配置文件中没有找到对象类型定义:"+t.type);e=e||V.newEl("div").appendTo(i.panel),a.init(i,e,t.data),a.page=i.page,i.controls.push(a);var n=V.getValue(t.id,V.random());return i.vs[n]?void V.showException("控件id为"+id+"的子控件已经存在，请更换id名"):(i.vs[n]=a,V.inherit.apply(t,[M.Control,[]]),i.vms[n]=t,a.bind(t),t)},i.render=function(e){return e=s.render(e),V.forC(e,function(e,t){switch(e.toLowerCase()){case"value":i.onValue([t],function(e){switch(typeof e){case"string":i.panel.empty().append(e);break;case"object":i.panel.empty(),i.addControl(null,e)}});break;case"values":i.onValue(t,function(e){switch(typeof e){case"string":i.panel.empty().append(e);break;case"object":V.isArray(e)||(e=[e]),i.panel.empty(),V.each(e,function(e){i.addControl(null,e)})}});break;case"addvalues":i.onValue(t,function(e){switch(typeof e){case"string":i.panel.append(e);break;case"object":V.isArray(e)||(e=[e]),V.each(e,function(e){i.addControl(null,e)})}});break;case"top":t&&(i.get().top=!1,i.onBackAnimate(i.node,V.merge(i.status,{transform:{tx:0,ty:0}},!0)));break;case"bottom":t&&(i.get().bottom=!1,i.onBackAnimate(i.node,V.merge(i.status,{transform:{tx:i.status.vol?0:i.node.width()-i.panel.width(),ty:i.status.hor?0:i.node.height()-i.panel.height()}},!0)));break;case"freeze":case"lock":i.lock=t}},function(){},!0),i.panel.show(),e},i.onValue=function(e,t){V.isArray(e)||(e=[e]);var a=V.sb();V.each(e,function(e){"string"==typeof e?a.append(e):a.append(V.toJsonString(e))},function(){t(a.clear()),a=null})},i.onBackAnimate=function(e,t){V.once(function(){if(t.vol&&t.transform.ty<0&&t.transform.ty>i.node.height()-i.panel.height())return void(t.transform.y=t.transform.ty);if(t.hor&&t.transform.tx<0&&t.transform.tx>i.node.width()-i.panel.width())return void(t.transform.x=t.transform.tx);V.merge(t.transform,{tx:Math.min(0,Math.max(i.node.width()-i.panel.width(),t.transform.tx)),ty:Math.min(0,Math.max(i.node.height()-i.panel.height(),t.transform.ty)),scale:1,angle:0,rx:0,ry:0,rz:0,startX:0,startY:0},!0),V.merge(t.transform,{x:t.transform.tx,y:t.transform.ty},!0);var e=V.format("translate3d({tx}px,{ty}px,0px) scale({scale},{scale}) rotate3d({rx},{ry},{rz},{angle}deg)",t.transform);i.panel.addClass("animate").css("webkitTransform",e).css("mozTransform",e).css("transform",e).show()},10)}},W.TextBox=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<span class="c_textBox"><span style="display:none;"></span><input type="text"/></span>',t||{}]]),n.render=a.render,n.onLoad=a.onLoad,a.onLoad=function(e){a.txt=e.find("span:first"),a.input=e.find("input:first"),V.forC(a.events,function(t,n){switch(t){case"hover":a.node.hover(function(){e.parents("[disabled]").length>0||a.call("Hover",{hover:!0})},function(){e.parents("[disabled]").length>0||a.call("Hover",{hover:!1})});break;case"error":a.get().validate&&a.validate(a,a.input);break;default:a.bindEvent(a.input,t,n)}},function(){n.onLoad(e)},!0)},a.fill=function(){var e=$.trim(a.input.val());return e=e==a.vm.data.title||e==a.vm.data.error?"":e,{text:e,value:e}},a.render=function(e){return e=n.render(e),V.forC(e,function(t,n){switch(t){case"enable":n?a.input.removeAttr("disabled"):a.input.attr("disabled","disabled");break;case"title":n?(a.input.focus(function(){a.input.val()!=n&&a.input.text()!=n&&a.input.val()!=a.vm.data.error&&a.input.text()!=a.vm.data.error||a.input.val("")}),a.input.off("blur").on("blur",function(){""==a.input.val()&&""==a.input.text()&&a.render({value:n})})):a.input.off("blur").off("focus").focus(function(){a.input.val()!=a.vm.data.error&&a.input.text()!=a.vm.data.error||a.input.val("")});break;case"text":case"value":"boolean"!=typeof n&&"false"!=(""+n).toLowerCase()&&"undefined"!=(""+n).toLowerCase()?(a.input.val(n),a.vm.data.title&&!V.isValid(n)&&a.input.val(a.vm.data.title)):(delete a.vm.data.value,delete a.vm.data.text,a.input.val(""));break;case"name":a.input.attr("name",n),delete e[t];break;case"key":a.txt.text(n).show(),delete e[t];break;case"size":a.input.attr("size",n),delete e[t];break;case"kind":a.input.attr("type",n),delete e[t];break;case"maxlength":a.input.attr("maxlength",n),delete e[t]}}),e},a.animate=function(e,t){a._animate(e,a.input,t)}},W.RadioBox=function(e,t){var a=this,n={};V.inherit.apply(a,[W.TextBox,[e||'<span class="c_radioBox"><span style="display:none;"></span><input type="radio"/></span>',t]]),n.render=a.render,n.onLoad=a.onLoad,a.fill=function(){var e={checked:!!a.input.attr("checked")};return e.value=e.checked,e},a.render=function(e){return e=n.render(e),V.forC(e,function(t,n){switch(t){case"checked":case"value":V.setChecked(a.input,n),delete e[t]}}),e}},W.CheckBox=function(e,t){var a=this;V.inherit.apply(a,[W.RadioBox,[e||'<span class="c_checkBox"><span style="display:none;"></span><input type="checkbox"/></span>',t]])},W.Select=function(path,vm){var _=this,__={};V.inherit.apply(_,[W.Control,[path||'<span class="c_select"><span style="display:none;"></span><select></select></span>',vm]]),__.render=_.render,__.onLoad=_.onLoad,_.onLoad=function(e){_.txt=e.find("span:first"),_.sel=e.find("select:first"),V.forC(_.events,function(e,t){_.bindEvent(_.sel,e,t)},null,!0),_.events.error&&_.get().validate&&_.validate(_,_.input),__.onLoad(e)},_.fill=function(){return{value:_.sel.find("option:selected").val()}},_.render=function(data){data=__.render(data);var setValue=function(e){_.vm.data.preValue=_.sel.find(":selected").val(),_.sel.find(":selected").attr("selected",!1),_.sel.find('option[value="'+e+'"]').attr("selected",!0)};return V.forC(data,function(key,value){switch(key){case"values":if("string"==V.getType(value)&&(value=eval("("+value+")")),V.userAgent.ie7||V.userAgent.ie8)V.forC(value,function(e,t){var a=document.createElement("OPTION");_.sel.get(0).appendChild(a),_.vm.data.value&&_.vm.data.value==t&&(a.selected=!0),a.innerText=e,a.value=t},function(){V.once(function(){_.sel.css("display","none").css("display","block")})},!0);else{var sb=V.sb();V.forC(value,function(e,t){sb.appendFormat('<option value="{value}">{key}</option>',{key:e,value:t})},function(){_.sel.empty().html(sb.clear()),sb=null,_.vm.data.value&&setValue(_.vm.data.value)})}break;case"value":setValue(value);break;case"name":_.sel.attr("name",value);break;case"key":_.txt.text(value).show()}}),data},_.animate=function(e,t){_._animate(e,_.sel,t)}},W.RadioList=function(e,t,a){var n=this,o={};V.inherit.apply(n,[W.Control,[e||'<span class="c_RadioList"><span></span><ul></ul></span>',a||{}]]),o.onLoad=n.onLoad,o.render=n.render,n.content=V.getValue(t,'<li><span class="c_RadioList_li"><input name="{name}" type="radio" value="{value}"/><span>{key}</span></span></li>'),n.fill=function(){return{value:n.ul.find(":radio:checked").val()}},n.onLoad=function(e){n.title=e.find("span:first"),n.ul=e.find("ul"),n.vm.data.name=V.getValue(n.vm.data.name,"radio"),V.forC(n.events,function(t,a){n.bindEvent(e,t,a)},function(){o.onLoad(e)})},n.render=function(e){e=o.render(e);var t=function(e){V.setChecked(n.ul.find(":radio:checked"),!1),V.setChecked(n.ul.find(':radio[value="'+e+'"]'),!0)};return V.forC(e,function(e,a){switch(e){case"key":n.title.html(a);break;case"values":var o=V.sb();V.forC(a,function(e,t){o.appendFormat(n.content,{key:e,value:t,name:n.vm.data.name})},function(){n.ul.empty().append(o.toString()),o.clear(),o=null,n.vm.data.value&&t(n.vm.data.value)});break;case"value":t(a);break;case"name":n.node.find(":radio").attr("name",a)}}),e},n.animate=function(e,t){n._animate(e,n.ul,t)}},W.CheckList=function(e,t,a){var n=this,o={};V.inherit.apply(n,[W.Control,[e||'<div class="c_CheckList"><span></span><ul></ul></div>',a||{}]]),o.onLoad=n.onLoad,o.render=n.render,n.content=V.getValue(t,'<li><span class="c_CheckList_li"><input name="{name}" type="checkbox" value="{value}"/><span>{key}</span></span></li>'),n.fill=function(){return n.ul.children().length>0?{value:function(){var e=[];return n.ul.find(":checkbox:checked").each(function(t,a){e.push($(a).val())}),e.join(",")}()}:{}},n.onLoad=function(e){n.title=e.find("span:first"),n.ul=e.find("ul"),n.vm.data.name=V.getValue(n.vm.data.name,"check"),V.forC(n.events,function(t,a){n.bindEvent(e,t,a)},function(){o.onLoad(e)})},n.render=function(e){e=o.render(e);var t=function(e){e=V.getValue(e+"",""),V.setChecked(n.ul.find(":checkbox:checked"),!1),V.each(e.split(","),function(e){V.setChecked(n.ul.find(':checkbox[value="'+e+'"]'),!0)})};return V.forC(e,function(e,a){switch(e){case"key":n.title.html(a);break;case"values":var o=V.sb();V.forC(a,function(e,t){o.appendFormat(n.content,{key:e,value:t,name:n.vm.data.name})},function(){n.ul.empty().append(o.clear()),o=null,n.vm.data.value&&t(n.vm.data.value)});break;case"value":t(a);break;case"name":n.node.find(":checkbox").attr("name",a)}}),e},n.animate=function(e,t){n._animate(e,n.sel,t)}},W.Hidden=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<input class="c_hidden" type="hidden"/>',t]]),n.render=a.render,n.onLoad=a.onLoad,a.onLoad=function(e){V.forC(a.events,function(t,n){switch(t.toLowerCase()){case"error":a.get().validate&&a.validate(a,a.node);break;default:a.bindEvent(e,t,n)}},null,!0),n.onLoad(e)},a.fill=function(){return{val:a.node.val()}},a.render=function(e){return e=n.render(e),V.forC(e,function(e,t){switch(e){case"value":a.node.val(t);break;case"name":a.node.attr("name",t)}}),e}},W.PasswordBox=function(e,t){var a=this,n={};V.inherit.apply(a,[W.TextBox,[e||'<span class="c_passwordBox"><span style="display:none;"></span><input type="password"/></span>',t]]),n.render=a.render,a.render=function(e){return e=n.render(e),V.forC(e,function(e,t){switch(e){case"alt":case"passchar":a.input.attr("alt",t)}}),e}},W.Button=function(e,t){var a=this,n={};V.inherit.apply(a,[W.TextBox,[e||'<span class="c_button"><span style="display:none;"></span><input type="button"/></span>',t]]),n.render=a.render,a.fill=function(){return{}},a.render=function(e){return e=n.render(e),V.forC(e,function(e,t){switch(e){case"name":a.input.attr("name",t);break;case"key":a.txt.text(t).show();break;case"text":a.input.val(t)}}),e}},W.Submit=function(e,t){var a=this;V.inherit.apply(a,[W.Button,[e||'<span class="c_submit"><span style="display:none;"></span><input type="submit"/></span>',t]])},W.Reset=function(e,t){var a=this;V.inherit.apply(a,[W.Button,[e||'<span class="c_reset"><span style="display:none;"></span><input type="reset"/></span>',t]])},W.Form=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Control,[e||'<form method="get" action="" class="c_form"></form>',t||{data:{enctype:"multipart/form-data"}}]]),n.render=a.render,n.onLoad=a.onLoad,a.onLoad=function(e){V.forC(a.events,function(t,n){a.bindEvent(e,t,n)},function(){n.onLoad(e)},!0),a.cons=[],e.find("[_]").each(function(e,t){a.cons.push($(t).attr("id"))})},a.fill=function(){var e={};return a.cons&&V.each(a.cons,function(t){var n=a.parent.vms[t]?a.parent.vms[t]:a.page.vms[t];n&&"fill"!=n.nodeName&&(e[t]=n.get().value)},null,!0),{value:e}},a.render=function(e){return V.forC(e,function(t,n){switch(t){case"method":a.node.attr("method",n);break;case"action":a.node.attr("action",n);break;case"target":a.node.attr("target",n);break;case"name":a.node.attr("name",n);break;case"enctype":a.node.attr("enctype",n);break;case"valid":if(n){delete e.valid;var o=Array.prototype.slice.call(a.cons,0);V.whileC2(function(){return o.shift()},function(e,t){var n=a.parent.vms[e]?a.parent.vms[e]:a.page.vms[e];n&&n.update({valid:t})},function(){n.apply(null,[])})}break;case"value":n?(a.vm.data.value=n,V.each(a.cons,function(e){var t=a.parent.vms[e]?a.parent.vms[e]:a.page.vms[e];t&&("fill"==t.nodeName?t.update({value:n||{}}):void 0!=n[e]&&t.update({value:n[e]}))})):a.node[0].reset()}},function(){n.render(e)}),e}},W.Router=function(e,t){var a=this,n={};V.inherit.apply(a,[W.Panel,[e||'<div style="display:none;" class="c_router"></div>',t||{data:{showaction:"fadeInRight",hideaction:"fadeOutRight"}}]]),n.render=a.render,n.onLoad=a.onLoad,a.addDesc("Router:"),a.addDesc("\t负责提供SPA条件下的页面的前进和后退转换与大小统一设置允许定义 showaction与hideaction作为显示隐藏动画 而且默认显示第一个页面并调用其Active事件和canActive属性 isActive属性，Resize事件 "),a.addDesc("属性:"),a.addDesc("\tshowaction:config中定义的show动画"),a.addDesc("\thideaction:config中定义的hide动画"),a.addDesc("\tnext:按照顺序进行下一个canActive的控件 当输入id时按照ID进行切换,并通知内部子控件的Active事件"),a.addDesc("\tprev:按照顺序回滚上一个canActive的控件 当输入id时按照ID进行寻找如果属于子控件，而且历史上访问过子控件那么将子控件之后的历史全部删除，如果子控件已经canActive为真且切换至子控件，否则只删除记录不切换。并通知内部子控件的Active事件"),a.addDesc("\tsize:设置控件的高宽，并通知内部控件onSize事件"),a.addDesc("\tvalues:清理内部控件，重新addControl内部控件，设置其隐藏状态，并自动设置其size属性和第一个控件的active事件"),a.addDesc("\taddvalues:addControl新内部控件，并自动设置其size和第一个可用控件的active事件"),a.addDesc("事件:"),a.addDesc("\tonChange:不论前进还是后退更新当前value（子控件ID）值"),a.addDesc("附加给内部子控件的事件:"),a.addDesc("\tActive:触发内部控件的事件，并设置其isActive属性为真"),a.addDesc("\tonInactive:触发内部控件的事件，并设置其isActive属性为假"),a.addDesc("\tonResize:触发内部控件的事件，并设置其width,height,size属性"),a.addDesc("附加给内部子控件的属性:"),a.addDesc("\tcanActive:为真时不可被重新设置到"),a.onLoad=function(e){V.forC(a.events,function(t,n){switch(t.toLowerCase()){case"change":break;default:a.bindEvent(e,t,n)}},function(){n.onLoad(e)},!0),a.reload(e),n.cons.length>0&&(a.vm.data.next=n.cons[0])},a.reload=function(e){n.cons=[],n.vms={},n.his=[],e.children().each(function(e,t){var o=$(t).hide().attr("id");if(o){var i=a.vms[o]?a.vms[o]:a.parent.vms[o]?a.parent.vms[o]:a.page.vms[o];i?(n.cons.push(o),n.vms[o]=i,V.merge(i,{canActive:i.data&&i.data.canActive||!0,isActive:!1},!0)):V.showException("不是VJ控件，自动隐藏")}else V.showException("没有找到id,自动隐藏")})},a.change=function(e){e&&(a.vm.data.value&&(n.vms[a.vm.data.value].update({hide:a.vm.data.hideaction,isActive:!1}),n.vms[a.vm.data.value].call("inactive"),console.log(n.vms[a.vm.data.value])),n.vms[e]&&(n.vms[e].update({showaction:a.vm.data.showaction,isActive:!0}),n.vms[e].call("active")),a.call("change",{value:e,visible:!0}))},a.render=function(e){return V.forC(e,function(e,t){switch(e.toLowerCase()){case"value":n.his.push(t),a.change(t);break;case"next":if(t){if(t==a.vm.data.value)return;if(!n.vms[t]||t==a.vm.data.value){t=null;for(var o=!1,i=0;i<n.cons.length;i++)o&&V.getValue(n.vms[n.cons[i]].canActive,!0)?(t=n.cons[i],i=n.cons.length):n.cons[i]==a.vm.data.value&&(o=!0)}n.his.push(t),a.change(t)}break;case"prev":if(t){if(t==a.vm.data.value)return;if(n.vms[t]&&t!=a.vm.data.value){var o=!1,s=Array.prototype.slice.call(n.his,0);V.whileC(function(){return o?null:s.pop()},function(e){e==t&&(o=!0,n.his=s,n.his.push(e))},null,!0),o&&V.getValue(n.vms[t].data.canActive,!0)||(t=null)}else t=null,V.whileC(function(){return null==t?n.his.pop():null},function(e){
V.getValue(n.vms[e].data.canActive,!0)&&(t=e)},null,!0);a.change(t)}break;case"size":t&&t.width&&t.height&&(a.node.width(t.width),a.node.height(t.height),a.node.children().width(t.width),a.node.children().height(t.height),V.each(n.cons,function(e){n.vms[e].call("size",{size:t})}));break;case"clear":V.forC(n.vms,function(e,t){a.removeControl(e)},function(){n.cons=[],n.vms={},n.his=[],delete a.vm.data.value});break;case"addvalues":case"values":V.next(function(t,o){"values"==e.toLowerCase()?V.forC(n.vms,function(e,t){a.removeControl(e)},function(){n.cons=[],n.vms={},n.his=[],delete a.vm.data.value,o()}):o()},function(e,o){V.each(t,function(e){e.onActive=e.onActive?e.onActive:function(e,t){t.update({show:e.showaction}),V.once(function(){t.call("showed")},500)},a.addControl(null,e)},function(){a.reload(a.node),n.cons.length>0&&a.render({size:a.vm.data.size,value:n.cons[0]})})})}},function(){n.render(e)}),e}}}(VJ,jQuery,VJ.view,VJ.viewmodel);