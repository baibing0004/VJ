{"version":3,"sources":["../../../src/coooders/net/tool.js"],"names":["convert","buffer","Buffer","coding","eq","toString","request","options","stream","func","merge","method","headers","HA","protocol","toLowerCase","contentencoding","resp","split","encoding","on","console","log","err","apply","statusCode","Error","toArray","from","pipe","createGunzip","createInflate","WebClient","pri","_","__","cookies","timeout","url","data","callback2","indexOf","trim","req","parse","code","cencoding","call","e","setTimeout","end","byteLength","write","toJsonString","post","path","paths","isArray","filter","isValid","v","sb","ret","boundaryKey","Math","random","enddata","i","contentlength","each","pjson","resolve","normalize","format","exists","call2","ist","isTrue","append","stat","content","base","push","length","size","message","err2","clear","stack","file","createReadStream","bufferSize","then","catch","createDir","createWriteStream","opt","get","postJson","getJson","upload","download","createReverseProxy","port","address","w","proxy","client","c","find","start","p","passtime","sub","Date","tcpServer","net","createServer","createConnection","host","add","listen","output","createReverseProxy2","proxyports","pris"],"mappings":"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","file":"tool.js","sourcesContent":["import V from '../common/tool';\nimport H from 'http';\nimport HS from 'https';\nimport U from 'url';\nimport Z from 'zlib';\nimport F from 'fs';\nimport P from 'path';\nimport { ArrayStream } from '../collection/arraystream';\nimport C from './cookie';\nimport I from '../io/tool';\nimport { stringify } from 'querystring';\nimport { decode } from 'iconv-lite';\n/**\n * 处理字符集不标准问题\n * @param {*} buffer \n * @param {*} encoding \n */\nconst convert = (buffer = new Buffer(), coding = 'utf-8') => (!coding.eq('utf-8') && !coding.eq('utf8')) ? decode(buffer, coding) : buffer.toString();\n/**\n * request全Tool对象的基本方法可以输入 options=url.parse,stream,func(err,resp,code,cencoding,encoding); 返回req 需要手动完成write与end操作 可以针对GZIP等方式自动解压还原文件内容\n */\nexport const request = (options, stream, func) => {\n    options = V.merge({\n        method: \"GET\",\n        headers: {\n            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\n            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.11 Safari/537.36',\n            'Accept-Encoding': 'gzip, deflate'\n        }\n    }, options);\n    const HA = options.protocol.toLowerCase() == 'https:' ? HS : H;\n    return HA.request(options, resp => {\n        var contentencoding = (resp.headers['content-type'] && resp.headers['content-type'].split('=')[1]) || 'UTF-8';\n        var encoding = resp.headers['content-encoding'] || '';\n        resp.on('error', err => { console.log(err); if (func) func.apply(null, [err]); });\n        stream.on('finish', function() {\n            if (resp.statusCode == 200) {\n                if (func) func.apply(null, [null, resp, resp.statusCode, contentencoding, encoding]);\n            } else {\n                //V.showException(new Error(resp.statusCode + '状态不等于200'));\n                if (func) func.apply(null, [new Error(resp.statusCode + '状态不等于200:' + (stream.toArray ? convert(Buffer.from(stream.toArray()), contentencoding || encoding) : ''))]);\n            }\n        });\n        switch (encoding.toLowerCase()) {\n            case 'gzip':\n                resp.pipe(Z.createGunzip()).pipe(stream);\n                break;\n            case 'deflate':\n                resp.pipe(Z.createInflate()).pipe(stream);\n                break;\n            default:\n                resp.pipe(stream);\n                break;\n        }\n    });\n};\nexport const WebClient = class {\n    constructor() {\n        const { _, __ } = pri(this);\n        _.cookies = {};\n        _.timeout = 60000;\n    }\n    get(url, data = null, headers = {}) {\n        const { _, __ } = pri(this);\n        return V.callback2(call => {\n            const stream = new ArrayStream();\n            url = data ? `${url}${url.indexOf('?')>=0?'&':'?'}${(''+data).trim('&')}` : url;\n            const req = request(V.merge({\n                headers: { 'Cookie': C.toString(_.cookies, url) }\n            }, U.parse(url), { headers: headers }), stream, (err, resp, code, cencoding, encoding) => {\n                if (err) call(err);\n                else {\n                    C.merge(_.cookies, C.parse(resp.headers['set-cookie']));\n                    call(null, convert(Buffer.from(stream.toArray()), cencoding || encoding));\n                }\n            });\n            req.on('error', function(e) { call(e); });\n            req.setTimeout(_.timeout);\n            req.end();\n        });\n    }\n    post(url, data = '', headers = {}) {\n        const { _, __ } = pri(this);\n        //兼容JSON格式输入\n        data = typeof(data) == 'string' ? data : stringify(data);\n        return V.callback2(call => {\n            const stream = new ArrayStream();\n            const req = request(V.merge({\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": 'application/x-www-form-urlencoded',\n                    \"Content-Length\": Buffer.byteLength(data),\n                    'Cookie': C.toString(_.cookies, url)\n                }\n            }, U.parse(url), { headers: headers }), stream, (err, resp, code, cencoding, encoding) => {\n                if (err) call(err);\n                else {\n                    C.merge(_.cookies, C.parse(resp.headers['set-cookie']));\n                    call(null, convert(Buffer.from(stream.toArray()), cencoding || encoding));\n                }\n            });\n            req.on('error', function(e) { call(e); });\n            req.write(data);\n            req.setTimeout(_.timeout);\n            req.end();\n        });\n    }\n    getJson(url, data = {}, headers = {}) {\n        const { _, __ } = pri(this);\n        return V.callback2(call => {\n            const stream = new ArrayStream();\n            const req = request(V.merge({\n                method: \"GET\",\n                headers: {\n                    \"Content-Type\": 'application/json',\n                    \"Content-Length\": Buffer.byteLength(V.toJsonString(data)),\n                    'Cookie': C.toString(_.cookies, url)\n                }\n            }, U.parse(url), { headers: headers }), stream, (err, resp, code, cencoding, encoding) => {\n                if (err) call(err);\n                else {\n                    C.merge(_.cookies, C.parse(resp.headers['set-cookie']));\n                    call(null, convert(Buffer.from(stream.toArray()), cencoding || encoding));\n                }\n            });\n            req.on('error', function(e) { call(e); });\n            req.write(V.toJsonString(data));\n            req.setTimeout(_.timeout);\n            req.end();\n        });\n    }\n\n    /**\n     * post方法实现保留cookie的会话上传文件操作url,path(;分隔的字符串或者文件名数组),func(err,data) \n     * 鸣谢http://www.soso.io/article/48643.html\n     */\n    postJson(url, data = {}, headers = {}) {\n        const { _, __ } = pri(this);\n        return _.post(url, V.toJsonString(data), V.merge({\n            \"Content-Type\": 'application/json'\n        }, headers));\n    }\n\n    /**\n     * post方法实现保留cookie的会话上传文件操作url,path(;分隔的字符串或者文件名数组),func(err,data) \n     * 鸣谢http://www.soso.io/article/48643.html\n     */\n    async upload(url, path, headers = {}) {\n        const { _, __ } = pri(this);\n        let paths = V.isArray(path) ? path : path.split(';').filter(v => V.isValid(v));\n        let err = V.sb();\n        let ret = [];\n        let boundaryKey = Math.random().toString(16);\n        let enddata = `\\r\\n----${boundaryKey}--`; //定义尾部\n        var i = 0;\n        var contentlength = 0;\n        await V.each(paths, async(v) => {\n            const pjson = P.parse(P.resolve(P.normalize(v)));\n            v = P.format(pjson);\n            let isTrue = await V.callback2(call2 => F.exists(v, ist => call2(null, ist)));\n            if (!isTrue) {\n                err.append(v + \"目标文件未找到\");\n                return false;\n            }\n            try {\n                let stat = await V.callback2(F.stat, F, v);\n                var content = Buffer.from(\"\\r\\n----\" + boundaryKey + \"\\r\\n\" + \"Content-Type: application/octet-stream\\r\\n\" + \"Content-Disposition: form-data; name=\\\"\" + \"file\" + (i++) + \"\\\"; filename=\\\"\" + pjson.base + \"\\\"\\r\\n\" + \"Content-Transfer-Encoding: binary\\r\\n\\r\\n\", 'utf-8');\n                ret.push({ content: content, path: v });\n                contentlength += (content.length + stat.size);\n            } catch (e) {\n                err.append(v + \"目标文件stat获取出现问题:\" + e.message);\n            }\n            return false;\n        }, true);\n        return V.callback2(call => {\n            const stream = new ArrayStream();\n            const req = request(V.merge({\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": 'multipart/form-data; boundary=--' + boundaryKey,\n                    \"Content-Length\": contentlength + Buffer.byteLength(enddata),\n                    'Cookie': C.toString(_.cookies, url)\n                }\n            }, U.parse(url), { headers: headers }), stream, (err2, resp, code, cencoding, encoding) => {\n                if (err2) call(err.clear() + '\\r\\n' + err2.stack);\n                else {\n                    C.merge(_.cookies, C.parse(resp.headers['set-cookie']));\n                    call(null, convert(Buffer.from(stream.toArray()), cencoding || encoding));\n                }\n            });\n            req.on('error', function(e) { call(e); });\n            req.setTimeout(_.timeout);\n            V.each(ret, (v, call2) => {\n                var file = F.createReadStream(v.path, { bufferSize: 4 * 1024 });\n                //写入头部                  \n                req.write(v.content);\n                file.on('end', call2);\n                //写入文件 \n                file.pipe(req, { end: false });\n            }, true).then(() => req.end(enddata)).catch(e => console.log(e.stack));\n        });\n    }\n\n    /**\n     * get方法实现保留cookie的会话下载文件操作url,path,func(err,data)\n     */\n    async download(url, path, headers = {}) {\n        const { _, __ } = pri(this);\n        await I.createDir(path);\n        let file = F.createWriteStream(path);\n        let opt = U.parse(url);\n        opt.headers = V.merge({ 'Cookie': C.toString(_.cookies, url) }, headers);\n        return V.callback2(call => {\n            let req = request(opt, file, (err, resp, code, cencoding, encoding) => {\n                if (err) call(err);\n                else {\n                    C.merge(_.cookies, C.parse(resp.headers['set-cookie']));\n                    call(null, true);\n                }\n            });\n            req.on('error', function(e) { call(e); });\n            req.setTimeout(_.timeout);\n            req.end();\n        });\n    }\n};\n/**\n * 新建WebClient类对象返回get方法的对象url,func(err,data)\n */\nexport const get = (url, data, headers) => new WebClient().get(url, data, headers);\n/**\n * post(url,func):新建WebClient类对象返回post方法的对象url,string || Buffer,func(err,data)\n */\nexport const post = (url, data, headers) => new WebClient().post(url, data, headers);\n/**\n * 新建WebClient类对象返回post方法的对象url,string || JSON,func(err,data)\n */\nexport const postJson = (url, data, headers) => new WebClient().postJson(url, data, headers);\n/**\n * 新建WebClient类对象返回post方法的对象url,string || JSON,func(err,data)\n */\nexport const getJson = (url, data, headers) => new WebClient().getJson(url, data, headers);\n/**\n * 新建WebClient类对象返回post方法的文件对象url,path,func(err,data)\n */\nexport const upload = (url, path, headers) => new WebClient().upload(url, path, headers);\n/**\n * 新建WebClient类对象返回get方法的文件对象url,path,func(err,data)\n */\nexport const download = (url, path, headers) => new WebClient().download(url, path, headers);\n/**\n * createReverseProxy(port,[address]):非常简单的TCP代理服务器\n */\nexport const createReverseProxy = function(port, address) {\n    if (address) {} else throw new Error('Need address Array(e.g [{host:127.0.0.1,port:1001},{host:127.0.0.1,port:1002}]) as ports');\n    address = V.isArray(address) ? address : [address];\n    var w = 0;\n    var proxy = (client, c) => {\n        client.pipe(c);\n        c.pipe(client);\n    };\n    var find = () => {\n        var start = w;\n        w = (w + 1) % address.length;\n        while (start != w) {\n            var p = address[w];\n            if (p.err) {\n                if (p.err.passtime.sub('s', new Date()) < 0) {\n                    delete p.err;\n                    return p;\n                }\n            } else return p;\n            w = (w + 1) % address.length;\n        }\n        return address[start];\n    };\n    var tcpServer = net.createServer((c) => {\n        var p = find();\n        try {\n            var client = net.createConnection(p.port, p.host, () => proxy(client, c));\n        } catch (e) {\n            console.log(e.stack);\n            p.err = { e: e, passtime: new Date().add('s', 5) };\n            c.end(new Buffer(e.message, \"utf-8\"));\n        }\n    }).listen(port, function() {\n        console.log('Proxy Server listen ' + port + ' Now!');\n    });\n    tcpServer.on(\"error\", function(err) {\n        output(\"server error ,check the port...\" + err);\n    });\n    return tcpServer;\n};\n/**\n * createReverseProxy(proxy,host,proxyports):非常简单的TCP代理服务器\n */\nexport const createReverseProxy2 = function(port, host, proxyports) {\n    if (proxyports) {} else throw new Error('Need ProxyPorts Array(e.g [1001,1002,1003]) as ports');\n    proxyports = V.isArray(proxyports) ? proxyports : [proxyports];\n    var w = 0;\n    var proxy = (client, c) => {\n        client.pipe(c);\n        c.pipe(client);\n    }\n    var tcpServer = net.createServer((c) => {\n        w = (w + 1) % proxyports.length;\n        var p = proxyports[w];\n        var client = host ? net.createConnection(p, host, () => proxy(client, c)) : net.createConnection(p, () => proxy(client, c));\n    }).listen(port, function() {\n        console.log('Proxy Server listen ' + port + ' Now!');\n    });\n    tcpServer.on(\"error\", function(err) {\n        output(\"server error ,check the port...\" + err);\n    });\n    return tcpServer;\n};\n\nexport default { request, WebClient, get, getJson, post, postJson, upload, download, createReverseProxy, createReverseProxy2 };\nconst pri = V.pris();"]}